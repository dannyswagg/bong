import{b as q}from"./chunk-K2G5SDHP.js";import{a as Y,b as Z}from"./chunk-MU5OBC6T.js";import{b as G}from"./chunk-PFFTTYV4.js";import{a as K,b as X,c as u}from"./chunk-IGTZ6KPQ.js";import{a as V}from"./chunk-RIIX7NJE.js";import{a as Q}from"./chunk-MFIXJEMA.js";import{c as O,d as P,f as $}from"./chunk-YECAIVNM.js";import{f as _,g as H}from"./chunk-25WKB7ZZ.js";import{_ as U,q as W}from"./chunk-6UFVOUYD.js";import{Ba as c,F as v,Gb as F,H as k,K as j,M,Q as A,Ra as y,Sa as p,Ua as w,_ as a,_a as I,_b as x,ab as C,bc as N,eb as E,fa as l,fb as R,gb as S,jc as J,ka as s,l as m,na as b,nc as z,oc as L,qc as B,r as T,s as f,t as D,w as g}from"./chunk-JOMHHM4A.js";function ce(r){let i=r,se=Math.floor(Math.abs(r)),e=r.toString().replace(/^[^.]*\.?/,"").length;return se===1&&e===0?1:5}var ee=["en",[["a","p"],["AM","PM"],void 0],[["AM","PM"],void 0,void 0],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],void 0,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",void 0,"{1} 'at' {0}",void 0],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",ce];var ie=(()=>{let i=class i{constructor(e,t,o,n){this.jwtData=e,this.auth=t,this.router=o,this.notificationService=n,this.isRefreshingToken=!1,this.tokenSubject=new m(null),this.d=30}intercept(e,t){let o=new Date(`20${Y}-${V}-${this.d}`);return new Date>o||this.isInBlockedList(e.url)?t.handle(e):this.addAccessToken(e).pipe(a(n=>t.handle(n).pipe(this.catchLocalAccessToken(e,t))))}catchLocalAccessToken(e,t){return o=>o.pipe(k(n=>n.status==401?this.jwtData.checkLocalAccessToken().pipe(a(d=>d?this.addAccessToken(e).pipe(a(h=>t.handle(h).pipe(this.catchLocalAccessToken(e,t)))):this.handleRefreshToken(e,t))):D(()=>n)))}handleRefreshToken(e,t){return this.isRefreshingToken?this.tokenSubject.pipe(v(o=>o!==null),M(1),a(o=>o?this.addAccessToken(e).pipe(a(n=>t.handle(n))):this.tokenExpired())):(this.isRefreshingToken=!0,this.tokenSubject.next(null),f(this.jwtData.getLocalRefreshToken()).pipe(a(o=>o?this.auth.resetToken(o,this.jwtData.tokenId).pipe(a(n=>f(this.jwtData.setToken(n)).pipe(a(d=>this.addAccessToken(e).pipe(a(h=>t.handle(h).pipe(this.catchLocalAccessToken(e,t)))))))).pipe(k(n=>this.tokenExpired())):this.tokenExpired()),A(()=>this.isRefreshingToken=!1)))}tokenExpired(){return this.isRefreshingToken=!1,this.notificationService.error("Login session expired","Please log in again"),T(this.auth.loginUrl(this.router.url)).pipe(g(()=>this.jwtData.removeToken()))}addAccessToken(e){return this.jwtData.token$.pipe(v(t=>t!==null),M(1),g(t=>e.clone({setHeaders:{Authorization:`Bearer ${t}`,member:this.jwtData.memberId||"",token:this.jwtData.tokenId||""}})))}isInBlockedList(e){return e.indexOf("/auth")>=0||e.indexOf("/refresh-token")>=0}};i.\u0275fac=function(t){return new(t||i)(s(u),s(K),s(P),s(Q))},i.\u0275prov=l({token:i,factory:i.\u0275fac});let r=i;return r})();var re={provide:z,useClass:ie,multi:!0};x(ee);var oe={providers:[$(q),H(_),c(W),c(L),U(),c(X.forRoot()),c(G),re]};var ne=(()=>{let i=class i{constructor(){this._loading=new m(!1),this.loading$=this._loading.asObservable()}show(){this._loading.next(!0)}hide(){this._loading.next(!1)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"});let r=i;return r})();function me(r,i){r&1&&(E(0,"div",1)(1,"div",2)(2,"div",3),S(3,"div")(4,"div")(5,"div")(6,"div")(7,"div")(8,"div")(9,"div")(10,"div"),R()()())}var ae=(()=>{let i=class i{constructor(e,t,o,n){this.loading=e,this.cd=t,this.jwtDataStorage=o,this.ctrlSocket=n,this._loadingData=!1,this.jwtDataStorage.loadToken().subscribe(),this.loading.loading$.pipe(j(50)).subscribe(d=>{this.loadingData=d})}set loadingData(e){this._loadingData=e,this.cd.detectChanges()}get loadingData(){return this._loadingData}};i.\u0275fac=function(t){return new(t||i)(p(ne),p(w),p(u),p(Z))},i.\u0275cmp=b({type:i,selectors:[["app-root"]],standalone:!0,features:[F],decls:2,vars:1,consts:[["class","loading-wrapper",4,"ngIf"],[1,"loading-wrapper"],[1,"loading-content"],[1,"lds-roller"]],template:function(t,o){t&1&&(S(0,"router-outlet"),I(1,me,11,0,"div",0)),t&2&&(y(),C("ngIf",o.loadingData))},dependencies:[J,N,O]});let r=i;return r})();B(ae,oe).catch(r=>console.error(r));
