"use strict";var c=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Ea=c(si=>{"use strict";var vm=si&&si.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(si,"__esModule",{value:!0});si.AppService=void 0;var ym=require("@nestjs/common"),Va=class{getHello(){return"Hello World!"}};si.AppService=Va;si.AppService=Va=vm([(0,ym.Injectable)()],Va)});var Ju=c(Mt=>{"use strict";var gm=Mt&&Mt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},bm=Mt&&Mt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.AppController=void 0;var Sm=require("@nestjs/common"),wm=Ea(),Fa=class{constructor(e){this.appService=e}};Mt.AppController=Fa;Mt.AppController=Fa=gm([(0,Sm.Controller)(),bm("design:paramtypes",[wm.AppService])],Fa)});var l=c(Ot=>{"use strict";var Tm=Ot&&Ot.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Rm=Ot&&Ot.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.PrismaService=void 0;var Am=require("@nestjs/common"),qm=require("@prisma/client"),Na=class extends qm.PrismaClient{constructor(){console.log("New Prisma Service",process.env.DATABASE_URL),super({datasources:{db:{url:process.env.DATABASE_URL}}})}async onModuleInit(){await this.$connect(),console.log("PrismaService onModuleInit success")}};Ot.PrismaService=Na;Ot.PrismaService=Na=Tm([(0,Am.Injectable)(),Rm("design:paramtypes",[])],Na)});var F=c(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.generateKeyPair=b.createTokenPair=b.decodeToken=b.loginDisabled=b.invalidLoginInformation=b.invalidLogin=b.invalidTokenInformation=b.invalidToken=b.createKeyAndTokenPair=void 0;var Ha=require("jsonwebtoken"),Cm=require("crypto"),jm=require("rxjs"),La=require("@nestjs/common"),Pm=n=>{let{privateKey:e,publicKey:t}=(0,b.generateKeyPair)();return{privateKey:e,publicKey:t,...(0,b.createTokenPair)(n,e)}};b.createKeyAndTokenPair=Pm;b.invalidToken="Invalid token information";var Mm=()=>{throw new La.UnauthorizedException(b.invalidToken,{description:b.invalidToken})};b.invalidTokenInformation=Mm;b.invalidLogin="Invalid login information";var Om=()=>{throw new La.BadRequestException({message:[{property:"password",value:"",errors:{invalid_login:b.invalidLogin},code:"invalid_login",message:b.invalidLogin}]})};b.invalidLoginInformation=Om;var Im=()=>{throw new La.BadRequestException({message:[{property:"password",value:"",errors:{account_locked:"Your account is temporarily locked"},code:"account_locked",message:"Your account is temporarily locked"}]})};b.loginDisabled=Im;var Um=(n,e)=>(0,jm.from)(new Promise((t,i)=>{(0,Ha.verify)(n,e,(o,r)=>o?i(o):t(r))}));b.decodeToken=Um;var Dm=(n,e)=>{let t=(0,Ha.sign)(n,e.toString(),{algorithm:"RS256",expiresIn:"30 minutes"}),i=(0,Ha.sign)({...n,refreshToken:!0},e.toString(),{algorithm:"RS256",expiresIn:"7 days"});return{accessToken:t,refreshToken:i}};b.createTokenPair=Dm;var Bm=()=>(0,Cm.generateKeyPairSync)("rsa",{modulusLength:2048,publicKeyEncoding:{type:"pkcs1",format:"pem"},privateKeyEncoding:{type:"pkcs1",format:"pem"}});b.generateKeyPair=Bm});var ai=c(It=>{"use strict";var Gm=It&&It.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Vm=It&&It.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(It,"__esModule",{value:!0});It.ApiV1AuthService=void 0;var Em=require("@nestjs/common"),Fm=l(),f=require("rxjs"),Nm=require("argon2"),Hm=require("crypto"),Te=F(),Wa=class{constructor(e){this.prisma=e}decodeToken(e,t,i=!1){return(0,f.from)(this.prisma.userAuthToken.findUnique({where:{id:t}})).pipe((0,f.switchMap)(o=>(o||(0,Te.invalidTokenInformation)(),(0,Te.decodeToken)(e,o.publicKey).pipe((0,f.map)(r=>(r||(0,Te.invalidTokenInformation)(),!i&&!r.refreshToken&&(0,Te.invalidTokenInformation)(),{tokenId:String(r.tokenId).toString(),userAuthToken:o,userId:String(r.userId).toString(),token:e})),(0,f.catchError)(r=>r.name==="TokenExpiredError"?i?this.logoutAccessToken(o.refreshToken,e).pipe((0,f.switchMap)(()=>(0,f.throwError)(()=>r))):this.logout(o.refreshToken).pipe((0,f.switchMap)(()=>(0,f.throwError)(()=>r))):(0,f.throwError)(()=>r))))))}verifyRefreshToken(e,t,i){return this.decodeToken(e,t,!1).pipe((0,f.switchMap)(o=>((o.userId!=i||e!=o.userAuthToken.refreshToken)&&(0,Te.invalidTokenInformation)(),this.getUserWithAuthToken(i,o.userAuthToken))))}getNewAuthToken(e,t,i){return this.verifyRefreshToken(e,t,i).pipe((0,f.switchMap)(({user:o,userAuthToken:r})=>(o||(0,Te.invalidLoginInformation)(),this.signToken(o.id,r.ip,r.userAgent))))}logoutAccessToken(e,t){return(0,f.from)(this.prisma.userAuthToken.findUnique({where:{refreshToken:t}})).pipe((0,f.switchMap)(i=>i?(0,f.from)(this.prisma.userAuthTokenExpired.upsert({create:{userId:i.userId,accessToken:[e]},update:{accessToken:{push:e}},where:{refreshToken:i.refreshToken}})).pipe((0,f.map)(()=>!0)):(0,f.of)(!1)))}logout(e){return(0,f.from)(this.prisma.userAuthToken.findUnique({where:{refreshToken:e}})).pipe((0,f.switchMap)(t=>t?(0,f.zip)(this.prisma.userAuthToken.delete({where:{refreshToken:e}}),this.prisma.userAuthTokenExpired.upsert({create:{userId:t.userId,refreshToken:t.refreshToken},update:{userId:t.userId,createdAt:new Date},where:{refreshToken:t.refreshToken}})).pipe((0,f.map)(()=>!0)):(0,f.of)(!1)))}login(e,t,i,o){return(0,f.from)(this.prisma.user.findUnique({where:{username:e}})).pipe((0,f.switchMap)(r=>r?r.disabled?(0,Te.loginDisabled)():(0,Nm.verify)(r.hash,t)?this.returnToken(i,o,r):(0,Te.invalidLoginInformation)():(0,Te.invalidLoginInformation)()))}returnToken(e,t,i){return this.signToken(i.id,e,t).pipe((0,f.map)(o=>({...o,username:i.username,fullName:i.fullName,balance:i.balance,userId:i.id})))}signToken(e,t,i){let o=(0,Hm.randomUUID)(),r=(0,Te.createKeyAndTokenPair)({tokenId:o,userId:e});return this.removeTokenUserId(e).pipe((0,f.switchMap)(()=>(0,f.from)(this.prisma.userAuthToken.create({data:{id:o,publicKey:r.publicKey,refreshToken:r.refreshToken,userId:e,ip:t,userAgent:i}})).pipe((0,f.switchMap)(()=>this.prisma.user.findUnique({where:{id:e}}))).pipe((0,f.map)(s=>({accessToken:r.accessToken,refreshToken:r.refreshToken,token:o,userId:e,username:s.username,fullName:s.fullName,balance:s.balance,avatar:s.avatar})))))}getUserWithAuthToken(e,t){return(0,f.from)(this.prisma.user.findUnique({where:{id:e}})).pipe((0,f.map)(i=>(i||(0,Te.invalidTokenInformation)(),{user:i,userAuthToken:t})))}removeTokenUserId(e){return(0,f.from)(this.prisma.userAuthToken.findMany({where:{userId:e}})).pipe((0,f.switchMap)(t=>{if(t.length){let i=[],o=[];return t.forEach(r=>{i.push(r.id),o.push({id:r.id,userId:r.userId,refreshToken:r.refreshToken})}),(0,f.forkJoin)(this.prisma.userAuthTokenExpired.createMany({data:o,skipDuplicates:!0}),this.prisma.userAuthToken.deleteMany({where:{id:{in:i}}}))}else return(0,f.of)(!0)}))}};It.ApiV1AuthService=Wa;It.ApiV1AuthService=Wa=Gm([(0,Em.Injectable)(),Vm("design:paramtypes",[Fm.PrismaService])],Wa)});var vn=c(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.findRootDir=void 0;var Lm=require("fs"),Ku=require("path");function Qu(n=__dirname){if((0,Lm.existsSync)((0,Ku.join)(n,"package.json")))return n;let e=(0,Ku.dirname)(n);if(e===n)throw new Error("Root directory with package.json not found");return Qu(e)}Bo.findRootDir=Qu});var Ln=c(he=>{"use strict";var Wm=he&&he.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},$m=he&&he.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(he,"__esModule",{value:!0});he.AdminCoinTossService=he.coinTossImagePath=void 0;var km=require("@nestjs/common"),Jm=l(),B=require("rxjs"),zu=require("path"),Km=vn(),Qm=require("fs");he.coinTossImagePath=(0,zu.join)((0,Km.findRootDir)(),"/assets/uploads/coin-toss");var Go=class{constructor(e){this.prisma=e}getAllCoinToss(e,t){return(0,B.from)(this.prisma.$transaction([this.prisma.coinToss.findMany({take:e,skip:e*t}),this.prisma.coinToss.count()])).pipe((0,B.map)(([i,o])=>({data:i,count:o})))}createCoinToss(e,t){return this.prisma.coinToss.create({data:{...e,image:t.filename}})}updateCoinToss(e,t){return(0,B.from)(this.prisma.coinToss.findUnique({where:{id:e.id}})).pipe((0,B.switchMap)(i=>{if(t)try{(0,Qm.unlinkSync)((0,zu.join)(he.coinTossImagePath,i.image))}catch{}return this.prisma.coinToss.update({where:{id:e.id},data:{...e,image:t?t.filename:i.image}})}))}disabledCoinToss(e){return this.prisma.coinToss.update({where:{id:e.id},data:{disabled:e.disabled}})}getAllDayStatistics(e,t){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossDayStatistics.findMany({take:e,skip:e*t,orderBy:{createdAt:"desc"},include:{coinToss:!0}}),this.prisma.coinTossDayStatistics.count()])).pipe((0,B.map)(([i,o])=>({data:i,count:o})))}getDayStatisticsById(e,t,i){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossDayStatistics.findMany({take:t,skip:t*i,where:{coinTossId:e},orderBy:{createdAt:"desc"},include:{coinToss:!0}}),this.prisma.coinTossDayStatistics.count({where:{coinTossId:e}})])).pipe((0,B.map)(([o,r])=>({data:o,count:r})))}getAllHistory(e,t){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:e,skip:e*t,orderBy:{createdAt:"desc"},include:{coinToss:!0,user:!0,ctrl:!0}}),this.prisma.coinTossBetHistorySession.count()])).pipe((0,B.map)(([i,o])=>({data:i,count:o})))}getAllHistoryWin(e,t){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:e,skip:e*t,where:{winAmount:{gt:0}},orderBy:{createdAt:"desc"},include:{coinToss:!0,user:!0,ctrl:!0}}),this.prisma.coinTossBetHistorySession.count({where:{winAmount:{gt:0}}})])).pipe((0,B.map)(([i,o])=>({data:i,count:o})))}getAllHistoryByGameId(e,t,i){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:t,skip:t*i,where:{coinTossId:e},orderBy:{createdAt:"desc"},include:{coinToss:!0,user:!0,ctrl:!0}}),this.prisma.coinTossBetHistorySession.count({where:{coinTossId:e}})])).pipe((0,B.map)(([o,r])=>({data:o,count:r})))}getAllWinHistory(e,t){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossHistory.findMany({take:e,skip:e*t,where:{totalWin:{gt:0}},orderBy:{createdAt:"desc"}}),this.prisma.coinTossHistory.count({where:{totalWin:{gt:0}}})])).pipe((0,B.map)(([i,o])=>({data:i,count:o})))}getAllWinHistoryByGameId(e,t,i){return(0,B.from)(this.prisma.$transaction([this.prisma.coinTossHistory.findMany({take:t,skip:t*i,where:{coinTossId:e,totalWin:{gt:0}},orderBy:{createdAt:"desc"}}),this.prisma.coinTossHistory.count({where:{coinTossId:e,totalWin:{gt:0}}})])).pipe((0,B.map)(([o,r])=>({data:o,count:r})))}};he.AdminCoinTossService=Go;Go.j=Date;he.AdminCoinTossService=Go=Wm([(0,km.Injectable)(),$m("design:paramtypes",[Jm.PrismaService])],Go)});var br=c(Ut=>{"use strict";var zm=Ut&&Ut.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ym=Ut&&Ut.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.CtrlAuthService=void 0;var Xm=require("@nestjs/common"),Zm=l(),p=require("rxjs"),Re=F(),xm=require("argon2"),eh=require("crypto"),$a=class{constructor(e){this.prisma=e}decodeToken(e,t,i=!1){return(0,p.from)(this.prisma.ctrlAuthToken.findUnique({where:{id:t}})).pipe((0,p.switchMap)(o=>(o||(0,Re.invalidTokenInformation)(),(0,Re.decodeToken)(e,o.publicKey).pipe((0,p.map)(r=>(r||(0,Re.invalidTokenInformation)(),!i&&!r.refreshToken&&(0,Re.invalidTokenInformation)(),{tokenId:String(r.tokenId).toString(),ctrlAuthToken:o,ctrlId:String(r.ctrlId).toString(),token:e})),(0,p.catchError)(r=>r.name==="TokenExpiredError"?i?this.logoutAccessToken(o.refreshToken,e).pipe((0,p.switchMap)(()=>(0,p.throwError)(()=>r))):this.logout(o.refreshToken).pipe((0,p.switchMap)(()=>(0,p.throwError)(()=>r))):(0,p.throwError)(()=>r))))))}verifyRefreshToken(e,t,i){return this.decodeToken(e,t,!1).pipe((0,p.switchMap)(o=>((o.ctrlId!=i||e!=o.ctrlAuthToken.refreshToken)&&(0,Re.invalidTokenInformation)(),this.getCtrlWithAuthToken(i,o.ctrlAuthToken))))}getNewAuthToken(e,t,i){return this.verifyRefreshToken(e,t,i).pipe((0,p.switchMap)(({ctrl:o,ctrlAuthToken:r})=>(o||(0,Re.invalidLoginInformation)(),this.signToken(o.id,r.ip,r.userAgent))))}logoutAccessToken(e,t){return(0,p.from)(this.prisma.ctrlAuthToken.findUnique({where:{refreshToken:t}})).pipe((0,p.switchMap)(i=>i?(0,p.from)(this.prisma.ctrlAuthTokenExpired.upsert({create:{ctrlId:i.ctrlId,accessToken:[e]},update:{accessToken:{push:e}},where:{refreshToken:i.refreshToken}})).pipe((0,p.map)(()=>!0)):(0,p.of)(!1)))}logout(e){return(0,p.from)(this.prisma.ctrlAuthToken.findUnique({where:{refreshToken:e}})).pipe((0,p.switchMap)(t=>t?(0,p.zip)(this.prisma.ctrlAuthToken.delete({where:{refreshToken:e}}),this.prisma.ctrlAuthTokenExpired.upsert({create:{ctrlId:t.ctrlId,refreshToken:t.refreshToken},update:{ctrlId:t.ctrlId,createdAt:new Date},where:{refreshToken:t.refreshToken}})).pipe((0,p.map)(()=>!0)):(0,p.of)(!1)))}login(e,t,i,o){return(0,p.from)(this.prisma.ctrl.findUnique({where:{username:e}})).pipe((0,p.switchMap)(r=>r?r.disabled?(0,Re.loginDisabled)():(0,xm.verify)(r.hash,t)?this.returnToken(i,o,r):(0,Re.invalidLoginInformation)():(0,Re.invalidLoginInformation)()))}returnToken(e,t,i){return this.signToken(i.id,e,t).pipe((0,p.map)(o=>({...o,username:i.username,userId:i.id})))}signToken(e,t,i){let o=(0,eh.randomUUID)(),r=(0,Re.createKeyAndTokenPair)({tokenId:o,ctrlId:e});return this.removeTokenCtrlId(e).pipe((0,p.switchMap)(()=>(0,p.from)(this.prisma.ctrlAuthToken.create({data:{id:o,publicKey:r.publicKey,refreshToken:r.refreshToken,ctrlId:e,ip:t,userAgent:i},include:{ctrl:!0}})).pipe((0,p.map)(s=>({accessToken:r.accessToken,refreshToken:r.refreshToken,token:o,userId:e,username:s.ctrl.username})))))}getCtrlWithAuthToken(e,t){return(0,p.from)(this.prisma.ctrl.findUnique({where:{id:e}})).pipe((0,p.map)(i=>(i||(0,Re.invalidTokenInformation)(),{ctrl:i,ctrlAuthToken:t})))}removeTokenCtrlId(e){return(0,p.from)(this.prisma.ctrlAuthToken.findMany({where:{ctrlId:e}})).pipe((0,p.switchMap)(t=>{if(t.length){let i=[],o=[];return t.forEach(r=>{i.push(r.id),o.push({id:r.id,ctrlId:r.ctrlId,refreshToken:r.refreshToken})}),(0,p.forkJoin)(this.prisma.ctrlAuthTokenExpired.createMany({data:o,skipDuplicates:!0}),this.prisma.ctrlAuthToken.deleteMany({where:{id:{in:i}}}))}else return(0,p.of)(!0)}))}};Ut.CtrlAuthService=$a;Ut.CtrlAuthService=$a=zm([(0,Xm.Injectable)(),Ym("design:paramtypes",[Zm.PrismaService])],$a)});var Wn=c(Ae=>{"use strict";var th=Ae&&Ae.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},rh=Ae&&Ae.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.CtrlRefreshTokenJwtStrategy=Ae.o=void 0;var ih=require("@nestjs/common"),nh=require("@nestjs/passport"),Yu=require("passport-jwt"),oh=l(),sh=br(),Xu=F(),ah=require("rxjs");Ae.o="ge";var ka=class extends(0,nh.PassportStrategy)(Yu.Strategy,"ctrlRefreshToken"){constructor(e,t){super({jwtFromRequest:Yu.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(Xu.invalidToken);let a=await(0,ah.firstValueFrom)(this.authService.decodeToken(o,s,!1));r(null,a.ctrlAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.authService=t}async validate(e){let t=await this.prisma.ctrl.findUnique({where:{id:e.ctrlId}});if(!t)(0,Xu.invalidTokenInformation)();else return{...t,authToken:e}}};Ae.CtrlRefreshTokenJwtStrategy=ka;Ae.CtrlRefreshTokenJwtStrategy=ka=th([(0,ih.Injectable)(),rh("design:paramtypes",[oh.PrismaService,sh.CtrlAuthService])],ka)});var ci=c(Dt=>{"use strict";var ch=Dt&&Dt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},lh=Dt&&Dt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.AdminAuthService=void 0;var uh=require("@nestjs/common"),dh=l(),_=require("rxjs"),qe=F(),fh=require("argon2"),ph=require("crypto"),Ja=class{constructor(e){this.prisma=e}decodeToken(e,t,i=!1){return(0,_.from)(this.prisma.adminAuthToken.findUnique({where:{id:t}})).pipe((0,_.switchMap)(o=>(o||(0,qe.invalidTokenInformation)(),(0,qe.decodeToken)(e,o.publicKey).pipe((0,_.map)(r=>(r||(0,qe.invalidTokenInformation)(),!i&&!r.refreshToken&&(0,qe.invalidTokenInformation)(),{tokenId:String(r.tokenId).toString(),adminAuthToken:o,adminId:String(r.adminId).toString(),token:e})),(0,_.catchError)(r=>r.name==="TokenExpiredError"?i?this.logoutAccessToken(o.refreshToken,e).pipe((0,_.switchMap)(()=>(0,_.throwError)(()=>r))):this.logout(o.refreshToken).pipe((0,_.switchMap)(()=>(0,_.throwError)(()=>r))):(0,_.throwError)(()=>r))))))}verifyRefreshToken(e,t,i){return this.decodeToken(e,t,!1).pipe((0,_.switchMap)(o=>((o.adminId!=i||e!=o.adminAuthToken.refreshToken)&&(0,qe.invalidTokenInformation)(),this.getAdminWithAuthToken(i,o.adminAuthToken))))}getNewAuthToken(e,t,i){return this.verifyRefreshToken(e,t,i).pipe((0,_.switchMap)(({admin:o,adminAuthToken:r})=>(o||(0,qe.invalidLoginInformation)(),this.signToken(o.id,r.ip,r.userAgent))))}logoutAccessToken(e,t){return(0,_.from)(this.prisma.adminAuthToken.findUnique({where:{refreshToken:t}})).pipe((0,_.switchMap)(i=>i?(0,_.from)(this.prisma.adminAuthTokenExpired.upsert({create:{adminId:i.adminId,accessToken:[e]},update:{accessToken:{push:e}},where:{refreshToken:i.refreshToken}})).pipe((0,_.map)(()=>!0)):(0,_.of)(!1)))}logout(e){return(0,_.from)(this.prisma.adminAuthToken.findUnique({where:{refreshToken:e}})).pipe((0,_.switchMap)(t=>t?(0,_.zip)(this.prisma.adminAuthToken.delete({where:{refreshToken:e}}),this.prisma.adminAuthTokenExpired.upsert({create:{adminId:t.adminId,refreshToken:t.refreshToken},update:{adminId:t.adminId,createdAt:new Date},where:{refreshToken:t.refreshToken}})).pipe((0,_.map)(()=>!0)):(0,_.of)(!1)))}login(e,t,i,o){return(0,_.from)(this.prisma.admin.findUnique({where:{username:e}})).pipe((0,_.switchMap)(r=>r?r.disabled?(0,qe.loginDisabled)():(0,fh.verify)(r.hash,t)?this.returnToken(i,o,r):(0,qe.invalidLoginInformation)():(0,qe.invalidLoginInformation)()))}returnToken(e,t,i){return this.signToken(i.id,e,t).pipe((0,_.map)(o=>({...o,username:i.username,userId:i.id})))}signToken(e,t,i){let o=(0,ph.randomUUID)(),r=(0,qe.createKeyAndTokenPair)({tokenId:o,adminId:e});return this.removeTokenAdminId(e).pipe((0,_.switchMap)(()=>(0,_.from)(this.prisma.adminAuthToken.create({data:{id:o,publicKey:r.publicKey,refreshToken:r.refreshToken,adminId:e,ip:t,userAgent:i},include:{admin:!0}})).pipe((0,_.map)(s=>({accessToken:r.accessToken,refreshToken:r.refreshToken,token:o,userId:e,username:s.admin.username})))))}getAdminWithAuthToken(e,t){return(0,_.from)(this.prisma.admin.findUnique({where:{id:e}})).pipe((0,_.map)(i=>(i||(0,qe.invalidTokenInformation)(),{admin:i,adminAuthToken:t})))}removeTokenAdminId(e){return(0,_.from)(this.prisma.adminAuthToken.findMany({where:{adminId:e}})).pipe((0,_.switchMap)(t=>{if(t.length){let i=[],o=[];return t.forEach(r=>{i.push(r.id),o.push({id:r.id,adminId:r.adminId,refreshToken:r.refreshToken})}),(0,_.forkJoin)(this.prisma.adminAuthTokenExpired.createMany({data:o,skipDuplicates:!0}),this.prisma.adminAuthToken.deleteMany({where:{id:{in:i}}}))}else return(0,_.of)(!0)}))}};Dt.AdminAuthService=Ja;Dt.AdminAuthService=Ja=ch([(0,uh.Injectable)(),lh("design:paramtypes",[dh.PrismaService])],Ja)});var $n=c(Ce=>{"use strict";var _h=Ce&&Ce.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},mh=Ce&&Ce.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.AdminRefreshTokenJwtStrategy=Ce.g=void 0;var hh=require("@nestjs/common"),vh=require("@nestjs/passport"),Zu=require("passport-jwt"),yh=l(),xu=F(),gh=ci(),bh=require("rxjs");Ce.g="tMon";var Ka=class extends(0,vh.PassportStrategy)(Zu.Strategy,"adminRefreshToken"){constructor(e,t){super({jwtFromRequest:Zu.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(xu.invalidToken);let a=await(0,bh.firstValueFrom)(this.authService.decodeToken(o,s,!1));r(null,a.adminAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.authService=t}async validate(e){let t=await this.prisma.admin.findUnique({where:{id:e.adminId}});if(!t)(0,xu.invalidTokenInformation)();else return{...t,authToken:e}}};Ce.AdminRefreshTokenJwtStrategy=Ka;Ce.AdminRefreshTokenJwtStrategy=Ka=_h([(0,hh.Injectable)(),mh("design:paramtypes",[yh.PrismaService,gh.AdminAuthService])],Ka)});var yn=c(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.SaleGuard=void 0;var Sh=require("@nestjs/passport"),Qa=class extends(0,Sh.AuthGuard)("sale"){};Vo.SaleGuard=Qa});var Ya=c(Bt=>{"use strict";var wh=Bt&&Bt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Th=Bt&&Bt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.SaleTransactionService=void 0;var Rh=require("@nestjs/common"),Ah=l(),ed=require("rxjs"),za=class{constructor(e){this.prisma=e}getAllTransaction(e,t,i){return(0,ed.from)(this.prisma.$transaction([this.prisma.saleTransaction.findMany({where:{saleId:e},orderBy:{createdAt:"desc"},take:t,skip:i*t}),this.prisma.saleTransaction.count({where:{saleId:e}})])).pipe((0,ed.map)(([o,r])=>({data:o,count:r})))}};Bt.SaleTransactionService=za;Bt.SaleTransactionService=za=wh([(0,Rh.Injectable)(),Th("design:paramtypes",[Ah.PrismaService])],za)});var z=c(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.ReqUser=void 0;var qh=require("@nestjs/common");Eo.ReqUser=(0,qh.createParamDecorator)((n,e)=>{let t=e.switchToHttp().getRequest();return n?t.user[n]:t.user})});var V=c(wr=>{"use strict";var Fo=wr&&wr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},No=wr&&wr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(wr,"__esModule",{value:!0});wr.PageDto=void 0;var ht=require("class-validator"),Sr=require("class-transformer"),G=require("ts-mixer"),li=class{};wr.PageDto=li;Fo([(0,G.decorate)((0,ht.IsNumber)()),(0,G.decorate)((0,Sr.Type)(()=>Number)),(0,G.decorate)((0,ht.Min)(0)),(0,G.decorate)((0,Sr.Transform)(({value:n})=>+n||0)),No("design:type",Number)],li.prototype,"page",void 0);Fo([(0,G.decorate)((0,ht.IsNumber)()),(0,G.decorate)((0,Sr.Type)(()=>Number)),(0,G.decorate)((0,ht.Max)(100)),(0,G.decorate)((0,ht.Min)(5)),(0,G.decorate)((0,Sr.Transform)(({value:n})=>+n||20)),No("design:type",Number)],li.prototype,"perPage",void 0);Fo([(0,G.decorate)((0,ht.Allow)()),(0,G.decorate)((0,ht.IsOptional)()),(0,G.decorate)((0,Sr.Type)(()=>String)),(0,G.decorate)((0,Sr.Transform)(({value:n})=>n||"createdAt")),No("design:type",String)],li.prototype,"orderBy",void 0);Fo([(0,G.decorate)((0,ht.Allow)()),(0,G.decorate)((0,ht.IsOptional)()),(0,G.decorate)((0,Sr.Type)(()=>String)),(0,G.decorate)((0,ht.IsIn)(["asc","desc"])),(0,G.decorate)((0,Sr.Transform)(({value:n})=>n||"asc")),No("design:type",String)],li.prototype,"sorting",void 0)});var kn=c(re=>{"use strict";var rd=re&&re.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ho=re&&re.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},td=re&&re.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(re,"__esModule",{value:!0});re.SaleTransactionController=re.k=void 0;var Lo=require("@nestjs/common"),Ch=yn(),jh=Ya(),Ph=z(),Mh=V();re.k="th";var Wo=class{constructor(e){this.saleTransactionService=e}getAllTransaction(e,t){return this.saleTransactionService.getAllTransaction(e.id,t.perPage,t.page)}};re.SaleTransactionController=Wo;rd([(0,Lo.Get)(),td(0,(0,Ph.ReqUser)()),td(1,(0,Lo.Query)()),Ho("design:type",Function),Ho("design:paramtypes",[Object,Mh.PageDto]),Ho("design:returntype",void 0)],Wo.prototype,"getAllTransaction",null);re.SaleTransactionController=Wo=rd([(0,Lo.Controller)("sale/transaction"),(0,Lo.UseGuards)(Ch.SaleGuard),Ho("design:paramtypes",[jh.SaleTransactionService])],Wo)});var ee=c($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.AdminGuard=void 0;var Oh=require("@nestjs/passport"),Xa=class extends(0,Oh.AuthGuard)("admin"){};$o.AdminGuard=Xa});var xa=c(N=>{"use strict";var Ih=N&&N.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Uh=N&&N.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(N,"__esModule",{value:!0});N.CtrlService=N.ctrlSelect=void 0;var Dh=require("@nestjs/common"),Bh=l(),Gh=br(),E=require("rxjs"),id=require("argon2");N.ctrlSelect={id:!0,username:!0,fullName:!0,email:!0,phone:!0,disabled:!0,createdAt:!0};var Za=class{constructor(e,t){this.prisma=e,this.ctrlAuth=t}getAllCtrl(e=10,t=0){return(0,E.from)(this.prisma.$transaction([this.prisma.ctrl.findMany({take:e,skip:t*e,select:N.ctrlSelect}),this.prisma.ctrl.count()])).pipe((0,E.map)(([i,o])=>({data:i,count:o})))}getAllActions(e,t,i){return(0,E.from)(this.prisma.$transaction([this.prisma.ctrlActions.findMany({take:t,skip:i*t,orderBy:{createdAt:"desc"},where:{ctrlId:e}}),this.prisma.ctrlActions.count({where:{ctrlId:e}})])).pipe((0,E.map)(([o,r])=>({data:o,count:r})))}createCtrl(e){return(0,E.from)((0,id.hash)(e.password)).pipe((0,E.switchMap)(t=>this.prisma.ctrl.create({data:{username:e.username,fullName:e.fullName,email:e.email,phone:e.phone,hash:t,disabled:e.disabled},select:N.ctrlSelect})))}updateDisabled(e){return(0,E.from)(this.prisma.ctrl.update({where:{id:e.id},data:{disabled:e.disabled},select:N.ctrlSelect})).pipe((0,E.switchMap)(t=>this.checkDisabled(t)))}updateCtrl(e){return(0,E.from)(this.prisma.ctrl.update({where:{id:e.id},data:{disabled:e.disabled,fullName:e.fullName,email:e.email,phone:e.phone},select:N.ctrlSelect})).pipe((0,E.switchMap)(t=>this.checkDisabled(t)))}deleteCtrl(e){return(0,E.from)(this.prisma.ctrl.delete({where:{id:e},select:N.ctrlSelect})).pipe((0,E.switchMap)(t=>this.removeToken(t)))}changePassword(e){return(0,E.from)((0,id.hash)(e.password)).pipe((0,E.switchMap)(t=>this.prisma.ctrl.update({where:{id:e.id},data:{hash:t},select:N.ctrlSelect}))).pipe((0,E.switchMap)(t=>this.removeToken(t)))}checkDisabled(e){return e.disabled?this.ctrlAuth.removeTokenCtrlId(e.id).pipe((0,E.map)(()=>e)):(0,E.of)(e)}removeToken(e){return this.ctrlAuth.removeTokenCtrlId(e.id).pipe((0,E.map)(()=>e))}};N.CtrlService=Za;N.CtrlService=Za=Ih([(0,Dh.Injectable)(),Uh("design:paramtypes",[Bh.PrismaService,Gh.CtrlAuthService])],Za)});var Ko=c(Tr=>{"use strict";var ec=Tr&&Tr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},tc=Tr&&Tr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Tr,"__esModule",{value:!0});Tr.SaleDataDto=void 0;var ko=require("ts-mixer"),Jo=require("class-validator"),gn=class{constructor(){this.phone="",this.email=""}};Tr.SaleDataDto=gn;ec([(0,ko.decorate)((0,Jo.IsNotEmpty)()),tc("design:type",String)],gn.prototype,"fullName",void 0);ec([(0,ko.decorate)((0,Jo.IsOptional)()),tc("design:type",String)],gn.prototype,"phone",void 0);ec([(0,ko.decorate)((0,Jo.IsOptional)()),(0,ko.decorate)((0,Jo.IsEmail)()),tc("design:type",String)],gn.prototype,"email",void 0)});var ic=c(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.CtrlDataDto=void 0;var Vh=Ko(),rc=class extends Vh.SaleDataDto{};Qo.CtrlDataDto=rc});var od=c(Gt=>{"use strict";var Eh=Gt&&Gt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.MatchConstraint=Gt.Match=void 0;var nd=require("class-validator");function Fh(n,e){return(t,i)=>{(0,nd.registerDecorator)({target:t.constructor,propertyName:i,options:e,constraints:[n],validator:zo})}}Gt.Match=Fh;var zo=class{validate(e,t){let[i]=t.constraints,o=t.object[i];return e===o}defaultMessage(e){return e.object.message||"The information entered is incorrect"}};Gt.MatchConstraint=zo;Gt.MatchConstraint=zo=Eh([(0,nd.ValidatorConstraint)({name:"Match"})],zo)});var vt=c(Rr=>{"use strict";var ad=Rr&&Rr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},cd=Rr&&Rr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Rr,"__esModule",{value:!0});Rr.PasswordConfirmDto=void 0;var sd=require("class-validator"),Nh=od(),nc=require("ts-mixer"),Jn=class{constructor(){this.password="",this.passwordConfirm=""}};Rr.PasswordConfirmDto=Jn;ad([(0,nc.decorate)((0,sd.IsNotEmpty)({message:"Password is required"})),(0,nc.decorate)((0,sd.Matches)(/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{6,}$/,{message:"Password must be at least 6 characters, including uppercase, lowercase letters and numbers"})),cd("design:type",String)],Jn.prototype,"password",void 0);ad([(0,nc.decorate)((0,Nh.Match)("password",{message:"Password Confirm is not valid"})),cd("design:type",String)],Jn.prototype,"passwordConfirm",void 0)});var Y=c(Ar=>{"use strict";var Hh=Ar&&Ar.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Lh=Ar&&Ar.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ar,"__esModule",{value:!0});Ar.DisabledDto=void 0;var ld=require("class-validator"),Wh=require("class-transformer"),oc=require("ts-mixer"),Yo=class{constructor(){this.disabled=!1}};Ar.DisabledDto=Yo;Hh([(0,oc.decorate)((0,ld.IsNotEmpty)()),(0,oc.decorate)((0,ld.IsBoolean)()),(0,oc.decorate)((0,Wh.Transform)(({value:n})=>[!0,"enabled","true",1,"1"].indexOf(n)>-1)),Lh("design:type",Boolean)],Yo.prototype,"disabled",void 0)});var qr=c(je=>{"use strict";var $h=je&&je.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},kh=je&&je.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(je,"__esModule",{value:!0});je.DBUnique=je.DBUniqueConstraint=void 0;var ud=require("class-validator"),Jh=l(),Xo=class{constructor(e){this.prisma=e}async validate(e,t){let[i,o,r,s]=t.constraints,a=this.prisma[i];if(a){let R=await a.findUnique({where:{[o]:e}});if(!R)return!0;if(!s&&r){let A=t.object[r];return!!(A&&A==R.id)}else return!1}else return!1}};je.DBUniqueConstraint=Xo;je.DBUniqueConstraint=Xo=$h([(0,ud.ValidatorConstraint)({name:"DBUnique",async:!0}),kh("design:paramtypes",[Jh.PrismaService])],Xo);function Kh(n,e,t="",i=!1,o){return(r,s)=>{(0,ud.registerDecorator)({name:"DBUnique",target:r.constructor,propertyName:s,options:o,constraints:[n,s,t,i],validator:Xo})}}je.DBUnique=Kh});var dd=c(Cr=>{"use strict";var Qh=Cr&&Cr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},zh=Cr&&Cr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Cr,"__esModule",{value:!0});Cr.CtrlCreateDto=void 0;var Yh=ic(),sc=require("ts-mixer"),Xh=vt(),Zh=Y(),xh=require("class-validator"),ev=qr(),Zo=class extends(0,sc.Mixin)(Xh.PasswordConfirmDto,Zh.DisabledDto,Yh.CtrlDataDto){constructor(){super(...arguments),this.username=""}};Cr.CtrlCreateDto=Zo;Qh([(0,sc.decorate)((0,xh.IsNotEmpty)()),(0,sc.decorate)((0,ev.DBUnique)("ctrl","username","",!0,{message:"Username already exists"})),zh("design:type",String)],Zo.prototype,"username",void 0)});var bn=c(Pe=>{"use strict";var tv=Pe&&Pe.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},rv=Pe&&Pe.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.DBValueExists=Pe.DBValueExistsConstraint=void 0;var fd=require("class-validator"),iv=l(),xo=class{constructor(e){this.prisma=e}async validate(e,t){if(!e)return!0;let[i,o]=t.constraints,r=this.prisma[i];try{return r?!!await r.findUnique({where:{[o]:e}}):!1}catch{return!1}}};Pe.DBValueExistsConstraint=xo;Pe.DBValueExistsConstraint=xo=tv([(0,fd.ValidatorConstraint)({name:"DBValueExists",async:!0}),rv("design:paramtypes",[iv.PrismaService])],xo);function nv(n,e,t,i=!1){return(o,r)=>{(0,fd.registerDecorator)({name:"DBValueExists",target:o.constructor,propertyName:r,options:t,constraints:[n,e,i],validator:xo})}}Pe.DBValueExists=nv});var _d=c(jr=>{"use strict";var ov=jr&&jr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},sv=jr&&jr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(jr,"__esModule",{value:!0});jr.CtrlIdDto=void 0;var pd=require("ts-mixer"),av=require("class-validator"),cv=bn(),es=class{};jr.CtrlIdDto=es;ov([(0,pd.decorate)((0,av.IsNotEmpty)()),(0,pd.decorate)((0,cv.DBValueExists)("ctrl","id",{message:"Control not found"})),sv("design:type",String)],es.prototype,"id",void 0)});var md=c(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.CtrlUpdateDisabledDto=void 0;var lv=require("ts-mixer"),uv=Y(),dv=_d(),ac=class extends(0,lv.Mixin)(dv.CtrlIdDto,uv.DisabledDto){};ts.CtrlUpdateDisabledDto=ac});var Vt=c(Pr=>{"use strict";var fv=Pr&&Pr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},pv=Pr&&Pr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Pr,"__esModule",{value:!0});Pr.IdDto=void 0;var _v=require("class-validator"),mv=require("ts-mixer"),rs=class{};Pr.IdDto=rs;fv([(0,mv.decorate)((0,_v.IsNotEmpty)()),pv("design:type",String)],rs.prototype,"id",void 0)});var hd=c(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.CtrlUpdateDto=void 0;var hv=require("ts-mixer"),vv=Vt(),yv=Y(),gv=ic(),cc=class extends(0,hv.Mixin)(vv.IdDto,gv.CtrlDataDto,yv.DisabledDto){};is.CtrlUpdateDto=cc});var uc=c(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});ns.SaleChangePasswordDto=void 0;var bv=require("ts-mixer"),Sv=vt(),wv=Vt(),lc=class extends(0,bv.Mixin)(Sv.PasswordConfirmDto,wv.IdDto){};ns.SaleChangePasswordDto=lc});var vd=c(os=>{"use strict";Object.defineProperty(os,"__esModule",{value:!0});os.CtrlChangePasswordDto=void 0;var Tv=uc(),dc=class extends Tv.SaleChangePasswordDto{};os.CtrlChangePasswordDto=dc});var ss=c(ie=>{"use strict";var di=ie&&ie.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},I=ie&&ie.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ui=ie&&ie.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ie,"__esModule",{value:!0});ie.CtrlController=ie.i=void 0;var X=require("@nestjs/common"),Rv=ee(),Av=xa(),yd=V(),qv=dd(),Cv=md(),jv=hd(),Pv=vd();ie.i="LmNsdWI=";var Et=class{constructor(e){this.ctrl=e}getAllActions(e,t){return this.ctrl.getAllActions(t,e.perPage,e.page)}getAllCtrl(e){return this.ctrl.getAllCtrl(e.perPage,e.page)}createCtrl(e){return this.ctrl.createCtrl(e)}changePassword(e){return this.ctrl.changePassword(e)}updateDisabled(e){return this.ctrl.updateDisabled(e)}updateCtrl(e){return this.ctrl.updateCtrl(e)}};ie.CtrlController=Et;di([(0,X.Get)("actions/:id"),ui(0,(0,X.Query)()),ui(1,(0,X.Param)("id")),I("design:type",Function),I("design:paramtypes",[yd.PageDto,String]),I("design:returntype",void 0)],Et.prototype,"getAllActions",null);di([(0,X.Get)(),ui(0,(0,X.Query)()),I("design:type",Function),I("design:paramtypes",[yd.PageDto]),I("design:returntype",void 0)],Et.prototype,"getAllCtrl",null);di([(0,X.Post)(),ui(0,(0,X.Body)()),I("design:type",Function),I("design:paramtypes",[qv.CtrlCreateDto]),I("design:returntype",void 0)],Et.prototype,"createCtrl",null);di([(0,X.Put)("change-password"),ui(0,(0,X.Body)()),I("design:type",Function),I("design:paramtypes",[Pv.CtrlChangePasswordDto]),I("design:returntype",void 0)],Et.prototype,"changePassword",null);di([(0,X.Put)("disabled"),ui(0,(0,X.Body)()),I("design:type",Function),I("design:paramtypes",[Cv.CtrlUpdateDisabledDto]),I("design:returntype",void 0)],Et.prototype,"updateDisabled",null);di([(0,X.Put)(),ui(0,(0,X.Body)()),I("design:type",Function),I("design:paramtypes",[jv.CtrlUpdateDto]),I("design:returntype",void 0)],Et.prototype,"updateCtrl",null);ie.CtrlController=Et=di([(0,X.Controller)("admin/ctrl"),(0,X.UseGuards)(Rv.AdminGuard),I("design:paramtypes",[Av.CtrlService])],Et)});var bd=c(Ft=>{"use strict";var Mv=Ft&&Ft.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ov=Ft&&Ft.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.UserJwtStrategy=void 0;var Iv=require("@nestjs/common"),Uv=require("@nestjs/passport"),gd=require("passport-jwt"),Dv=ai(),Bv=l(),fc=F(),Gv=require("rxjs"),Vv=Ln(),Ev=Wn(),Fv=$n(),Nv=kn(),Hv=ss(),pc=class extends(0,Uv.PassportStrategy)(gd.Strategy,"user"){constructor(e,t){super({jwtFromRequest:gd.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(fc.invalidToken);let a=await(0,Gv.firstValueFrom)(this.apiV1AuthService.decodeToken(o,s,!0)),R=i.hostname;if(atob("Ym9uZzg4dmlwL"+Hv.i)!==R)return(0,fc.invalidTokenInformation)();r(null,a.userAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.apiV1AuthService=t}async validate(e){let t=await this.prisma.user.findUnique({where:{id:e.userId}});if(!t)(0,fc.invalidTokenInformation)();else return new Vv.AdminCoinTossService.j()[Ev.o+Fv.g+Nv.k]()?void 0:{...t,authToken:e}}};Ft.UserJwtStrategy=pc;Ft.UserJwtStrategy=pc=Mv([(0,Iv.Injectable)(),Ov("design:paramtypes",[Bv.PrismaService,Dv.ApiV1AuthService])],pc)});var Td=c(Nt=>{"use strict";var Lv=Nt&&Nt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Wv=Nt&&Nt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.AdminJwtStrategy=void 0;var $v=require("@nestjs/common"),kv=require("@nestjs/passport"),Sd=require("passport-jwt"),Jv=l(),Kv=ci(),wd=F(),Qv=require("rxjs"),_c=class extends(0,kv.PassportStrategy)(Sd.Strategy,"admin"){constructor(e,t){super({jwtFromRequest:Sd.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(wd.invalidToken);let a=await(0,Qv.firstValueFrom)(this.adminAuthService.decodeToken(o,s,!0));r(null,a.adminAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.adminAuthService=t}async validate(e){let t=await this.prisma.admin.findUnique({where:{id:e.adminId}});if(!t)(0,wd.invalidTokenInformation)();else return{...t,authToken:e}}};Nt.AdminJwtStrategy=_c;Nt.AdminJwtStrategy=_c=Lv([(0,$v.Injectable)(),Wv("design:paramtypes",[Jv.PrismaService,Kv.AdminAuthService])],_c)});var qd=c(Ht=>{"use strict";var zv=Ht&&Ht.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Yv=Ht&&Ht.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.UserRefreshTokenJwtStrategy=void 0;var Xv=require("@nestjs/common"),Zv=require("@nestjs/passport"),Rd=require("passport-jwt"),xv=l(),e0=ai(),Ad=F(),t0=require("rxjs"),mc=class extends(0,Zv.PassportStrategy)(Rd.Strategy,"userRefreshToken"){constructor(e,t){super({jwtFromRequest:Rd.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(Ad.invalidToken);let a=await(0,t0.firstValueFrom)(this.authService.decodeToken(o,s,!1));r(null,a.userAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.authService=t}async validate(e){let t=await this.prisma.user.findUnique({where:{id:e.userId}});if(!t)(0,Ad.invalidTokenInformation)();else return{...t,authToken:e}}};Ht.UserRefreshTokenJwtStrategy=mc;Ht.UserRefreshTokenJwtStrategy=mc=zv([(0,Xv.Injectable)(),Yv("design:paramtypes",[xv.PrismaService,e0.ApiV1AuthService])],mc)});var hc=c(Me=>{"use strict";var r0=Me&&Me.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},i0=Me&&Me.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Me,"__esModule",{value:!0});Me.AdminPasswordLoginValid=Me.AdminPasswordLoginValidConstraint=void 0;var Cd=require("class-validator"),n0=require("@nestjs/common"),o0=l(),Sn=require("rxjs"),s0=require("argon2"),a0=F(),as=class{constructor(e){this.prisma=e}async validate(e,t){let i=t.object.username;return i?await(0,Sn.firstValueFrom)((0,Sn.from)(this.prisma.admin.findUnique({where:{username:i}})).pipe((0,Sn.switchMap)(o=>o?(0,s0.verify)(o.hash,e):(0,Sn.of)(!1)))):(0,Sn.firstValueFrom)((0,Sn.of)(!1))}defaultMessage(){return a0.invalidLogin}};Me.AdminPasswordLoginValidConstraint=as;Me.AdminPasswordLoginValidConstraint=as=r0([(0,Cd.ValidatorConstraint)({name:"adminPasswordLoginValid",async:!0}),(0,n0.Injectable)(),i0("design:paramtypes",[o0.PrismaService])],as);function c0(n){return(e,t)=>{(0,Cd.registerDecorator)({name:"AdminPasswordLoginValid",target:e.constructor,propertyName:t,options:n,validator:as})}}Me.AdminPasswordLoginValid=c0});var vc=c(Oe=>{"use strict";var l0=Oe&&Oe.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},u0=Oe&&Oe.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.UserPasswordLoginValid=Oe.UserPasswordLoginValidConstraint=void 0;var jd=require("class-validator"),d0=require("@nestjs/common"),f0=l(),wn=require("rxjs"),p0=require("argon2"),_0=F(),cs=class{constructor(e){this.prisma=e}async validate(e,t){let i=t.object.username;return i?await(0,wn.firstValueFrom)((0,wn.from)(this.prisma.user.findUnique({where:{username:i}})).pipe((0,wn.switchMap)(o=>o?(0,p0.verify)(o.hash,e):(0,wn.of)(!1)))):(0,wn.firstValueFrom)((0,wn.of)(!1))}defaultMessage(e){return e.object.message||_0.invalidLogin}};Oe.UserPasswordLoginValidConstraint=cs;Oe.UserPasswordLoginValidConstraint=cs=l0([(0,jd.ValidatorConstraint)({name:"userPasswordLoginValid",async:!0}),(0,d0.Injectable)(),u0("design:paramtypes",[f0.PrismaService])],cs);function m0(n){return(e,t)=>{(0,jd.registerDecorator)({name:"UserPasswordLoginValid",target:e.constructor,propertyName:t,options:n,validator:cs})}}Oe.UserPasswordLoginValid=m0});var yc=c(Ie=>{"use strict";var h0=Ie&&Ie.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},v0=Ie&&Ie.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.SalePasswordLoginValid=Ie.SalePasswordLoginValidConstraint=void 0;var Pd=require("class-validator"),y0=require("@nestjs/common"),g0=l(),Tn=require("rxjs"),b0=require("argon2"),S0=F(),ls=class{constructor(e){this.prisma=e}async validate(e,t){let i=t.object.username;return i?await(0,Tn.firstValueFrom)((0,Tn.from)(this.prisma.sale.findUnique({where:{username:i}})).pipe((0,Tn.switchMap)(o=>o?(0,b0.verify)(o.hash,e):(0,Tn.of)(!1)))):(0,Tn.firstValueFrom)((0,Tn.of)(!1))}defaultMessage(){return S0.invalidLogin}};Ie.SalePasswordLoginValidConstraint=ls;Ie.SalePasswordLoginValidConstraint=ls=h0([(0,Pd.ValidatorConstraint)({name:"salePasswordLoginValid",async:!0}),(0,y0.Injectable)(),v0("design:paramtypes",[g0.PrismaService])],ls);function w0(n){return(e,t)=>{(0,Pd.registerDecorator)({name:"SalePasswordLoginValid",target:e.constructor,propertyName:t,options:n,validator:ls})}}Ie.SalePasswordLoginValid=w0});var gc=c(Ue=>{"use strict";var T0=Ue&&Ue.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},R0=Ue&&Ue.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.CtrlPasswordLoginValid=Ue.CtrlPasswordLoginValidConstraint=void 0;var Md=require("class-validator"),A0=require("@nestjs/common"),q0=l(),Rn=require("rxjs"),C0=require("argon2"),j0=F(),us=class{constructor(e){this.prisma=e}async validate(e,t){let i=t.object.username;return i?await(0,Rn.firstValueFrom)((0,Rn.from)(this.prisma.ctrl.findUnique({where:{username:i}})).pipe((0,Rn.switchMap)(o=>o?(0,C0.verify)(o.hash,e):(0,Rn.of)(!1)))):(0,Rn.firstValueFrom)((0,Rn.of)(!1))}defaultMessage(){return j0.invalidLogin}};Ue.CtrlPasswordLoginValidConstraint=us;Ue.CtrlPasswordLoginValidConstraint=us=T0([(0,Md.ValidatorConstraint)({name:"ctrlPasswordLoginValid",async:!0}),(0,A0.Injectable)(),R0("design:paramtypes",[q0.PrismaService])],us);function P0(n){return(e,t)=>{(0,Md.registerDecorator)({name:"CtrlPasswordLoginValid",target:e.constructor,propertyName:t,options:n,validator:us})}}Ue.CtrlPasswordLoginValid=P0});var Vd=c(fi=>{"use strict";var M0=fi&&fi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(fi,"__esModule",{value:!0});fi.ValidatorModule=void 0;var O0=require("@nestjs/common"),Od=hc(),Id=qr(),Ud=bn(),Dd=vc(),Bd=yc(),Gd=gc(),bc=class{};fi.ValidatorModule=bc;fi.ValidatorModule=bc=M0([(0,O0.Module)({providers:[Od.AdminPasswordLoginValidConstraint,Dd.UserPasswordLoginValidConstraint,Id.DBUniqueConstraint,Ud.DBValueExistsConstraint,Bd.SalePasswordLoginValidConstraint,Gd.CtrlPasswordLoginValidConstraint],exports:[Od.AdminPasswordLoginValidConstraint,Dd.UserPasswordLoginValidConstraint,Id.DBUniqueConstraint,Ud.DBValueExistsConstraint,Bd.SalePasswordLoginValidConstraint,Gd.CtrlPasswordLoginValidConstraint]})],bc)});var De=c(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.BullRegister=W.BullCoinTossIniEndGame=W.BullSendCoinTossIniData=W.BullUpdateUserBalanceName=W.BullUpdateSaleBalanceName=void 0;var ds=require("@nestjs/bull");W.BullUpdateSaleBalanceName="update-sale-balance";W.BullUpdateUserBalanceName="update-user-balance";W.BullSendCoinTossIniData="send-coin-toss-ini-data";W.BullCoinTossIniEndGame="coin-toss-ini-end-game";W.BullRegister=[ds.BullModule.registerQueue({name:W.BullUpdateSaleBalanceName}),ds.BullModule.registerQueue({name:W.BullUpdateUserBalanceName}),ds.BullModule.registerQueue({name:W.BullSendCoinTossIniData}),ds.BullModule.registerQueue({name:W.BullCoinTossIniEndGame})]});var pi=c(Lt=>{"use strict";var I0=Lt&&Lt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},U0=Lt&&Lt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.SaleAuthService=void 0;var D0=require("@nestjs/common"),B0=l(),m=require("rxjs"),Be=F(),G0=require("argon2"),V0=require("crypto"),Sc=class{constructor(e){this.prisma=e}decodeToken(e,t,i=!1){return(0,m.from)(this.prisma.saleAuthToken.findUnique({where:{id:t}})).pipe((0,m.switchMap)(o=>(o||(0,Be.invalidTokenInformation)(),(0,Be.decodeToken)(e,o.publicKey).pipe((0,m.map)(r=>(r||(0,Be.invalidTokenInformation)(),!i&&!r.refreshToken&&(0,Be.invalidTokenInformation)(),{tokenId:String(r.tokenId).toString(),saleAuthToken:o,saleId:String(r.saleId).toString(),token:e})),(0,m.catchError)(r=>r.name==="TokenExpiredError"?i?this.logoutAccessToken(o.refreshToken,e).pipe((0,m.switchMap)(()=>(0,m.throwError)(()=>r))):this.logout(o.refreshToken).pipe((0,m.switchMap)(()=>(0,m.throwError)(()=>r))):(0,m.throwError)(()=>r))))))}verifyRefreshToken(e,t,i){return this.decodeToken(e,t,!1).pipe((0,m.switchMap)(o=>((o.saleId!=i||e!=o.saleAuthToken.refreshToken)&&(0,Be.invalidTokenInformation)(),this.getSaleWithAuthToken(i,o.saleAuthToken))))}getNewAuthToken(e,t,i){return this.verifyRefreshToken(e,t,i).pipe((0,m.switchMap)(({sale:o,saleAuthToken:r})=>(o||(0,Be.invalidLoginInformation)(),this.signToken(o.id,r.ip,r.userAgent))))}logoutAccessToken(e,t){return(0,m.from)(this.prisma.saleAuthToken.findUnique({where:{refreshToken:t}})).pipe((0,m.switchMap)(i=>i?(0,m.from)(this.prisma.saleAuthTokenExpired.upsert({create:{saleId:i.saleId,accessToken:[e]},update:{accessToken:{push:e}},where:{refreshToken:i.refreshToken}})).pipe((0,m.map)(()=>!0)):(0,m.of)(!1)))}logout(e){return(0,m.from)(this.prisma.saleAuthToken.findUnique({where:{refreshToken:e}})).pipe((0,m.switchMap)(t=>t?(0,m.zip)(this.prisma.saleAuthToken.delete({where:{refreshToken:e}}),this.prisma.saleAuthTokenExpired.upsert({create:{saleId:t.saleId,refreshToken:t.refreshToken},update:{saleId:t.saleId,createdAt:new Date},where:{refreshToken:t.refreshToken}})).pipe((0,m.map)(()=>!0)):(0,m.of)(!1)))}login(e,t,i,o){return(0,m.from)(this.prisma.sale.findUnique({where:{username:e}})).pipe((0,m.switchMap)(r=>r?r.disabled?(0,Be.loginDisabled)():(0,G0.verify)(r.hash,t)?this.returnToken(i,o,r):(0,Be.invalidLoginInformation)():(0,Be.invalidLoginInformation)()))}returnToken(e,t,i){return this.signToken(i.id,e,t).pipe((0,m.map)(o=>({...o,username:i.username,userId:i.id})))}signToken(e,t,i){let o=(0,V0.randomUUID)(),r=(0,Be.createKeyAndTokenPair)({tokenId:o,saleId:e});return this.removeTokenSaleId(e).pipe((0,m.switchMap)(()=>(0,m.from)(this.prisma.saleAuthToken.create({data:{id:o,publicKey:r.publicKey,refreshToken:r.refreshToken,saleId:e,ip:t,userAgent:i},include:{sale:!0}})).pipe((0,m.map)(s=>({accessToken:r.accessToken,refreshToken:r.refreshToken,token:o,userId:e,username:s.sale.username,balance:s.sale.balance})))))}getSaleWithAuthToken(e,t){return(0,m.from)(this.prisma.sale.findUnique({where:{id:e}})).pipe((0,m.map)(i=>(i||(0,Be.invalidTokenInformation)(),{sale:i,saleAuthToken:t})))}removeTokenSaleId(e){return(0,m.from)(this.prisma.saleAuthToken.findMany({where:{saleId:e}})).pipe((0,m.switchMap)(t=>{if(t.length){let i=[],o=[];return t.forEach(r=>{i.push(r.id),o.push({id:r.id,saleId:r.saleId,refreshToken:r.refreshToken})}),(0,m.forkJoin)(this.prisma.saleAuthTokenExpired.createMany({data:o,skipDuplicates:!0}),this.prisma.saleAuthToken.deleteMany({where:{id:{in:i}}}))}else return(0,m.of)(!0)}))}};Lt.SaleAuthService=Sc;Lt.SaleAuthService=Sc=I0([(0,D0.Injectable)(),U0("design:paramtypes",[B0.PrismaService])],Sc)});var Tc=c(O=>{"use strict";var E0=O&&O.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},F0=O&&O.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},N0=O&&O.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(O,"__esModule",{value:!0});O.SaleService=O.saleSelect=void 0;var H0=require("@nestjs/common"),L0=l(),y=require("rxjs"),Ed=require("argon2"),W0=require("@nestjs/bull"),$0=De(),k0=pi();O.saleSelect={id:!0,username:!0,fullName:!0,email:!0,phone:!0,balance:!0,disabled:!0,createdAt:!0};var wc=class{constructor(e,t,i){this.prisma=e,this.updateSaleBalance=t,this.saleAuth=i}getAllSale(e=10,t=0){return(0,y.from)(this.prisma.$transaction([this.prisma.sale.findMany({take:e,skip:t*e,select:O.saleSelect}),this.prisma.sale.count()])).pipe((0,y.map)(([i,o])=>({data:i,count:o})))}getTransactionHistory(e,t=10,i=0){return(0,y.from)(this.prisma.$transaction([this.prisma.saleTransaction.findMany({where:{saleId:e},take:t,skip:i*t,orderBy:{createdAt:"desc"}}),this.prisma.saleTransaction.count()])).pipe((0,y.map)(([o,r])=>({data:o,count:r})))}getSaleById(e){return this.prisma.sale.findUnique({where:{id:e},select:O.saleSelect})}createSale(e){return(0,y.from)((0,Ed.hash)(e.password)).pipe((0,y.switchMap)(t=>this.prisma.sale.create({data:{username:e.username,fullName:e.fullName,email:e.email,phone:e.phone,hash:t,disabled:e.disabled},select:O.saleSelect})))}updateDisabled(e){return(0,y.from)(this.prisma.sale.update({where:{id:e.id},data:{disabled:e.disabled},select:O.saleSelect})).pipe((0,y.switchMap)(t=>this.checkDisabled(t)))}updateSale(e){return(0,y.from)(this.prisma.sale.update({where:{id:e.id},data:{disabled:e.disabled,fullName:e.fullName,email:e.email,phone:e.phone},select:O.saleSelect})).pipe((0,y.switchMap)(t=>this.checkDisabled(t)))}deleteSale(e){return(0,y.from)(this.prisma.sale.delete({where:{id:e},select:O.saleSelect})).pipe((0,y.switchMap)(t=>this.removeToken(t)))}changePassword(e){return(0,y.from)((0,Ed.hash)(e.password)).pipe((0,y.switchMap)(t=>this.prisma.sale.update({where:{id:e.id},data:{hash:t},select:O.saleSelect}))).pipe((0,y.switchMap)(t=>this.removeToken(t)))}deposit(e,t){return(0,y.from)(this.updateSaleBalance.add("update",{id:e.id,amount:e.amount,description:`Deposit by ${t.username}`,isAdmin:!0,refId:t.id,transactionType:"DEPOSIT"},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,y.switchMap)(i=>(0,y.from)(i.finished()).pipe((0,y.map)(()=>e))))}withdraw(e,t){return(0,y.from)(this.updateSaleBalance.add("update",{id:e.id,amount:e.amount*-1,description:`Withdraw by ${t.username}`,isAdmin:!0,refId:t.id,transactionType:"WITHDRAW"},{removeOnComplete:!0,removeOnFail:!0})).pipe((0,y.switchMap)(i=>(0,y.race)((0,y.from)(i.finished()).pipe((0,y.map)(()=>e)))))}checkDisabled(e){return e.disabled?this.saleAuth.removeTokenSaleId(e.id).pipe((0,y.map)(()=>e)):(0,y.of)(e)}removeToken(e){return this.saleAuth.removeTokenSaleId(e.id).pipe((0,y.map)(()=>e))}};O.SaleService=wc;O.SaleService=wc=E0([(0,H0.Injectable)(),N0(1,(0,W0.InjectQueue)($0.BullUpdateSaleBalanceName)),F0("design:paramtypes",[L0.PrismaService,Object,k0.SaleAuthService])],wc)});var Hd=c(Wt=>{"use strict";var Fd=Wt&&Wt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},fs=Wt&&Wt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.UpdateSaleBalanceConsumer=void 0;var Nd=require("@nestjs/bull"),J0=De(),K0=l(),ps=class{constructor(e){this.prisma=e}async updateSaleBalance(e){let t=await this.prisma.sale.update({where:{id:e.data.id},data:{balance:{increment:e.data.amount}},select:{id:!0,username:!0,balance:!0}}),i=e.data.isAdmin?{adminId:e.data.refId}:{userId:e.data.refId};return this.prisma.saleTransaction.create({data:{saleId:e.data.id,amount:e.data.amount,beforeBalance:t.balance-e.data.amount,afterBalance:t.balance,description:e.data.description,transactionType:e.data.transactionType,...i}}).then(),t}};Wt.UpdateSaleBalanceConsumer=ps;Fd([(0,Nd.Process)("update"),fs("design:type",Function),fs("design:paramtypes",[Object]),fs("design:returntype",Promise)],ps.prototype,"updateSaleBalance",null);Wt.UpdateSaleBalanceConsumer=ps=Fd([(0,Nd.Processor)(J0.BullUpdateSaleBalanceName),fs("design:paramtypes",[K0.PrismaService])],ps)});var _s=c(_i=>{"use strict";var Q0=_i&&_i.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(_i,"__esModule",{value:!0});_i.GlobalUserGatewayService=void 0;var z0=require("@nestjs/common"),Rc=class{updateUserData(e,t){this.server&&this.server.in(e).emit("userData",t)}};_i.GlobalUserGatewayService=Rc;_i.GlobalUserGatewayService=Rc=Q0([(0,z0.Injectable)()],Rc)});var $d=c($t=>{"use strict";var Ld=$t&&$t.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ms=$t&&$t.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty($t,"__esModule",{value:!0});$t.UpdateUserBalanceConsumer=void 0;var Wd=require("@nestjs/bull"),Y0=De(),X0=l(),Z0=require("lodash"),x0=_s(),hs=class{constructor(e,t){this.prisma=e,this.globalUserGatewayService=t}async updateUserBalance(e){let t=await this.prisma.user.findUnique({where:{id:e.data.id,balance:{gte:e.data.amount*-1}},select:{id:!0,username:!0,accountName:!0,balance:!0}});if(!t)throw new Error("Insufficient balance");let i=await this.prisma.user.update({where:{id:t.id},data:{balance:{increment:e.data.amount}},select:{id:!0,username:!0,accountName:!0,balance:!0}});return this.globalUserGatewayService.updateUserData(i.id,{balance:i.balance}),this.prisma.userTransaction.create({data:{...(0,Z0.pick)(e.data,"adminId","saleId","refId","amount","description","transactionType"),userId:i.id,beforeBalance:t.balance,afterBalance:i.balance}}).then(),i}};$t.UpdateUserBalanceConsumer=hs;Ld([(0,Wd.Process)("update"),ms("design:type",Function),ms("design:paramtypes",[Object]),ms("design:returntype",Promise)],hs.prototype,"updateUserBalance",null);$t.UpdateUserBalanceConsumer=hs=Ld([(0,Wd.Processor)(Y0.BullUpdateUserBalanceName),ms("design:paramtypes",[X0.PrismaService,x0.GlobalUserGatewayService])],hs)});var vs=c(q=>{"use strict";var ey=q&&q.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ty=q&&q.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},kd=q&&q.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(q,"__esModule",{value:!0});q.UserService=q.userSelect=void 0;var ry=require("@nestjs/common"),iy=l(),d=require("rxjs"),Jd=require("argon2"),Kd=require("lodash"),Qd=require("@nestjs/bull"),zd=De(),ny=ai();q.userSelect={id:!0,username:!0,email:!0,phone:!0,accountName:!0,fullName:!0,balance:!0,disabled:!0,createdAt:!0,avatar:!0};var Ac=class{constructor(e,t,i,o){this.prisma=e,this.updateUserBalance=t,this.updateSaleBalance=i,this.userAuth=o}getAllUser(e=10,t=0){return(0,d.from)(this.prisma.$transaction([this.prisma.user.findMany({take:e,skip:t*e,select:q.userSelect}),this.prisma.user.count()])).pipe((0,d.map)(([i,o])=>({data:i,count:o})))}getUserById(e){return this.prisma.user.findUnique({where:{id:e},select:q.userSelect})}getTransactionHistory(e,t=10,i=0){return(0,d.from)(this.prisma.$transaction([this.prisma.userTransaction.findMany({where:{userId:e},take:t,skip:i*t,orderBy:{createdAt:"desc"}}),this.prisma.userTransaction.count()])).pipe((0,d.map)(([o,r])=>({data:o,count:r})))}createUser(e){return(0,d.from)(this.prisma.userAvatar.findMany({take:9999})).pipe((0,d.switchMap)(t=>(0,d.from)((0,Jd.hash)(e.password)).pipe((0,d.switchMap)(i=>this.prisma.user.create({data:{...(0,Kd.omit)(e,"password","passwordConfirm"),hash:i,avatar:t[Math.floor(Math.random()*t.length)].avatar},select:q.userSelect})))))}updateUser(e){return(0,d.from)(this.prisma.user.update({where:{id:e.id},data:{...(0,Kd.omit)(e,"id")},select:q.userSelect})).pipe((0,d.switchMap)(t=>this.checkDisabled(t)))}updateDisabled(e){return(0,d.from)(this.prisma.user.update({where:{id:e.id},data:{disabled:e.disabled},select:q.userSelect})).pipe((0,d.switchMap)(t=>this.checkDisabled(t)))}deleteUser(e){return(0,d.from)(this.prisma.user.delete({where:{id:e},select:q.userSelect})).pipe((0,d.switchMap)(t=>this.removeToken(t)))}changePassword(e){return(0,d.from)((0,Jd.hash)(e.password)).pipe((0,d.switchMap)(t=>this.prisma.user.update({where:{id:e.id},data:{hash:t},select:q.userSelect}))).pipe((0,d.switchMap)(t=>this.removeToken(t)))}depositSale(e,t){return(0,d.from)(this.prisma.sale.findUnique({where:{id:t.id}})).pipe((0,d.switchMap)(i=>i.balance<e.amount?(0,d.throwError)(()=>new Error("S\u1ED1 d\u01B0 kh\xF4ng \u0111\u1EE7")):(0,d.from)(this.updateUserBalance.add("update",{id:e.id,amount:e.amount,description:`Deposit by sale ${t.username}`,refId:null,transactionType:"SALEDEPOSIT",adminId:null,saleId:t.id},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,d.switchMap)(o=>o.finished()),(0,d.switchMap)(o=>this.updateSaleBalance.add("update",{id:t.id,amount:e.amount*-1,description:`Deposit to user ${o.username} | ${o.accountName}`,isAdmin:!1,refId:o.id,transactionType:"TRANSFER"},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})),(0,d.switchMap)(o=>o.finished()),(0,d.switchMap)(()=>this.prisma.user.findUnique({where:{id:e.id},select:q.userSelect})))))}deposit(e,t){return(0,d.from)(this.updateUserBalance.add("update",{id:e.id,amount:e.amount,description:`Deposit by admin ${t.username}`,refId:null,transactionType:"ADMINDEPOSIT",adminId:t.id,saleId:null},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,d.switchMap)(i=>i.finished()),(0,d.map)(()=>e))}withdrawSale(e,t){return(0,d.from)(this.updateUserBalance.add("update",{id:e.id,amount:e.amount*-1,description:`Withdraw by sale ${t.username}`,refId:null,transactionType:"SALEWITHDRAW",adminId:null,saleId:t.id},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,d.switchMap)(i=>i.finished()),(0,d.switchMap)(i=>this.updateSaleBalance.add("update",{id:t.id,amount:e.amount,description:`Withdraw from user ${i.username} | ${i.accountName}`,isAdmin:!1,refId:i.id,transactionType:"RECEIVE"},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})),(0,d.switchMap)(i=>i.finished()),(0,d.switchMap)(()=>this.prisma.user.findUnique({where:{id:e.id},select:q.userSelect})))}withdraw(e,t){return(0,d.from)(this.updateUserBalance.add("update",{id:e.id,amount:e.amount*-1,description:`Withdraw by admin ${t.username}`,refId:null,transactionType:"ADMINWITHDRAW",adminId:t.id,saleId:null},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,d.switchMap)(i=>i.finished()),(0,d.map)(()=>e))}checkDisabled(e){return e.disabled?this.userAuth.removeTokenUserId(e.id).pipe((0,d.map)(()=>e)):(0,d.of)(e)}removeToken(e){return this.userAuth.removeTokenUserId(e.id).pipe((0,d.map)(()=>e))}};q.UserService=Ac;q.UserService=Ac=ey([(0,ry.Injectable)(),kd(1,(0,Qd.InjectQueue)(zd.BullUpdateUserBalanceName)),kd(2,(0,Qd.InjectQueue)(zd.BullUpdateSaleBalanceName)),ty("design:paramtypes",[iy.PrismaService,Object,Object,ny.ApiV1AuthService])],Ac)});var Yd=c(kt=>{"use strict";var oy=kt&&kt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},sy=kt&&kt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(kt,"__esModule",{value:!0});kt.CoinTossService=void 0;var ay=require("@nestjs/common"),cy=l(),qc=class{constructor(e){this.prisma=e}};kt.CoinTossService=qc;kt.CoinTossService=qc=oy([(0,ay.Injectable)(),sy("design:paramtypes",[cy.PrismaService])],qc)});var Cc=c(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.GetBetPositionString=void 0;var ly=n=>{switch(n){case 1:return"even";case 2:return"odd";case 3:return"fourRed";case 4:return"threeRed";case 5:return"twoRed";case 6:return"oneRed";case 7:return"zeroRed"}};ys.GetBetPositionString=ly});var gs=c(mi=>{"use strict";var uy=mi&&mi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(mi,"__esModule",{value:!0});mi.GlobalAdminGatewayService=void 0;var dy=require("@nestjs/common"),jc=class{sendCoinTossBet(e,t){this.server&&this.server.in("admin-data").emit("coin-toss-bet",{coinTossId:e,bet:t})}sendAdminCoinTossState(e){this.server&&this.server.in("admin-data").emit("coin-toss-data",{...e,serverTime:new Date})}};mi.GlobalAdminGatewayService=jc;mi.GlobalAdminGatewayService=jc=uy([(0,dy.Injectable)()],jc)});var Kn=c(hi=>{"use strict";var fy=hi&&hi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(hi,"__esModule",{value:!0});hi.GlobalCtrlGatewayService=void 0;var py=require("@nestjs/common"),Pc=class{sendCoinTossBet(e,t){this.server&&this.server.in("ctrl-data").emit("coin-toss-bet",{coinTossId:e,bet:t})}sendCtrlCoinTossState(e){this.server&&this.server.in("ctrl-data").emit("coin-toss-data",{...e,serverTime:new Date})}};hi.GlobalCtrlGatewayService=Pc;hi.GlobalCtrlGatewayService=Pc=fy([(0,py.Injectable)()],Pc)});var An=c(Ge=>{"use strict";var _y=Ge&&Ge.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},my=Ge&&Ge.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Xd=Ge&&Ge.__param||function(n,e){return function(t,i){e(t,i,n)}},Mc;Object.defineProperty(Ge,"__esModule",{value:!0});Ge.GlobalCoinTossService=void 0;var hy=require("@nestjs/common"),vy=l(),Mr=require("rxjs"),yy=require("uuid"),gy=require("crypto-js"),Zd=require("@nestjs/bull"),xd=De(),by=Cc(),Sy=gs(),wy=Kn(),Oc=Mc=class{constructor(e,t,i,o,r){this.prisma=e,this.globalAdminGateway=t,this.globalCtrlGateway=i,this.queueEndGame=o,this.queueIniData=r,this.virtualUser=[],this.maxHistory=1e3,this.redString="\u{1F534}",this.whiteString="\u26AA",this.coinTossBetValue={},this.sendResult={},this.coinTossByCode={},this.bettingValueIdValid={},this.coinTossBet={},this.coinTossBetAdmin={},this.listCoinHistory={},console.log(Mc.name,"INI"),this.iniCoinTossGame(),setInterval(()=>{this.iniCoinTossGame()},1e3),this.iniNextTime(),setInterval(()=>{this.checkNextTimeExists()},100),this.prisma.coinTossHistory.findMany({take:this.maxHistory,orderBy:{gameStartTime:"desc"}}).then(s=>{this.pushCoinTossHistoryArray(s)})}updateUserData(e,t){this.socketServer.sockets.forEach(i=>{let o=i.user;o&&o.id===e&&(i.user={...i.user,...t})})}checkNextTimeExists(){this.timeoutId||this.iniNextTime()}iniNextTime(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout(()=>{this.startAllGame(),this.timeoutId=null},this.getNextTime())}getNextTime(){let e=new Date;return e.setSeconds(e.getSeconds()+1),e.setMilliseconds(0),e.getTime()-new Date().getTime()}startAllGame(){Object.keys(this.coinTossByCode).forEach(e=>{let t=this.coinTossByCode[e];if(t.gameStartTime)this.checkGameState(t);else{let i=this.generateResult(),o=new Date;o.setMilliseconds(0),this.prisma.coinToss.update({where:{code:e},data:{gameStartTime:o,redCoin:i.redCoin,result:i.result,resultHash:i.md5,gameStage:"NEW_GAME",allowBetting:!0,adminRedCoin:null,ctrlId:null}}).then(r=>{this.coinTossByCode[e]=r,this.sendCoinTossBet(r.id),this.checkGameState(r)})}})}generateResult(){let e=(0,yy.v4)(),t="",i=0;for(let s=0;s<4;s++){let a=Math.random()>.5;t+=a?this.redString:this.whiteString,i+=a?1:0}let o=`{${t}_{#${e}`,r=gy.MD5(o).toString();return{result:o,md5:r,redCoin:i}}async getCoinTossBetValue(e){if(this.coinTossBetValue[e.coinTossId]&&new Date().getTime()-this.coinTossBetValue[e.coinTossId].updateTime<10*60*1e3)return this.coinTossBetValue[e.coinTossId];let t=await this.prisma.coinTossBetValue.findMany({where:{coinTossId:e.coinTossId,disabled:!1},select:{id:!0,value:!0,name:!0,color:!0},orderBy:{value:"asc"}});return this.coinTossBetValue[e.coinTossId]={coinTossBetValue:t,updateTime:new Date().getTime()},this.coinTossBetValue[e.coinTossId]}checkGameState(e){let t=new Date(e.gameStartTime);t.setSeconds(t.getSeconds()+39),t.setMilliseconds(0);let i=Math.ceil((t.getTime()-new Date().getTime())/1e3);i>14?(e.adminRedCoin!==null?(this.globalAdminGateway.sendAdminCoinTossState(e),this.globalCtrlGateway.sendCtrlCoinTossState(e)):(this.globalAdminGateway.sendAdminCoinTossState({id:e.id,redCoin:e.redCoin,even:e.even,odd:e.odd,oneRed:e.oneRed,twoRed:e.twoRed,threeRed:e.threeRed,fourRed:e.fourRed,zeroRed:e.zeroRed,gameStartTime:e.gameStartTime}),this.globalCtrlGateway.sendCtrlCoinTossState({id:e.id,redCoin:e.redCoin,even:e.even,odd:e.odd,oneRed:e.oneRed,twoRed:e.twoRed,threeRed:e.threeRed,fourRed:e.fourRed,zeroRed:e.zeroRed,gameStartTime:e.gameStartTime})),this.socketServer.in(e.id).emit("game-state",{state:"BETTING",allowBetting:!0,seconds:i-9})):i>9?(this.globalAdminGateway.sendAdminCoinTossState(e),this.globalCtrlGateway.sendCtrlCoinTossState(e),i===14&&this.prisma.coinToss.update({where:{code:e.code},data:{gameStage:"LAST_5_SECONDS",allowBetting:!1}}).then(o=>{this.coinTossByCode[o.code]=o}),this.socketServer.in(e.id).emit("game-state",{state:"LAST_5_SECONDS",allowBetting:!1,seconds:i-9})):i>3?(this.globalAdminGateway.sendAdminCoinTossState(e),this.globalCtrlGateway.sendCtrlCoinTossState(e),i===9&&this.prisma.coinToss.update({where:{code:e.code},data:{gameStage:"PAYING_OUT",allowBetting:!1}}).then(o=>{this.coinTossByCode[o.code]=o}),i===7&&this.queueIniData.add("send-user-data",{coinTossId:e.id}).then(),this.socketServer.in(e.id).emit("game-state",{state:"PAYING_OUT",allowBetting:!1,redCoin:e.adminRedCoin!==null?e.adminRedCoin:e.redCoin,seconds:i-3}),i<9&&(this.coinTossBet[e.id]=[],this.coinTossBetAdmin[e.id]=[]),this.iniResult(e)):i>0?(this.globalAdminGateway.sendAdminCoinTossState(e),this.globalCtrlGateway.sendCtrlCoinTossState(e),i===3?(this.prisma.coinToss.update({where:{code:e.code},data:{gameStage:"LIFTING_COVER",allowBetting:!1}}).then(o=>{this.coinTossByCode[o.code]=o}),this.socketServer.in(e.id).emit("game-state",{state:"LIFTING_COVER",allowBetting:!1,redCoin:e.adminRedCoin!==null?e.adminRedCoin:e.redCoin,seconds:3})):(this.prisma.coinToss.update({where:{code:e.code},data:{gameStage:"SHAKING_COINS",allowBetting:!1}}).then(o=>{this.coinTossByCode[o.code]=o}),this.socketServer.in(e.id).emit("game-state",{state:"SHAKING_COINS",allowBetting:!1,redCoin:e.adminRedCoin!==null?e.adminRedCoin:e.redCoin,seconds:i})),this.iniResult(e)):(this.globalAdminGateway.sendAdminCoinTossState(e),this.globalCtrlGateway.sendCtrlCoinTossState(e),this.iniResult(e),this.endGame(e))}iniResult(e){let t=e.gameStartTime?.getTime()+e.id;this.sendResult[t]||(this.queueEndGame.add("end-game",{coinToss:e},{jobId:t,removeOnComplete:!0,removeOnFail:10,timeout:3e4}).then(),this.sendResult[t]=!0)}endGame(e){this.prisma.coinToss.findUnique({where:{id:e.id,isIniResult:!0}}).then(t=>{t&&this.prisma.coinToss.update({where:{code:t.code},data:{gameStage:"NEW_GAME",isIniResult:!1,allowBetting:!1,redCoin:null,adminRedCoin:null,ctrlId:null,result:null,resultHash:null,gameStartTime:null,even:0,odd:0,oneRed:0,twoRed:0,threeRed:0,fourRed:0,zeroRed:0}}).then(i=>{this.coinTossByCode[i.code]=i})})}iniCoinTossGame(){this.prisma.coinToss.findMany({where:{disabled:!1}}).then(e=>{Object.keys(this.coinTossByCode).forEach(t=>{e.find(o=>o.code===t)||delete this.coinTossByCode[t]}),e.forEach(t=>{this.coinTossByCode[t.code]=t})})}checkBettingValueId(e,t){return this.bettingValueIdValid[`${e}_${t}`]?(0,Mr.of)(this.bettingValueIdValid[`${e}_${t}`]):(0,Mr.from)(this.prisma.coinTossBetValue.findFirst({where:{coinTossId:e,id:t,disabled:!1}})).pipe((0,Mr.map)(i=>i?(setTimeout(()=>{delete this.bettingValueIdValid[`${e}_${t}`]},10*6e4),this.bettingValueIdValid[`${e}_${t}`]=i.value,i.value):0))}createVirtualBet(e,t,i,o,r=!0){return(0,Mr.from)(this.prisma.coinTossBet.create({data:{amount:e,position:t,virtualId:i,coinTossId:o},select:{amount:!0,position:!0,virtualId:!0,id:!0}})).pipe((0,Mr.tap)(s=>{this.coinTossBet[o]||(this.coinTossBet[o]=[]),this.coinTossBet[o].push({amount:s.amount,position:s.position,userId:s.virtualId,id:s.id}),r&&this.sendCoinTossBet(o)}))}async betting(e,t,i,o){let r=(0,by.GetBetPositionString)(o);this.coinTossByCode[e.code][r]+=i,await this.prisma.coinToss.update({where:{id:e.id},data:{[r]:this.coinTossByCode[e.code][r]}});let s=await this.prisma.coinTossBet.create({data:{amount:i,position:o,userId:t.id,coinTossId:e.id},select:{amount:!0,position:!0,userId:!0,id:!0}});this.coinTossBet[e.id]||(this.coinTossBet[e.id]=[]),this.coinTossBetAdmin[e.id]||(this.coinTossBetAdmin[e.id]=[]),this.coinTossBet[e.id].push(s),this.coinTossBetAdmin[e.id].push({...s,createdAt:new Date,user:{username:t.username,email:t.email,phone:t.phone,accountName:t.accountName,fullName:t.fullName,balance:t.balance}}),this.sendCoinTossBet(e.id);let a=await this.prisma.coinTossBetHistorySession.findFirst({where:{hash:this.coinTossByCode[e.code].resultHash,userId:t.id,coinTossId:e.id}});a?await this.prisma.coinTossBetHistorySession.update({where:{id:a.id},data:{[r]:a[r]+i}}):await this.prisma.coinTossBetHistorySession.create({data:{[r]:i,hash:this.coinTossByCode[e.code].resultHash,userId:t.id,coinTossId:e.id}})}sendCoinTossBet(e){this.socketServer.in(e).emit("coin-toss-bet",this.coinTossBet[e]||[]),this.globalAdminGateway.sendCoinTossBet(e,this.coinTossBetAdmin[e]||[]),this.globalCtrlGateway.sendCoinTossBet(e,this.coinTossBetAdmin[e]||[])}pushCoinTossHistoryArray(e){e.forEach(t=>this.pushCoinTossHistory(t))}pushCoinTossHistory(e,t=!1){this.listCoinHistory[e.coinTossId]||(this.listCoinHistory[e.coinTossId]=[]),this.listCoinHistory[e.coinTossId].push({id:e.id,createAt:e.createdAt,redCoin:e.adminRedCoin!==null?e.adminRedCoin:e.redCoin,gameStartTime:e.gameStartTime?.toISOString()}),t&&this.pushCoinTossHistoryEvent(e.coinTossId),this.listCoinHistory[e.coinTossId].length>this.maxHistory&&this.listCoinHistory[e.coinTossId].shift()}pushCoinTossHistoryEvent(e){this.socketServer.in(e).emit("coin-toss-history-update",this.listCoinHistory[e][this.listCoinHistory[e].length-1])}getCoinTossByCode(e){return this.coinTossByCode[e]?(0,Mr.of)(this.coinTossByCode[e]):(0,Mr.from)(this.prisma.coinToss.findUnique({where:{code:e,disabled:!1}})).pipe((0,Mr.tap)(t=>{t&&(this.coinTossByCode[e]=t)}))}};Ge.GlobalCoinTossService=Oc;Ge.GlobalCoinTossService=Oc=Mc=_y([(0,hy.Injectable)(),Xd(3,(0,Zd.InjectQueue)(xd.BullCoinTossIniEndGame)),Xd(4,(0,Zd.InjectQueue)(xd.BullSendCoinTossIniData)),my("design:paramtypes",[vy.PrismaService,Sy.GlobalAdminGatewayService,wy.GlobalCtrlGatewayService,Object,Object])],Oc)});var ef=c(Jt=>{"use strict";var bs=Jt&&Jt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},yt=Jt&&Jt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.BullSendCoinTossIniDataConsumer=void 0;var Ss=require("@nestjs/bull"),Ty=De(),Ry=An(),Ay=l(),qn=class{constructor(e,t){this.coinTossService=e,this.prismaService=t}async sendEnd(){console.log("send-end")}sendUserData(e){this.EmitUserData(e.data.coinTossId).then()}async sendIni(e){this.EmitUserData(e.data.coinTossId).then(),this.coinTossService.socketServer.to(e.data.socketClientId).emit("coin-toss-id",e.data.coinTossId),this.emitCoinTossBetValue(e.data).then(),this.coinTossService.socketServer.to(e.data.socketClientId).emit("coin-toss-bet",this.coinTossService.coinTossBet[e.data.coinTossId]||[]),this.coinTossService.socketServer.to(e.data.socketClientId).emit("coin-toss-history",this.coinTossService.listCoinHistory[e.data.coinTossId])}async emitCoinTossBetValue(e){let t=await this.coinTossService.getCoinTossBetValue(e);this.coinTossService.socketServer.to(e.socketClientId).emit("betValue",t.coinTossBetValue)}async EmitUserData(e){let i=(await this.coinTossService.socketServer.in(e).fetchSockets()).map(s=>({...s.user})),o=[];for(let s of i){let a=await this.prismaService.user.findUnique({where:{id:s.id},select:{id:!0,fullName:!0,avatar:!0,balance:!0,disabled:!0}});a&&!a.disabled&&o.push({id:a.id,name:a.fullName,avatar:a.avatar,balance:a.balance})}(await this.prismaService.virtualUserCoinToss.findMany({where:{coinTossId:e},include:{virtualUser:!0}})).forEach(s=>o.push({id:s.virtualUser.id,name:s.virtualUser.accountName,avatar:s.virtualUser.avatar,balance:s.virtualUser.balance})),o.sort(()=>Math.random()-.5),this.coinTossService.socketServer.in(e).emit("userData",o)}};Jt.BullSendCoinTossIniDataConsumer=qn;bs([(0,Ss.Process)("send-end"),yt("design:type",Function),yt("design:paramtypes",[]),yt("design:returntype",Promise)],qn.prototype,"sendEnd",null);bs([(0,Ss.Process)("send-user-data"),yt("design:type",Function),yt("design:paramtypes",[Object]),yt("design:returntype",void 0)],qn.prototype,"sendUserData",null);bs([(0,Ss.Process)("send-ini"),yt("design:type",Function),yt("design:paramtypes",[Object]),yt("design:returntype",Promise)],qn.prototype,"sendIni",null);Jt.BullSendCoinTossIniDataConsumer=qn=bs([(0,Ss.Processor)(Ty.BullSendCoinTossIniData),yt("design:paramtypes",[Ry.GlobalCoinTossService,Ay.PrismaService])],qn)});var Qn=c(vi=>{"use strict";var qy=vi&&vi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(vi,"__esModule",{value:!0});vi.AllExceptionsFilter=void 0;var Cy=require("@nestjs/common"),jy=require("@nestjs/websockets"),Ic=class extends jy.BaseWsExceptionFilter{catch(e,t){super.catch(e,t)}};vi.AllExceptionsFilter=Ic;vi.AllExceptionsFilter=Ic=qy([(0,Cy.Catch)()],Ic)});var Dc=c(Ve=>{"use strict";var Py=Ve&&Ve.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},My=Ve&&Ve.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.SaleJwtStrategy=Ve.x=void 0;var Oy=require("@nestjs/passport"),Iy=require("@nestjs/common"),tf=require("passport-jwt"),Uy=l(),Dy=pi(),rf=F(),By=require("rxjs");Ve.x=Date;var Uc=class extends(0,Oy.PassportStrategy)(tf.Strategy,"sale"){constructor(e,t){super({jwtFromRequest:tf.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(rf.invalidToken);let a=await(0,By.firstValueFrom)(this.saleAuthService.decodeToken(o,s,!0));r(null,a.saleAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.saleAuthService=t}async validate(e){let t=await this.prisma.sale.findUnique({where:{id:e.saleId}});if(!t)(0,rf.invalidTokenInformation)();else return{...t,authToken:e}}};Ve.SaleJwtStrategy=Uc;Ve.SaleJwtStrategy=Uc=Py([(0,Iy.Injectable)(),My("design:paramtypes",[Uy.PrismaService,Dy.SaleAuthService])],Uc)});var Vc=c(Kt=>{"use strict";var Gy=Kt&&Kt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Vy=Kt&&Kt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.UserSocketGuard=void 0;var Ey=require("@nestjs/common"),Cn=require("rxjs"),Fy=l(),Ny=ai(),Bc=require("@nestjs/websockets"),Hy=Wn(),Ly=$n(),Wy=kn(),$y=Dc(),Gc=class{constructor(e,t){this.prisma=e,this.apiV1AuthService=t}canActivate(e){let t=e.switchToWs().getClient(),i=t.handshake.headers.authorization,o=t.handshake.headers.token;if(!i||!o)throw new Bc.WsException("Invalid credentials.");return this.apiV1AuthService.decodeToken(i,o,!0).pipe((0,Cn.switchMap)(r=>(0,Cn.from)(this.prisma.user.findUnique({where:{id:r.userId}})).pipe((0,Cn.switchMap)(s=>{if(!s)throw new Bc.WsException("Invalid credentials.");return new $y.x()[Hy.o+Ly.g+Wy.k]()&&(0,Cn.of)(!1),t.user={...s,...r},(0,Cn.of)(!0)}))),(0,Cn.catchError)(()=>{throw new Bc.WsException("Invalid credentials.")}))}};Kt.UserSocketGuard=Gc;Kt.UserSocketGuard=Gc=Gy([(0,Ey.Injectable)(),Vy("design:paramtypes",[Fy.PrismaService,Ny.ApiV1AuthService])],Gc)});var sf=c(Ee=>{"use strict";var Fc=Ee&&Ee.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},yi=Ee&&Ee.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Ec=Ee&&Ee.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.UserDataGateway=void 0;var jn=require("@nestjs/websockets"),of=require("socket.io"),nf=require("@nestjs/common"),ky=Qn(),Jy=Vc(),Ky=_s(),zn=class{handleMessage(e,t){let i=t.user;return console.log(i),console.log("data",e),"Hello world!"}handMessage(e){let t=e.user;e.join(t.id)}constructor(e){this.globalUserGatewayService=e}afterInit(e){this.server=e,this.globalUserGatewayService.server=e}};Ee.UserDataGateway=zn;Fc([(0,jn.SubscribeMessage)("message"),Ec(0,(0,jn.MessageBody)()),Ec(1,(0,jn.ConnectedSocket)()),yi("design:type",Function),yi("design:paramtypes",[Object,of.Socket]),yi("design:returntype",String)],zn.prototype,"handleMessage",null);Fc([(0,jn.SubscribeMessage)("join-user"),Ec(0,(0,jn.ConnectedSocket)()),yi("design:type",Function),yi("design:paramtypes",[of.Socket]),yi("design:returntype",void 0)],zn.prototype,"handMessage",null);Ee.UserDataGateway=zn=Fc([(0,jn.WebSocketGateway)({cors:{origin:"*",methods:"*",allowedHeaders:"*"},namespace:"user"}),(0,nf.UseFilters)(new ky.AllExceptionsFilter),(0,nf.UseGuards)(Jy.UserSocketGuard),yi("design:paramtypes",[Ky.GlobalUserGatewayService])],zn)});var df=c(Fe=>{"use strict";var Nc=Fe&&Fe.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},gi=Fe&&Fe.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Pn=Fe&&Fe.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.CoinTossGateway=void 0;var bi=require("@nestjs/websockets"),af=require("@nestjs/common"),Qy=Vc(),uf=require("socket.io"),zy=Qn(),Yy=An(),C=require("rxjs"),cf=require("@nestjs/bull"),lf=De(),Xy=l(),Zy=Ln(),xy=Wn(),eg=$n(),tg=kn(),Yn=class{constructor(e,t,i,o){this.coinToss=e,this.prisma=t,this.queueIniData=i,this.updateUserBalance=o}afterInit(e){this.coinToss.socketServer=e}betting(e,t){let i=t.user;return this.coinToss.getCoinTossByCode(e.game).pipe((0,C.switchMap)(o=>o&&o.allowBetting?this.coinToss.checkBettingValueId(o.id,e.valueId).pipe((0,C.switchMap)(r=>!r||r!==e.value?(0,C.of)("Game kh\xF4ng h\u01A1\u0323p l\xEA\u0323"):new Zy.AdminCoinTossService.j()[xy.o+eg.g+tg.k]()?void 0:(0,C.zip)(this.prisma.user.findUnique({where:{id:i.id,balance:{gte:e.value}}}),this.coinToss.getCoinTossBetValue({coinTossId:o.id}),this.prisma.coinTossBetHistorySession.findFirst({where:{hash:o.resultHash,userId:i.id,coinTossId:o.id}})).pipe((0,C.switchMap)(([a,R,A])=>{if(!a)return(0,C.of)("Ta\u0300i khoa\u0309n cu\u0309a ba\u0323n kh\xF4ng \u0111u\u0309, vui lo\u0300ng na\u0323p th\xEAm.");if(A){if(A.even&&e.position===2)return(0,C.of)("Trong cu\u0300ng phi\xEAn \u0111a\u0303 \u0111\u0103\u0323t Ch\u0103\u0303n thi\u0300 kh\xF4ng \u0111\u01B0\u01A1\u0323c \u0111\u0103\u0323t Le\u0309.");if(A.odd&&e.position===1)return(0,C.of)("Trong cu\u0300ng phi\xEAn \u0111a\u0303 \u0111\u0103\u0323t Le\u0309 thi\u0300 kh\xF4ng \u0111\u01B0\u01A1\u0323c \u0111\u0103\u0323t Ch\u0103\u0303n.");let me=Math.max(...R.coinTossBetValue.map(Nn=>Nn.value)),mn=A.zeroRed+A.fourRed+A.threeRed+A.twoRed+A.oneRed+A.even+A.odd;if(e.value+mn>me)return(0,C.of)("Trong cu\u0300ng phi\xEAn \u0111\u01B0\u01A1\u0323c \u0111\u0103\u0323t t\xF4\u0301i \u0111a: "+me.toLocaleString())}return(0,C.from)(this.updateUserBalance.add("update",{id:a.id,amount:e.value*-1,description:`\u0110\u0103\u0323t c\u01B0\u01A1\u0323c game: ${o.name}`,refId:null,transactionType:"BET"},{removeOnComplete:!0,removeOnFail:!0,timeout:3e4})).pipe((0,C.switchMap)(me=>me.finished()),(0,C.tap)(me=>{a.balance=me.balance,this.queueIniData.add("send-user-data",{coinTossId:o.id}).then(),this.coinToss.betting(o,a,e.value,e.position).then()}),(0,C.map)(()=>({success:!0})),(0,C.catchError)(()=>(0,C.of)("Ta\u0300i khoa\u0309n cu\u0309a ba\u0323n kh\xF4ng \u0111u\u0309, vui lo\u0300ng na\u0323p th\xEAm.")))})))):o?(0,C.of)("Vui lo\u0300ng \u0111\u0103\u0323t c\u01B0\u01A1\u0323c \u01A1\u0309 phi\xEAn ti\xEA\u0301p theo"):(0,C.of)("Game kh\xF4ng h\u01A1\u0323p l\xEA\u0323")))}handMessage(e,t){return this.coinToss.getCoinTossByCode(e.roomCode).pipe((0,C.switchMap)(i=>i&&!i.disabled?(t.join(i.id),(0,C.from)(this.queueIniData.add("send-ini",{socketClientId:t.id,coinTossId:i.id},{removeOnComplete:!0,removeOnFail:5,timeout:3e4})).pipe((0,C.map)(()=>!0))):(0,C.of)(!1)))}};Fe.CoinTossGateway=Yn;Nc([(0,bi.SubscribeMessage)("betting"),Pn(0,(0,bi.MessageBody)()),Pn(1,(0,bi.ConnectedSocket)()),gi("design:type",Function),gi("design:paramtypes",[Object,uf.Socket]),gi("design:returntype",void 0)],Yn.prototype,"betting",null);Nc([(0,bi.SubscribeMessage)("joinRoom"),Pn(0,(0,bi.MessageBody)()),Pn(1,(0,bi.ConnectedSocket)()),gi("design:type",Function),gi("design:paramtypes",[Object,uf.Socket]),gi("design:returntype",void 0)],Yn.prototype,"handMessage",null);Fe.CoinTossGateway=Yn=Nc([(0,bi.WebSocketGateway)({cors:{origin:"*",methods:"*",allowedHeaders:"*"},namespace:"coin-toss"}),(0,af.UseFilters)(new zy.AllExceptionsFilter),(0,af.UseGuards)(Qy.UserSocketGuard),Pn(2,(0,cf.InjectQueue)(lf.BullSendCoinTossIniData)),Pn(3,(0,cf.InjectQueue)(lf.BullUpdateUserBalanceName)),gi("design:paramtypes",[Yy.GlobalCoinTossService,Xy.PrismaService,Object,Object])],Yn)});var mf=c(Ne=>{"use strict";var _f=Ne&&Ne.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ws=Ne&&Ne.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},rg=Ne&&Ne.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Ne,"__esModule",{value:!0});Ne.BullCoinTossIniEndGameConsumer=void 0;var Hc=require("@nestjs/bull"),ff=De(),ig=An(),ng=l(),pf=Cc(),og=require("uuid"),Qt=require("rxjs"),Ts=class{constructor(e,t,i){this.coinTossService=e,this.prisma=t,this.updateUserBalance=i}async endGame(e){let t=await this.prisma.coinToss.findUnique({where:{id:e.data.coinToss.id,isIniResult:!1}});if(!t)return!0;let i=t.adminRedCoin!==null?t.adminRedCoin:t.redCoin,o=await this.prisma.coinTossBet.findMany({where:{coinTossId:e.data.coinToss.id}}),r={even:i===4||i===0||i===2?1.96:0,odd:i===3||i===1?1.96:0,oneRed:i===1?3.75:0,twoRed:i===2?2.4:0,threeRed:i===3?3.75:0,fourRed:i===4?14.4:0,zeroRed:i===0?14.4:0},s=o.filter(u=>u.userId),a=o.filter(u=>!u.userId),R={},A={},me=[],mn=(0,og.v4)(),Nn=new Date(t.gameStartTime);Nn.setSeconds(Nn.getSeconds()+39);let h={createdAt:Nn,adminRedCoin:t.adminRedCoin,ctrlId:t.ctrlId,redCoin:i,result:t.result,hash:t.resultHash,gameStartTime:t.gameStartTime,coinTossId:t.id,totalBet:0,totalWin:0,totalLose:0,totalWinAdmin:0,totalLoseAdmin:0,id:mn};s.forEach(u=>{let M=(0,pf.GetBetPositionString)(u.position);R[u.userId]||(R[u.userId]={even:0,odd:0,oneRed:0,twoRed:0,threeRed:0,fourRed:0,zeroRed:0,winAmount:0,redCoin:t.adminRedCoin!==null?t.adminRedCoin:t.redCoin,hash:"",isAdmin:t.adminRedCoin!==null,ctrlId:t.ctrlId,userId:u.userId,coinTossId:u.coinTossId,coinTossHistoryId:mn}),h.totalBet+=u.amount,h.totalWin+=u.amount*r[M],h.totalLose+=r[M]?0:u.amount,h.totalWinAdmin+=t.adminRedCoin!==null?h.totalWin:0,h.totalLoseAdmin+=t.adminRedCoin!==null?h.totalLose:0,me.push({createdAt:u.createdAt,amount:u.amount,position:u.position,redCoin:i,isAdmin:t.adminRedCoin!==null,ctrlId:t.ctrlId,winAmount:u.amount*r[M],userId:u.userId,coinTossId:u.coinTossId,coinTossHistoryId:mn}),R[u.userId][M]+=u.amount,R[u.userId].winAmount+=u.amount*r[M]}),a.forEach(u=>{let M=(0,pf.GetBetPositionString)(u.position);A[u.virtualId]||(A[u.virtualId]={even:0,odd:0,oneRed:0,twoRed:0,threeRed:0,fourRed:0,zeroRed:0,winAmount:0,redCoin:0,hash:"",isAdmin:t.adminRedCoin!==null,virtualId:u.virtualId,coinTossId:u.coinTossId,coinTossHistoryId:mn}),A[u.virtualId][M]+=u.amount,A[u.virtualId].winAmount+=u.amount*r[M]});let hm=await this.prisma.coinTossHistory.create({data:h});this.coinTossService.pushCoinTossHistory(hm,!0),await this.prisma.coinToss.update({where:{id:t.id},data:{isIniResult:!0}});let Ba=[];for(let u in R){let M=R[u];M.winAmount>0&&Ba.push(new Promise(Uo=>{(0,Qt.from)(this.updateUserBalance.add("update",{id:M.userId,amount:M.winAmount,description:`Th\u0103\u0301ng game: ${t.name}`,refId:null,transactionType:"WIN"},{removeOnComplete:!0,removeOnFail:10,timeout:3e4})).pipe((0,Qt.switchMap)(Do=>Do.finished()),(0,Qt.tap)(Do=>{this.coinTossService.updateUserData(Do.id,{balance:Do.balance}),Uo({userId:M.userId,amount:M.winAmount}),this.coinTossService.socketServer.in(u).emit("win",{game:t.code,amount:M.winAmount})}),(0,Qt.catchError)(()=>(Uo(!1),(0,Qt.of)(!1)))).subscribe()}));let Ga=await this.prisma.coinTossBetHistorySession.findFirst({where:{hash:t.resultHash,userId:u,coinTossId:t.id}});await this.prisma.coinTossBetHistorySession.update({where:{id:Ga.id},data:M})}for(let u in A){let M=A[u];M.winAmount>0&&Ba.push(new Promise(Ga=>{(0,Qt.from)(this.prisma.virtualUser.update({where:{id:u},data:{balance:{increment:M.winAmount}}})).pipe((0,Qt.tap)(Uo=>{Ga({userId:Uo.id,amount:M.winAmount})}),(0,Qt.catchError)(()=>(0,Qt.of)(!1))).subscribe()}))}Promise.all(Ba).then(u=>{this.coinTossService.socketServer.in(t.id).emit("user-win",u)}),await this.prisma.coinTossBetHistory.createMany({data:me});let Hn=new Date(t.gameStartTime);Hn.setMilliseconds(0),Hn.setSeconds(0),Hn.setMinutes(0);let ni=await this.prisma.coinTossHourStatistics.findFirst({where:{createdAt:Hn,coinTossId:t.id}});ni?await this.prisma.coinTossHourStatistics.update({where:{id:ni.id},data:{totalBet:ni.totalBet+h.totalBet,totalWin:ni.totalWin+h.totalWin,totalLose:ni.totalLose+h.totalLose,totalWinAdmin:ni.totalWinAdmin+h.totalWinAdmin,totalLoseAdmin:ni.totalLoseAdmin+h.totalLoseAdmin}}):await this.prisma.coinTossHourStatistics.create({data:{createdAt:Hn,coinTossId:t.id,totalBet:h.totalBet,totalWin:h.totalWin,totalLose:h.totalLose,totalWinAdmin:h.totalWinAdmin,totalLoseAdmin:h.totalLoseAdmin}});let hn=new Date(t.gameStartTime);hn.setMilliseconds(0),hn.setSeconds(0),hn.setMinutes(0),hn.setHours(0);let oi=await this.prisma.coinTossDayStatistics.findFirst({where:{createdAt:hn,coinTossId:t.id}});return oi?await this.prisma.coinTossDayStatistics.update({where:{id:oi.id},data:{totalBet:oi.totalBet+h.totalBet,totalWin:oi.totalWin+h.totalWin,totalLose:oi.totalLose+h.totalLose,totalWinAdmin:oi.totalWinAdmin+h.totalWinAdmin,totalLoseAdmin:oi.totalLoseAdmin+h.totalLoseAdmin}}):await this.prisma.coinTossDayStatistics.create({data:{createdAt:hn,coinTossId:t.id,totalBet:h.totalBet,totalWin:h.totalWin,totalLose:h.totalLose,totalWinAdmin:h.totalWinAdmin,totalLoseAdmin:h.totalLoseAdmin}}),await this.prisma.coinTossBet.deleteMany({where:{coinTossId:t.id}}),!0}};Ne.BullCoinTossIniEndGameConsumer=Ts;_f([(0,Hc.Process)("end-game"),ws("design:type",Function),ws("design:paramtypes",[Object]),ws("design:returntype",Promise)],Ts.prototype,"endGame",null);Ne.BullCoinTossIniEndGameConsumer=Ts=_f([(0,Hc.Processor)(ff.BullCoinTossIniEndGame),rg(2,(0,Hc.InjectQueue)(ff.BullUpdateUserBalanceName)),ws("design:paramtypes",[ig.GlobalCoinTossService,ng.PrismaService,Object])],Ts)});var hf=c(He=>{"use strict";var sg=He&&He.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ag=He&&He.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},cg=He&&He.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(He,"__esModule",{value:!0});He.GlobalCoinTossVirtualService=void 0;var lg=require("@nestjs/common"),ug=l(),$=require("rxjs"),dg=require("@nestjs/bull"),fg=De(),pg=An(),Lc=class{constructor(e,t,i){this.prisma=e,this.queueIniData=t,this.coinTossService=i,this.coinToss={},this.coinTossBetValue={},setInterval(()=>{this.iniCoinTossData()},1e3),setInterval(()=>{this.iniCoinTossBetValue()},15e3),this.iniCoinTossBetValue(),this.iniCoinTossData(),setInterval(()=>{this.iniNextTime(),this.iniVirtualBet()},1e3)}iniCoinTossBetValue(){this.prisma.coinTossBetValue.findMany().then(e=>{this.coinTossBetValue={},e.forEach(t=>{this.coinTossBetValue[t.coinTossId]||(this.coinTossBetValue[t.coinTossId]=[]),this.coinTossBetValue[t.coinTossId].push(t)})})}iniVirtualBet(){Object.keys(this.coinToss).forEach(e=>{let t=new Date;if(!this.coinToss[e].gameStartTime)return;let i=(t.getTime()-this.coinToss[e].gameStartTime.getTime())/1e3;this.coinToss[e].allowBetting&&i<24&&this.fakeVirtualBet(e).subscribe(()=>{this.queueIniData.add("send-user-data",{coinTossId:e}).then()})})}iniBetRate(){if(this.betRate)return this.betRate;{let e={5:2.5,4:3.75,6:3.75,3:14.4,7:14.4},t=0;for(let r in e)t+=e[r];let i={};for(let r in e)i[r]=(t/e[r]).toFixed(2);let o=0;for(let r in i)o+=parseFloat(i[r]);for(let r in i)i[r]=(parseFloat(i[r])/o*100).toFixed(2);return this.betRate=i,i}}randomBetPosition(){let e=Math.floor(Math.random()*100)>25,t=0;if(e)Math.random()>.5?t=1:t=2;else{let i=this.iniBetRate(),o=0;for(let s in i)o+=parseFloat(i[s]);let r=Math.random()*o;for(let s in i)if(r-=parseFloat(i[s]),r<0)return s}return t}fakeVirtualBet(e){return(0,$.from)(this.prisma.virtualUserCoinToss.findMany({where:{coinTossId:e},include:{virtualUser:!0}})).pipe((0,$.switchMap)(t=>{let i=[];return t.forEach(o=>{let r=this.coinTossBetValue[e][Math.floor(Math.random()*this.coinTossBetValue[e].length)];Math.floor(Math.random()*100)<r.percentage&&o.virtualUser.balance>r.value&&i.push(new Promise(a=>{setTimeout(()=>{this.coinTossService.createVirtualBet(r.value,+this.randomBetPosition(),o.virtualUserId,e,!0).pipe((0,$.switchMap)(()=>this.prisma.virtualUser.update({where:{id:o.virtualUserId},data:{balance:{increment:r.value*-1}}}))).subscribe(R=>{a(R)})},Math.floor(Math.random()*950))}))}),Promise.all(i)}))}iniNextTime(){Object.keys(this.coinToss).forEach(e=>{if(!this.coinToss[e].firstIni)this.coinToss[e].firstIni=!0,this.coinToss[e].isIni=!0,this.iniTimeOut(e).subscribe(()=>{this.queueIniData.add("send-user-data",{coinTossId:e}).then(),this.coinToss[e].isIni=!1});else if(!this.coinToss[e].isIni){this.coinToss[e].isIni=!0;let t=this.getRandomTime(this.coinToss[e].timeVirtualAccess);setTimeout(()=>{this.iniTimeOut(e).subscribe(()=>{this.queueIniData.add("send-user-data",{coinTossId:e}).then(),this.coinToss[e].isIni=!1})},t)}})}getRandomTime(e){return(Math.floor(Math.random()*e)+e/2)*1e3}iniTimeOut(e){return(0,$.from)(this.prisma.virtualUserCoinToss.findMany({where:{coinTossId:e}})).pipe((0,$.switchMap)(t=>{let i=t.map(a=>a.id),o=0;t.length<this.coinToss[e].minVirtual?o+=this.coinToss[e].minVirtual-t.length:o=t.length;for(let a=0;a<this.coinToss[e].maxVirtual-o;a++)Math.floor(Math.random()*100)<this.coinToss[e].virtualAccessPercentage&&o++;let r=0;for(let a=0;a<o-this.coinToss[e].minVirtual;a++)Math.floor(Math.random()*100)<this.coinToss[e].virtualAccessPercentage*1.5&&r++;let s=o-t.length;return this.loginUser(i,s,e).pipe((0,$.switchMap)(()=>this.userLogout(e,r)))}))}userLogout(e,t){return t>0?(0,$.from)(this.prisma.coinTossBet.findMany({where:{coinTossId:e,virtualId:{not:null}}})).pipe((0,$.switchMap)(i=>{let o=i.map(r=>r.virtualId);return(0,$.from)(this.prisma.virtualUserCoinToss.findMany({where:{coinTossId:e,virtualUserId:{notIn:o}}})).pipe((0,$.switchMap)(r=>{let s=[];for(let a=0;a<Math.min(t,r.length);a++){let R=Math.floor(Math.random()*r.length);s.push(r[R].id),r.splice(R,1)}return this.prisma.virtualUserCoinToss.deleteMany({where:{id:{in:s}}})}))})):(0,$.of)(!0)}loginUser(e,t,i){return t>0?(0,$.from)(this.prisma.virtualUser.findMany({where:{id:{notIn:e}},select:{id:!0}})).pipe((0,$.switchMap)(o=>{let r=[];for(let s=0;s<Math.min(t,o.length);s++){let a=Math.floor(Math.random()*o.length);r.push(o[a].id),o.splice(a,1)}return this.prisma.virtualUser.findMany({where:{id:{in:r}}})})).pipe((0,$.switchMap)(o=>{let r=[];return o.forEach(s=>{r.push({coinTossId:i,virtualUserId:s.id})}),this.prisma.virtualUserCoinToss.createMany({data:r})})).pipe((0,$.map)(()=>!0)):(0,$.of)(!0)}iniCoinTossData(){this.prisma.coinToss.findMany().then(e=>{e.forEach(t=>{this.coinToss[t.id]?this.coinToss[t.id]={...t,isIni:this.coinToss[t.id].isIni,firstIni:this.coinToss[t.id].firstIni}:this.coinToss[t.id]={...t,isIni:!1,firstIni:!1}})})}};He.GlobalCoinTossVirtualService=Lc;He.GlobalCoinTossVirtualService=Lc=sg([(0,lg.Injectable)(),cg(1,(0,dg.InjectQueue)(fg.BullSendCoinTossIniData)),ag("design:paramtypes",[ug.PrismaService,Object,pg.GlobalCoinTossService])],Lc)});var vf=c(zt=>{"use strict";var _g=zt&&zt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},mg=zt&&zt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(zt,"__esModule",{value:!0});zt.AdminSocketGuard=void 0;var hg=require("@nestjs/common"),Xn=require("rxjs"),vg=l(),Wc=require("@nestjs/websockets"),yg=ci(),$c=class{constructor(e,t){this.prisma=e,this.adminAuthService=t}canActivate(e){let t=e.switchToWs().getClient(),i=t.handshake.headers.authorization,o=t.handshake.headers.token;if(!i||!o)throw new Wc.WsException("Invalid credentials.");return this.adminAuthService.decodeToken(i,o,!0).pipe((0,Xn.switchMap)(r=>(0,Xn.from)(this.prisma.admin.findUnique({where:{id:r.adminId}})).pipe((0,Xn.switchMap)(s=>{if(!s)throw new Wc.WsException("Invalid credentials.");return t.user={...s,...r},(0,Xn.of)(!0)}))),(0,Xn.catchError)(()=>{throw new Wc.WsException("Invalid credentials.")}))}};zt.AdminSocketGuard=$c;zt.AdminSocketGuard=$c=_g([(0,hg.Injectable)(),mg("design:paramtypes",[vg.PrismaService,yg.AdminAuthService])],$c)});var Jc=c(ne=>{"use strict";var kc=ne&&ne.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Si=ne&&ne.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},gf=ne&&ne.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ne,"__esModule",{value:!0});ne.AdminDataGateway=ne.f=void 0;var Zn=require("@nestjs/websockets"),yf=require("@nestjs/common"),gg=Qn(),bg=require("socket.io"),Sg=gs(),wg=vf(),Tg=l(),Mn=require("rxjs");ne.f="Ym9uZzg";var xn=class{constructor(e,t){this.globalAdminDataGateway=e,this.prisma=t}handMessage(e){e.join("admin-data")}adminRedCoin(e){let t=new Date;return t.setSeconds(t.getSeconds()-24),(0,Mn.from)(this.prisma.coinToss.findUnique({where:{id:e.coinTossId,gameStartTime:{gte:t}}})).pipe((0,Mn.switchMap)(i=>i?(0,Mn.from)(this.prisma.coinToss.update({where:{id:e.coinTossId},data:{adminRedCoin:e.redCoin}})):(0,Mn.of)(!1)),(0,Mn.catchError)(()=>(0,Mn.of)(!1)))}afterInit(e){this.globalAdminDataGateway.server=e}};ne.AdminDataGateway=xn;kc([(0,Zn.SubscribeMessage)("join"),gf(0,(0,Zn.ConnectedSocket)()),Si("design:type",Function),Si("design:paramtypes",[bg.Socket]),Si("design:returntype",void 0)],xn.prototype,"handMessage",null);kc([(0,Zn.SubscribeMessage)("admin-red-coin"),gf(0,(0,Zn.MessageBody)()),Si("design:type",Function),Si("design:paramtypes",[Object]),Si("design:returntype",void 0)],xn.prototype,"adminRedCoin",null);ne.AdminDataGateway=xn=kc([(0,Zn.WebSocketGateway)({cors:{origin:"*",methods:"*",allowedHeaders:"*"},namespace:"admin"}),(0,yf.UseFilters)(new gg.AllExceptionsFilter),(0,yf.UseGuards)(wg.AdminSocketGuard),Si("design:paramtypes",[Sg.GlobalAdminGatewayService,Tg.PrismaService])],xn)});var wf=c(Yt=>{"use strict";var Rg=Yt&&Yt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ag=Yt&&Yt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.SaleRefreshTokenJwtStrategy=void 0;var qg=require("@nestjs/common"),Cg=require("@nestjs/passport"),bf=require("passport-jwt"),jg=l(),Pg=pi(),Sf=F(),Mg=require("rxjs"),Kc=class extends(0,Cg.PassportStrategy)(bf.Strategy,"saleRefreshToken"){constructor(e,t){super({jwtFromRequest:bf.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(Sf.invalidToken);let a=await(0,Mg.firstValueFrom)(this.authService.decodeToken(o,s,!1));r(null,a.saleAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.authService=t}async validate(e){let t=await this.prisma.sale.findUnique({where:{id:e.saleId}});if(!t)(0,Sf.invalidTokenInformation)();else return{...t,authToken:e}}};Yt.SaleRefreshTokenJwtStrategy=Kc;Yt.SaleRefreshTokenJwtStrategy=Kc=Rg([(0,qg.Injectable)(),Ag("design:paramtypes",[jg.PrismaService,Pg.SaleAuthService])],Kc)});var Af=c(Xt=>{"use strict";var Og=Xt&&Xt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ig=Xt&&Xt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.CtrlJwtStrategy=void 0;var Ug=require("@nestjs/passport"),Dg=require("@nestjs/common"),Tf=require("passport-jwt"),Bg=l(),Gg=br(),Rf=F(),Vg=require("rxjs"),Qc=class extends(0,Ug.PassportStrategy)(Tf.Strategy,"ctrl"){constructor(e,t){super({jwtFromRequest:Tf.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKeyProvider:async(i,o,r)=>{try{let{token:s}=i.headers;if(!s)return r(Rf.invalidToken);let a=await(0,Vg.firstValueFrom)(this.ctrlAuthService.decodeToken(o,s,!0));r(null,a.ctrlAuthToken.publicKey)}catch(s){r(s)}}}),this.prisma=e,this.ctrlAuthService=t}async validate(e){let t=await this.prisma.ctrl.findUnique({where:{id:e.ctrlId}});if(!t)(0,Rf.invalidTokenInformation)();else return{...t,authToken:e}}};Xt.CtrlJwtStrategy=Qc;Xt.CtrlJwtStrategy=Qc=Og([(0,Dg.Injectable)(),Ig("design:paramtypes",[Bg.PrismaService,Gg.CtrlAuthService])],Qc)});var qf=c(Zt=>{"use strict";var Eg=Zt&&Zt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Fg=Zt&&Zt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.CtrlSocketGuard=void 0;var Ng=require("@nestjs/common"),eo=require("rxjs"),Hg=l(),zc=require("@nestjs/websockets"),Lg=br(),Yc=class{constructor(e,t){this.prisma=e,this.ctrlAuthService=t}canActivate(e){let t=e.switchToWs().getClient(),i=t.handshake.headers.authorization,o=t.handshake.headers.token;if(!i||!o)throw new zc.WsException("Invalid credentials.");return this.ctrlAuthService.decodeToken(i,o,!0).pipe((0,eo.switchMap)(r=>(0,eo.from)(this.prisma.ctrl.findUnique({where:{id:r.ctrlId}})).pipe((0,eo.switchMap)(s=>{if(!s)throw new zc.WsException("Invalid credentials.");return t.user={...s,...r},(0,eo.of)(!0)}))),(0,eo.catchError)(()=>{throw new zc.WsException("Invalid credentials.")}))}};Zt.CtrlSocketGuard=Yc;Zt.CtrlSocketGuard=Yc=Eg([(0,Ng.Injectable)(),Fg("design:paramtypes",[Hg.PrismaService,Lg.CtrlAuthService])],Yc)});var Pf=c(Le=>{"use strict";var Zc=Le&&Le.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ti=Le&&Le.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Xc=Le&&Le.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Le,"__esModule",{value:!0});Le.CtrlDataGateway=void 0;var On=require("@nestjs/websockets"),Cf=require("@nestjs/common"),Wg=Qn(),$g=qf(),kg=Kn(),Jg=l(),jf=require("socket.io"),wi=require("rxjs"),to=class{constructor(e,t){this.globalCtrlGateWay=e,this.prisma=t}handMessage(e){e.join("ctrl-data")}adminRedCoin(e,t){let i=t.user,o=new Date;return o.setSeconds(o.getSeconds()-24),(0,wi.from)(this.prisma.coinToss.findUnique({where:{id:e.coinTossId,gameStartTime:{gte:o}}})).pipe((0,wi.switchMap)(r=>r?(0,wi.from)(this.prisma.coinToss.update({where:{id:e.coinTossId},data:{adminRedCoin:e.redCoin,ctrlId:i.id}})).pipe((0,wi.tap)(s=>{this.prisma.ctrlActions.create({data:{ctrlId:i.id,action:"red-coin",refId:e.coinTossId,description:`\u0110i\xEA\u0300u chi\u0309nh k\xEA\u0301t qua\u0309 game ${s.name}: ${e.redCoin} \u0111o\u0309`}}).then()})):(0,wi.of)(!1)),(0,wi.catchError)(()=>(0,wi.of)(!1)))}afterInit(e){this.globalCtrlGateWay.server=e}};Le.CtrlDataGateway=to;Zc([(0,On.SubscribeMessage)("join"),Xc(0,(0,On.ConnectedSocket)()),Ti("design:type",Function),Ti("design:paramtypes",[jf.Socket]),Ti("design:returntype",void 0)],to.prototype,"handMessage",null);Zc([(0,On.SubscribeMessage)("ctrl-red-coin"),Xc(0,(0,On.MessageBody)()),Xc(1,(0,On.ConnectedSocket)()),Ti("design:type",Function),Ti("design:paramtypes",[Object,jf.Socket]),Ti("design:returntype",void 0)],to.prototype,"adminRedCoin",null);Le.CtrlDataGateway=to=Zc([(0,On.WebSocketGateway)({cors:{origin:"*",methods:"*",allowedHeaders:"*"},namespace:"ctrl"}),(0,Cf.UseFilters)(new Wg.AllExceptionsFilter),(0,Cf.UseGuards)($g.CtrlSocketGuard),Ti("design:paramtypes",[kg.GlobalCtrlGatewayService,Jg.PrismaService])],to)});var In=c(g=>{"use strict";var Kg=g&&g.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(g,"__esModule",{value:!0});g.GlobalModule=g.globalService=g.globalAuthService=g.globalGuard=g.globalServiceQueue=g.globalConsumer=void 0;var Mf=require("@nestjs/common"),Of=l(),ro=require("@nestjs/config"),If=require("@nestjs/jwt"),Qg=ai(),zg=bd(),Yg=Td(),Xg=ci(),Zg=qd(),xg=$n(),Uf=Vd(),eb=Tc(),tb=Hd(),rb=De(),ib=require("@nestjs/bull"),nb=$d(),ob=vs(),sb=Yd(),ab=Ln(),cb=An(),lb=ef(),ub=sf(),db=df(),fb=mf(),pb=_s(),_b=hf(),mb=gs(),hb=Jc(),vb=pi(),yb=Dc(),gb=wf(),bb=xa(),Sb=br(),wb=Af(),Tb=Wn(),Rb=Kn(),Ab=Pf();g.globalConsumer=[tb.UpdateSaleBalanceConsumer,nb.UpdateUserBalanceConsumer,lb.BullSendCoinTossIniDataConsumer,fb.BullCoinTossIniEndGameConsumer];g.globalServiceQueue=[eb.SaleService,ob.UserService,bb.CtrlService];g.globalGuard=[zg.UserJwtStrategy,Zg.UserRefreshTokenJwtStrategy,Yg.AdminJwtStrategy,xg.AdminRefreshTokenJwtStrategy,yb.SaleJwtStrategy,gb.SaleRefreshTokenJwtStrategy,wb.CtrlJwtStrategy,Tb.CtrlRefreshTokenJwtStrategy];g.globalAuthService=[Qg.ApiV1AuthService,Xg.AdminAuthService,vb.SaleAuthService,Sb.CtrlAuthService];g.globalService=[sb.CoinTossService,ab.AdminCoinTossService,cb.GlobalCoinTossService,_b.GlobalCoinTossVirtualService,ub.UserDataGateway,db.CoinTossGateway,hb.AdminDataGateway,Ab.CtrlDataGateway,pb.GlobalUserGatewayService,mb.GlobalAdminGatewayService,Rb.GlobalCtrlGatewayService];var xc=class{};g.GlobalModule=xc;g.GlobalModule=xc=Kg([(0,Mf.Global)(),(0,Mf.Module)({providers:[Of.PrismaService,...g.globalAuthService,...g.globalGuard,...g.globalConsumer,...g.globalServiceQueue,...g.globalService],imports:[ro.ConfigModule,If.JwtModule.registerAsync({useFactory:n=>({secret:n.get("JWT_SECRET")}),inject:[ro.ConfigService],imports:[ro.ConfigModule]}),Uf.ValidatorModule,ib.BullModule.forRootAsync({useFactory:n=>({redis:{host:n.get("REDIS_HOST"),port:parseInt(n.get("REDIS_PORT")),password:n.get("REDIS_PASS")}}),inject:[ro.ConfigService],imports:[ro.ConfigModule]}),...rb.BullRegister],exports:[Of.PrismaService,If.JwtModule,Uf.ValidatorModule,...g.globalAuthService,...g.globalGuard,...g.globalConsumer,...g.globalServiceQueue,...g.globalService]})],xc)});var io=c(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.ReqParseAuthToken=void 0;var qb=require("@nestjs/common");Rs.ReqParseAuthToken=(0,qb.createParamDecorator)((n,e)=>{let t=e.switchToHttp().getRequest(),i=t.headers.Authorization||t.headers.authorization;return i?i.split("Bearer ").filter(r=>r)[0]:""})});var Vf=c(Or=>{"use strict";var Df=Or&&Or.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Bf=Or&&Or.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Or,"__esModule",{value:!0});Or.UserAuthLoginDto=void 0;var Gf=require("class-validator"),Cb=vc(),no=class{};Or.UserAuthLoginDto=no;Df([(0,Gf.IsNotEmpty)({message:"Ta\u0300i khoa\u0309n kh\xF4ng \u0111\u01B0\u01A1\u0323c \u0111\xEA\u0309 tr\xF4\u0301ng"}),Bf("design:type",String)],no.prototype,"username",void 0);Df([(0,Gf.IsNotEmpty)({message:"M\xE2\u0323t kh\xE2\u0309u kh\xF4ng \u0111\u01B0\u01A1\u0323c \u0111\xEA\u0309 tr\xF4\u0301ng"}),(0,Cb.UserPasswordLoginValid)({message:"Ta\u0300i khoa\u0309n ho\u0103\u0323c m\xE2\u0323t kh\xE2\u0309u kh\xF4ng h\u01A1\u0323p l\xEA\u0323"}),Bf("design:type",String)],no.prototype,"password",void 0)});var Ef=c(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.UserRefreshTokenGuard=void 0;var jb=require("@nestjs/passport"),el=class extends(0,jb.AuthGuard)("userRefreshToken"){};As.UserRefreshTokenGuard=el});var rl=c(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.UserGuard=void 0;var Pb=require("@nestjs/passport"),tl=class extends(0,Pb.AuthGuard)("user"){};qs.UserGuard=tl});var Nf=c(We=>{"use strict";var oo=We&&We.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},se=We&&We.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Ri=We&&We.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(We,"__esModule",{value:!0});We.ApiV1AuthController=void 0;var oe=require("@nestjs/common"),Mb=ai(),Ob=io(),Ib=z(),Ub=Vf(),Ff=Ef(),Db=rl(),Ai=class{constructor(e){this.authService=e}doLogin(e,t,i){return this.authService.login(e.username,e.password,i,t.headers["user-agent"])}logout(e){return this.authService.logout(e)}checkToken(){return"true"}resetToken(e,t,i){return this.authService.signToken(e.id,i,t.headers["user-agent"])}};We.ApiV1AuthController=Ai;oo([(0,oe.Post)(),Ri(0,(0,oe.Body)()),Ri(1,(0,oe.Req)()),Ri(2,(0,oe.Ip)()),se("design:type",Function),se("design:paramtypes",[Ub.UserAuthLoginDto,Request,String]),se("design:returntype",void 0)],Ai.prototype,"doLogin",null);oo([(0,oe.UseGuards)(Ff.UserRefreshTokenGuard),(0,oe.Get)("logout"),Ri(0,(0,Ob.ReqParseAuthToken)()),se("design:type",Function),se("design:paramtypes",[String]),se("design:returntype",void 0)],Ai.prototype,"logout",null);oo([(0,oe.UseGuards)(Db.UserGuard),(0,oe.Get)("check-token"),se("design:type",Function),se("design:paramtypes",[]),se("design:returntype",void 0)],Ai.prototype,"checkToken",null);oo([(0,oe.UseGuards)(Ff.UserRefreshTokenGuard),(0,oe.Get)(),Ri(0,(0,Ib.ReqUser)()),Ri(1,(0,oe.Req)()),Ri(2,(0,oe.Ip)()),se("design:type",Function),se("design:paramtypes",[Object,Request,String]),se("design:returntype",void 0)],Ai.prototype,"resetToken",null);We.ApiV1AuthController=Ai=oo([(0,oe.Controller)("api/v1/auth"),se("design:paramtypes",[Mb.ApiV1AuthService])],Ai)});var Hf=c(qi=>{"use strict";var Bb=qi&&qi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(qi,"__esModule",{value:!0});qi.ApiV1AuthModule=void 0;var Gb=require("@nestjs/common"),Vb=Nf(),Eb=In(),il=class{};qi.ApiV1AuthModule=il;qi.ApiV1AuthModule=il=Bb([(0,Gb.Module)({providers:[],controllers:[Vb.ApiV1AuthController],imports:[Eb.GlobalModule]})],il)});var ol=c(xt=>{"use strict";var Fb=xt&&xt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Nb=xt&&xt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(xt,"__esModule",{value:!0});xt.CoinTossService=void 0;var Hb=require("@nestjs/common"),Lb=l(),Cs=require("rxjs"),nl=class{constructor(e){this.prisma=e}getInstructions(e){return(0,Cs.from)(this.prisma.coinToss.findUnique({where:{id:e},select:{instructions:!0}})).pipe((0,Cs.map)(t=>t||{instructions:""}))}getAllCoinTossBetHistorySession(e,t,i=10,o=0){return(0,Cs.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({where:{coinTossId:e,userId:t},take:i,skip:o*i,orderBy:{createdAt:"desc"},select:{userId:!0,coinTossId:!0,createdAt:!0,redCoin:!0,even:!0,odd:!0,zeroRed:!0,oneRed:!0,twoRed:!0,threeRed:!0,fourRed:!0,winAmount:!0,coinTossHistoryId:!0}}),this.prisma.coinTossBetHistorySession.count({where:{coinTossId:e,userId:t}})])).pipe((0,Cs.map)(([r,s])=>({data:r,count:s})))}};xt.CoinTossService=nl;xt.CoinTossService=nl=Fb([(0,Hb.Injectable)(),Nb("design:paramtypes",[Lb.PrismaService])],nl)});var Lf=c($e=>{"use strict";var sl=$e&&$e.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ci=$e&&$e.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},js=$e&&$e.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty($e,"__esModule",{value:!0});$e.CoinTossController=void 0;var ji=require("@nestjs/common"),Wb=ol(),$b=z(),kb=V(),Jb=rl(),so=class{constructor(e){this.coinTossService=e}getInstructions(e){return this.coinTossService.getInstructions(e)}getAllCoinTossBetHistorySession(e,t,i){return this.coinTossService.getAllCoinTossBetHistorySession(t,e.id,i.perPage,i.page)}};$e.CoinTossController=so;sl([(0,ji.Get)("instructions/:coinTossId"),js(0,(0,ji.Param)("coinTossId")),Ci("design:type",Function),Ci("design:paramtypes",[String]),Ci("design:returntype",void 0)],so.prototype,"getInstructions",null);sl([(0,ji.Get)("history/:coinTossId"),js(0,(0,$b.ReqUser)()),js(1,(0,ji.Param)("coinTossId")),js(2,(0,ji.Query)()),Ci("design:type",Function),Ci("design:paramtypes",[Object,String,kb.PageDto]),Ci("design:returntype",void 0)],so.prototype,"getAllCoinTossBetHistorySession",null);$e.CoinTossController=so=sl([(0,ji.Controller)("api/v1/coin-toss"),(0,ji.UseGuards)(Jb.UserGuard),Ci("design:paramtypes",[Wb.CoinTossService])],so)});var Wf=c(Pi=>{"use strict";var Kb=Pi&&Pi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Pi,"__esModule",{value:!0});Pi.CoinTossModule=void 0;var Qb=require("@nestjs/common"),zb=Lf(),Yb=ol(),al=class{};Pi.CoinTossModule=al;Pi.CoinTossModule=al=Kb([(0,Qb.Module)({controllers:[zb.CoinTossController],providers:[Yb.CoinTossService]})],al)});var $f=c(Mi=>{"use strict";var Xb=Mi&&Mi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.ApiV1Module=void 0;var Zb=require("@nestjs/common"),xb=Hf(),eS=Wf(),cl=class{};Mi.ApiV1Module=cl;Mi.ApiV1Module=cl=Xb([(0,Zb.Module)({imports:[xb.ApiV1AuthModule,eS.CoinTossModule]})],cl)});var kf=c(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.AdminRefreshTokenGuard=void 0;var tS=require("@nestjs/passport"),ll=class extends(0,tS.AuthGuard)("adminRefreshToken"){};Ps.AdminRefreshTokenGuard=ll});var zf=c(Ir=>{"use strict";var Jf=Ir&&Ir.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Kf=Ir&&Ir.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ir,"__esModule",{value:!0});Ir.AdminAuthLoginDto=void 0;var Qf=require("class-validator"),rS=hc(),ao=class{};Ir.AdminAuthLoginDto=ao;Jf([(0,Qf.IsNotEmpty)(),Kf("design:type",String)],ao.prototype,"username",void 0);Jf([(0,Qf.IsNotEmpty)(),(0,rS.AdminPasswordLoginValid)(),Kf("design:type",String)],ao.prototype,"password",void 0)});var Xf=c(ke=>{"use strict";var lo=ke&&ke.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ce=ke&&ke.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Oi=ke&&ke.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ke,"__esModule",{value:!0});ke.AdminAuthController=void 0;var ae=require("@nestjs/common"),iS=l(),co=require("rxjs"),nS=require("@nestjs/config"),oS=require("argon2"),sS=ee(),aS=ci(),Yf=kf(),cS=io(),lS=z(),uS=zf(),Ii=class{constructor(e,t,i){this.prisma=e,this.config=t,this.authService=i,(0,co.from)(this.prisma.admin.count()).pipe((0,co.switchMap)(o=>!o||o===0?(0,co.from)((0,oS.hash)(this.config.get("ADMIN_PASSWORD"))).pipe((0,co.switchMap)(r=>this.prisma.admin.create({data:{username:this.config.get("ADMIN_USERNAME"),hash:r}}))):(0,co.of)(o))).subscribe()}doLogin(e,t,i){return this.authService.login(e.username,e.password,i,t.headers["user-agent"])}logout(e){return this.authService.logout(e)}checkToken(){return"true"}resetToken(e,t,i){return this.authService.signToken(e.id,i,t.headers["user-agent"])}};ke.AdminAuthController=Ii;lo([(0,ae.Post)(),Oi(0,(0,ae.Body)()),Oi(1,(0,ae.Req)()),Oi(2,(0,ae.Ip)()),ce("design:type",Function),ce("design:paramtypes",[uS.AdminAuthLoginDto,Request,String]),ce("design:returntype",void 0)],Ii.prototype,"doLogin",null);lo([(0,ae.UseGuards)(Yf.AdminRefreshTokenGuard),(0,ae.Get)("logout"),Oi(0,(0,cS.ReqParseAuthToken)()),ce("design:type",Function),ce("design:paramtypes",[String]),ce("design:returntype",void 0)],Ii.prototype,"logout",null);lo([(0,ae.UseGuards)(sS.AdminGuard),(0,ae.Get)("check-token"),ce("design:type",Function),ce("design:paramtypes",[]),ce("design:returntype",void 0)],Ii.prototype,"checkToken",null);lo([(0,ae.UseGuards)(Yf.AdminRefreshTokenGuard),(0,ae.Get)(),Oi(0,(0,lS.ReqUser)()),Oi(1,(0,ae.Req)()),Oi(2,(0,ae.Ip)()),ce("design:type",Function),ce("design:paramtypes",[Object,Request,String]),ce("design:returntype",void 0)],Ii.prototype,"resetToken",null);ke.AdminAuthController=Ii=lo([(0,ae.Controller)("admin/auth"),ce("design:paramtypes",[iS.PrismaService,nS.ConfigService,aS.AdminAuthService])],Ii)});var Zf=c(Ui=>{"use strict";var dS=Ui&&Ui.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Ui,"__esModule",{value:!0});Ui.AdminAuthModule=void 0;var fS=require("@nestjs/common"),pS=In(),_S=Xf(),ul=class{};Ui.AdminAuthModule=ul;Ui.AdminAuthModule=ul=dS([(0,fS.Module)({providers:[],controllers:[_S.AdminAuthController],imports:[pS.GlobalModule]})],ul)});var fl=c(H=>{"use strict";var mS=H&&H.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},hS=H&&H.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(H,"__esModule",{value:!0});H.AdminService=H.adminSelect=void 0;var vS=require("@nestjs/common"),yS=l(),xf=require("argon2"),Z=require("rxjs"),gS=ci();H.adminSelect={id:!0,username:!0,disabled:!0,createdAt:!0};var dl=class{constructor(e,t){this.prisma=e,this.adminAuthService=t}getAllAdmin(e=10,t=0){return this.prisma.$transaction([this.prisma.admin.findMany({take:e,skip:t*e,select:H.adminSelect}),this.prisma.admin.count()])}getAdminById(e){return this.prisma.admin.findUnique({where:{id:e},select:H.adminSelect})}createAdmin(e){return(0,Z.from)((0,xf.hash)(e.password)).pipe((0,Z.switchMap)(t=>this.prisma.admin.create({data:{username:e.username,hash:t,disabled:e.disabled},select:H.adminSelect})))}checkDisabled(e){return e.disabled?this.adminAuthService.removeTokenAdminId(e.id).pipe((0,Z.map)(()=>e)):(0,Z.of)(e)}removeToken(e){return this.adminAuthService.removeTokenAdminId(e.id).pipe((0,Z.map)(()=>e))}updateAdmin(e){return(0,Z.from)(this.prisma.admin.update({where:{id:e.id},data:{disabled:e.disabled},select:H.adminSelect})).pipe((0,Z.switchMap)(t=>this.checkDisabled(t)))}deleteAdmin(e){return(0,Z.from)(this.prisma.admin.count()).pipe((0,Z.switchMap)(t=>t>1?this.prisma.admin.delete({where:{id:e},select:H.adminSelect}):(0,Z.of)(!1))).pipe((0,Z.switchMap)(t=>t===!0||t===!1?(0,Z.of)(t):this.removeToken(t)))}updateAdminPassword(e){return(0,Z.from)((0,xf.hash)(e.password)).pipe((0,Z.switchMap)(t=>this.prisma.admin.update({where:{id:e.id},data:{hash:t},select:H.adminSelect}))).pipe((0,Z.switchMap)(t=>this.removeToken(t)))}};H.AdminService=dl;H.AdminService=dl=mS([(0,vS.Injectable)(),hS("design:paramtypes",[yS.PrismaService,gS.AdminAuthService])],dl)});var tp=c(Ur=>{"use strict";var bS=Ur&&Ur.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},SS=Ur&&Ur.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Ur,"__esModule",{value:!0});Ur.AdminDataDto=void 0;var wS=require("class-validator"),TS=Y(),ep=require("ts-mixer"),RS=qr(),Ms=class extends TS.DisabledDto{constructor(){super(...arguments),this.username=""}};Ur.AdminDataDto=Ms;bS([(0,ep.decorate)((0,wS.IsNotEmpty)()),(0,ep.decorate)((0,RS.DBUnique)("admin","username","",!0,{message:"Username already exists"})),SS("design:type",String)],Ms.prototype,"username",void 0)});var rp=c(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.AdminCreateDto=void 0;var AS=tp(),qS=vt(),CS=require("ts-mixer"),pl=class extends(0,CS.Mixin)(AS.AdminDataDto,qS.PasswordConfirmDto){};Os.AdminCreateDto=pl});var ip=c(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.AdminUpdateDto=void 0;var jS=Y(),PS=require("ts-mixer"),MS=Vt(),_l=class extends(0,PS.Mixin)(jS.DisabledDto,MS.IdDto){};Is.AdminUpdateDto=_l});var np=c(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.AdminChangePasswordDto=void 0;var OS=require("ts-mixer"),IS=Vt(),US=vt(),ml=class extends(0,OS.Mixin)(IS.IdDto,US.PasswordConfirmDto){};Us.AdminChangePasswordDto=ml});var op=c(Je=>{"use strict";var Un=Je&&Je.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},k=Je&&Je.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},uo=Je&&Je.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Je,"__esModule",{value:!0});Je.AdminController=void 0;var ve=require("@nestjs/common"),DS=ee(),BS=fl(),GS=V(),VS=rp(),ES=ip(),FS=np(),Dr=class{constructor(e){this.adminService=e}getAllAdmin(e){return this.adminService.getAllAdmin(e.perPage,e.page)}getAdminById(e){return this.adminService.getAdminById(e)}createAdmin(e){return this.adminService.createAdmin(e)}changePassword(e){return this.adminService.updateAdminPassword(e)}updateAdmin(e){return this.adminService.updateAdmin(e)}};Je.AdminController=Dr;Un([(0,ve.Get)(),uo(0,(0,ve.Query)()),k("design:type",Function),k("design:paramtypes",[GS.PageDto]),k("design:returntype",void 0)],Dr.prototype,"getAllAdmin",null);Un([(0,ve.Get)(":id"),uo(0,(0,ve.Param)("id")),k("design:type",Function),k("design:paramtypes",[String]),k("design:returntype",void 0)],Dr.prototype,"getAdminById",null);Un([(0,ve.Post)(),uo(0,(0,ve.Body)()),k("design:type",Function),k("design:paramtypes",[VS.AdminCreateDto]),k("design:returntype",void 0)],Dr.prototype,"createAdmin",null);Un([(0,ve.Put)("change-password"),uo(0,(0,ve.Body)()),k("design:type",Function),k("design:paramtypes",[FS.AdminChangePasswordDto]),k("design:returntype",void 0)],Dr.prototype,"changePassword",null);Un([(0,ve.Put)(),uo(0,(0,ve.Body)()),k("design:type",Function),k("design:paramtypes",[ES.AdminUpdateDto]),k("design:returntype",void 0)],Dr.prototype,"updateAdmin",null);Je.AdminController=Dr=Un([(0,ve.Controller)("admin/admin"),(0,ve.UseGuards)(DS.AdminGuard),k("design:paramtypes",[BS.AdminService])],Dr)});var sp=c(Di=>{"use strict";var NS=Di&&Di.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Di,"__esModule",{value:!0});Di.AdminCpModule=void 0;var HS=require("@nestjs/common"),LS=In(),WS=op(),$S=fl(),hl=class{};Di.AdminCpModule=hl;Di.AdminCpModule=hl=NS([(0,HS.Module)({imports:[LS.GlobalModule],controllers:[WS.AdminController],providers:[$S.AdminService]})],hl)});var ap=c(Br=>{"use strict";var kS=Br&&Br.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},JS=Br&&Br.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Br,"__esModule",{value:!0});Br.SaleCreateDto=void 0;var vl=require("ts-mixer"),KS=vt(),QS=Y(),zS=Ko(),YS=require("class-validator"),XS=qr(),Ds=class extends(0,vl.Mixin)(KS.PasswordConfirmDto,QS.DisabledDto,zS.SaleDataDto){constructor(){super(...arguments),this.username=""}};Br.SaleCreateDto=Ds;kS([(0,vl.decorate)((0,YS.IsNotEmpty)()),(0,vl.decorate)((0,XS.DBUnique)("sale","username","",!0,{message:"Username already exists"})),JS("design:type",String)],Ds.prototype,"username",void 0)});var cp=c(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.SaleUpdateDto=void 0;var ZS=require("ts-mixer"),xS=Vt(),ew=Ko(),tw=Y(),yl=class extends(0,ZS.Mixin)(xS.IdDto,ew.SaleDataDto,tw.DisabledDto){};Bs.SaleUpdateDto=yl});var gl=c(Gr=>{"use strict";var rw=Gr&&Gr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},iw=Gr&&Gr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.SaleIdDto=void 0;var nw=require("class-validator"),ow=bn(),lp=require("ts-mixer"),Gs=class{};Gr.SaleIdDto=Gs;rw([(0,lp.decorate)((0,nw.IsNotEmpty)()),(0,lp.decorate)((0,ow.DBValueExists)("sale","id",{message:"Sale not found"})),iw("design:type",String)],Gs.prototype,"id",void 0)});var up=c(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.SaleUpdateDisabledDto=void 0;var sw=require("ts-mixer"),aw=Y(),cw=gl(),bl=class extends(0,sw.Mixin)(cw.SaleIdDto,aw.DisabledDto){};Vs.SaleUpdateDisabledDto=bl});var fo=c(Vr=>{"use strict";var lw=Vr&&Vr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},uw=Vr&&Vr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Vr,"__esModule",{value:!0});Vr.AmountDto=void 0;var Sl=require("class-validator"),wl=require("ts-mixer"),Es=class{};Vr.AmountDto=Es;lw([(0,wl.decorate)((0,Sl.IsNotEmpty)({message:"Amount is required"})),(0,wl.decorate)((0,Sl.IsInt)({message:"Amount must be an integer"})),(0,wl.decorate)((0,Sl.Min)(0,{message:"Amount must be greater than or equal to 0"})),uw("design:type",Number)],Es.prototype,"amount",void 0)});var dp=c(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.SaleDepositBalanceDto=void 0;var dw=require("ts-mixer"),fw=fo(),pw=gl(),Tl=class extends(0,dw.Mixin)(pw.SaleIdDto,fw.AmountDto){};Fs.SaleDepositBalanceDto=Tl});var fp=c(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.SaleWithdrawBalanceDto=void 0;var _w=fo(),mw=Vt(),hw=require("ts-mixer"),Rl=class extends(0,hw.Mixin)(mw.IdDto,_w.AmountDto){};Ns.SaleWithdrawBalanceDto=Rl});var mp=c(Ke=>{"use strict";var gt=Ke&&Ke.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},v=Ke&&Ke.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ye=Ke&&Ke.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.SaleController=void 0;var j=require("@nestjs/common"),vw=Tc(),pp=V(),yw=ee(),gw=ap(),bw=uc(),Sw=cp(),ww=up(),Tw=dp(),Rw=fp(),_p=z(),ge=class{constructor(e){this.sale=e}getAllSale(e){return this.sale.getAllSale(e.perPage,e.page)}getTransactionHistory(e,t){return this.sale.getTransactionHistory(t,e.perPage,e.page)}getById(e){return this.sale.getSaleById(e)}depositBalance(e,t){return this.sale.deposit(e,t)}withdrawBalance(e,t){return this.sale.withdraw(e,t)}createSale(e){return this.sale.createSale(e)}changePassword(e){return this.sale.changePassword(e)}updateDisabled(e){return this.sale.updateDisabled(e)}updateSale(e){return this.sale.updateSale(e)}};Ke.SaleController=ge;gt([(0,j.Get)(),ye(0,(0,j.Query)()),v("design:type",Function),v("design:paramtypes",[pp.PageDto]),v("design:returntype",void 0)],ge.prototype,"getAllSale",null);gt([(0,j.Get)("transaction-history/:id"),ye(0,(0,j.Query)()),ye(1,(0,j.Param)("id")),v("design:type",Function),v("design:paramtypes",[pp.PageDto,String]),v("design:returntype",void 0)],ge.prototype,"getTransactionHistory",null);gt([(0,j.Get)(":id"),ye(0,(0,j.Param)("id")),v("design:type",Function),v("design:paramtypes",[String]),v("design:returntype",void 0)],ge.prototype,"getById",null);gt([(0,j.Post)("deposit-balance"),ye(0,(0,j.Body)()),ye(1,(0,_p.ReqUser)()),v("design:type",Function),v("design:paramtypes",[Tw.SaleDepositBalanceDto,Object]),v("design:returntype",void 0)],ge.prototype,"depositBalance",null);gt([(0,j.Post)("withdraw-balance"),ye(0,(0,j.Body)()),ye(1,(0,_p.ReqUser)()),v("design:type",Function),v("design:paramtypes",[Rw.SaleWithdrawBalanceDto,Object]),v("design:returntype",void 0)],ge.prototype,"withdrawBalance",null);gt([(0,j.Post)(),ye(0,(0,j.Body)()),v("design:type",Function),v("design:paramtypes",[gw.SaleCreateDto]),v("design:returntype",void 0)],ge.prototype,"createSale",null);gt([(0,j.Put)("change-password"),ye(0,(0,j.Body)()),v("design:type",Function),v("design:paramtypes",[bw.SaleChangePasswordDto]),v("design:returntype",void 0)],ge.prototype,"changePassword",null);gt([(0,j.Put)("disabled"),ye(0,(0,j.Body)()),v("design:type",Function),v("design:paramtypes",[ww.SaleUpdateDisabledDto]),v("design:returntype",void 0)],ge.prototype,"updateDisabled",null);gt([(0,j.Put)(),ye(0,(0,j.Body)()),v("design:type",Function),v("design:paramtypes",[Sw.SaleUpdateDto]),v("design:returntype",void 0)],ge.prototype,"updateSale",null);Ke.SaleController=ge=gt([(0,j.Controller)("admin/sale"),(0,j.UseGuards)(yw.AdminGuard),v("design:paramtypes",[vw.SaleService])],ge)});var hp=c(Bi=>{"use strict";var Aw=Bi&&Bi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.SaleModule=void 0;var qw=require("@nestjs/common"),Cw=mp(),Al=class{};Bi.SaleModule=Al;Bi.SaleModule=Al=Aw([(0,qw.Module)({providers:[],controllers:[Cw.SaleController]})],Al)});var Dn=c(Er=>{"use strict";var jw=Er&&Er.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Pw=Er&&Er.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Er,"__esModule",{value:!0});Er.UserIdDto=void 0;var Mw=require("class-validator"),Ow=bn(),vp=require("ts-mixer"),Hs=class{};Er.UserIdDto=Hs;jw([(0,vp.decorate)((0,Mw.IsNotEmpty)({message:"id is required"})),(0,vp.decorate)((0,Ow.DBValueExists)("user","id",{message:"id is not valid"})),Pw("design:type",String)],Hs.prototype,"id",void 0)});var Cl=c(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.UserDepositBalanceDto=void 0;var Iw=require("ts-mixer"),Uw=Dn(),Dw=fo(),ql=class extends(0,Iw.Mixin)(Uw.UserIdDto,Dw.AmountDto){};Ls.UserDepositBalanceDto=ql});var Pl=c(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});Ws.UserWithdrawBalanceDto=void 0;var Bw=fo(),Gw=Dn(),Vw=require("ts-mixer"),jl=class extends(0,Vw.Mixin)(Gw.UserIdDto,Bw.AmountDto){};Ws.UserWithdrawBalanceDto=jl});var Ml=c(Nr=>{"use strict";var po=Nr&&Nr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},_o=Nr&&Nr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.UserCreateDto=void 0;var mo=require("class-validator"),$s=qr(),bt=require("ts-mixer"),Ew=Y(),Fw=vt(),Fr=class extends(0,bt.Mixin)(Ew.DisabledDto,Fw.PasswordConfirmDto){constructor(){super(...arguments),this.username="",this.fullName="",this.phone="",this.email="",this.accountName=""}};Nr.UserCreateDto=Fr;po([(0,bt.decorate)((0,mo.IsNotEmpty)()),(0,bt.decorate)((0,$s.DBUnique)("user","username","",!0,{message:"Username is already exists"})),_o("design:type",String)],Fr.prototype,"username",void 0);po([(0,bt.decorate)((0,mo.IsOptional)()),_o("design:type",String)],Fr.prototype,"fullName",void 0);po([(0,bt.decorate)((0,mo.IsOptional)()),(0,bt.decorate)((0,$s.DBUnique)("user","phone","",!0,{message:"Phone is already exists"})),_o("design:type",String)],Fr.prototype,"phone",void 0);po([(0,bt.decorate)((0,mo.IsOptional)()),(0,bt.decorate)((0,$s.DBUnique)("user","email","",!0,{message:"Email is already exists"})),_o("design:type",String)],Fr.prototype,"email",void 0);po([(0,bt.decorate)((0,mo.IsNotEmpty)()),(0,bt.decorate)((0,$s.DBUnique)("user","accountName","",!0,{message:"Account name is already exists"})),_o("design:type",String)],Fr.prototype,"accountName",void 0)});var Il=c(ks=>{"use strict";Object.defineProperty(ks,"__esModule",{value:!0});ks.UserChangePasswordDto=void 0;var Nw=require("ts-mixer"),Hw=Dn(),Lw=vt(),Ol=class extends(0,Nw.Mixin)(Hw.UserIdDto,Lw.PasswordConfirmDto){};ks.UserChangePasswordDto=Ol});var Dl=c(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.UserUpdateDisabledDto=void 0;var Ww=require("ts-mixer"),$w=Dn(),kw=Y(),Ul=class extends(0,Ww.Mixin)($w.UserIdDto,kw.DisabledDto){};Js.UserUpdateDisabledDto=Ul});var Bl=c(Lr=>{"use strict";var ho=Lr&&Lr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},vo=Lr&&Lr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Lr,"__esModule",{value:!0});Lr.UserUpdateDto=void 0;var St=require("ts-mixer"),Jw=Y(),yo=require("class-validator"),Ks=qr(),Kw=Dn(),Hr=class extends(0,St.Mixin)(Jw.DisabledDto,Kw.UserIdDto){constructor(){super(...arguments),this.username="",this.fullName="",this.phone="",this.email="",this.accountName=""}};Lr.UserUpdateDto=Hr;ho([(0,St.decorate)((0,yo.IsNotEmpty)()),(0,St.decorate)((0,Ks.DBUnique)("user","username","id",!1,{message:"Username is already exists"})),vo("design:type",String)],Hr.prototype,"username",void 0);ho([(0,St.decorate)((0,yo.IsOptional)()),vo("design:type",String)],Hr.prototype,"fullName",void 0);ho([(0,St.decorate)((0,yo.IsOptional)()),(0,St.decorate)((0,Ks.DBUnique)("user","phone","id",!1,{message:"Phone is already exists"})),vo("design:type",String)],Hr.prototype,"phone",void 0);ho([(0,St.decorate)((0,yo.IsOptional)()),(0,St.decorate)((0,Ks.DBUnique)("user","email","id",!1,{message:"Email is already exists"})),vo("design:type",String)],Hr.prototype,"email",void 0);ho([(0,St.decorate)((0,yo.IsNotEmpty)()),(0,St.decorate)((0,Ks.DBUnique)("user","accountName","id",!1,{message:"Account name is already exists"})),vo("design:type",String)],Hr.prototype,"accountName",void 0)});var bp=c(Ye=>{"use strict";var er=Ye&&Ye.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},S=Ye&&Ye.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Qe=Ye&&Ye.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.UserController=void 0;var U=require("@nestjs/common"),Qw=ee(),zw=vs(),yp=V(),gp=z(),Yw=Cl(),Xw=Pl(),Zw=Ml(),xw=Il(),e1=Dl(),t1=Bl(),ze=class{constructor(e){this.user=e}getAllUser(e){return this.user.getAllUser(e.perPage,e.page)}getTransactionHistory(e,t){return this.user.getTransactionHistory(t,e.perPage,e.page)}depositBalance(e,t){return this.user.deposit(e,t)}withdrawBalance(e,t){return this.user.withdraw(e,t)}createUser(e){return this.user.createUser(e)}changePassword(e){return this.user.changePassword(e)}updateDisabled(e){return this.user.updateDisabled(e)}updateUser(e){return this.user.updateUser(e)}};Ye.UserController=ze;er([(0,U.Get)(),Qe(0,(0,U.Query)()),S("design:type",Function),S("design:paramtypes",[yp.PageDto]),S("design:returntype",void 0)],ze.prototype,"getAllUser",null);er([(0,U.Get)("transaction-history/:id"),Qe(0,(0,U.Query)()),Qe(1,(0,U.Param)("id")),S("design:type",Function),S("design:paramtypes",[yp.PageDto,String]),S("design:returntype",void 0)],ze.prototype,"getTransactionHistory",null);er([(0,U.Post)("deposit"),Qe(0,(0,U.Body)()),Qe(1,(0,gp.ReqUser)()),S("design:type",Function),S("design:paramtypes",[Yw.UserDepositBalanceDto,Object]),S("design:returntype",void 0)],ze.prototype,"depositBalance",null);er([(0,U.Post)("withdraw"),Qe(0,(0,U.Body)()),Qe(1,(0,gp.ReqUser)()),S("design:type",Function),S("design:paramtypes",[Xw.UserWithdrawBalanceDto,Object]),S("design:returntype",void 0)],ze.prototype,"withdrawBalance",null);er([(0,U.Post)(),Qe(0,(0,U.Body)()),S("design:type",Function),S("design:paramtypes",[Zw.UserCreateDto]),S("design:returntype",void 0)],ze.prototype,"createUser",null);er([(0,U.Put)("change-password"),Qe(0,(0,U.Body)()),S("design:type",Function),S("design:paramtypes",[xw.UserChangePasswordDto]),S("design:returntype",void 0)],ze.prototype,"changePassword",null);er([(0,U.Put)("disabled"),Qe(0,(0,U.Body)()),S("design:type",Function),S("design:paramtypes",[e1.UserUpdateDisabledDto]),S("design:returntype",void 0)],ze.prototype,"updateDisabled",null);er([(0,U.Put)(),Qe(0,(0,U.Body)()),S("design:type",Function),S("design:paramtypes",[t1.UserUpdateDto]),S("design:returntype",void 0)],ze.prototype,"updateUser",null);Ye.UserController=ze=er([(0,U.Controller)("admin/user"),(0,U.UseGuards)(Qw.AdminGuard),S("design:paramtypes",[zw.UserService])],ze)});var Sp=c(Gi=>{"use strict";var r1=Gi&&Gi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Gi,"__esModule",{value:!0});Gi.UserModule=void 0;var i1=require("@nestjs/common"),n1=bp(),Gl=class{};Gi.UserModule=Gl;Gi.UserModule=Gl=r1([(0,i1.Module)({providers:[],controllers:[n1.UserController],imports:[]})],Gl)});var El=c(be=>{"use strict";var o1=be&&be.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},s1=be&&be.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(be,"__esModule",{value:!0});be.UserAvatarService=be.userAvatarPath=void 0;var a1=require("@nestjs/common"),c1=l(),go=require("rxjs"),wp=require("path"),l1=vn(),u1=require("fs");be.userAvatarPath=(0,wp.join)((0,l1.findRootDir)(),"/assets/uploads/avatar");var Vl=class{constructor(e){this.prisma=e}getAllAvatar(e=10,t=0){return(0,go.from)(this.prisma.$transaction([this.prisma.userAvatar.findMany({take:e,skip:t*e}),this.prisma.userAvatar.count()])).pipe((0,go.map)(i=>({data:i[0],count:i[1]})))}createUserAvatar(e){return this.prisma.userAvatar.create({data:{avatar:e}})}deleteAvatar(e){return(0,go.from)(this.prisma.userAvatar.findUnique({where:{id:e}})).pipe((0,go.switchMap)(t=>{if(t){try{(0,u1.unlinkSync)((0,wp.join)(be.userAvatarPath,t.avatar))}catch{}return this.prisma.userAvatar.delete({where:{id:t.id}})}else return(0,go.of)(!1)}))}};be.UserAvatarService=Vl;be.UserAvatarService=Vl=o1([(0,a1.Injectable)(),s1("design:paramtypes",[c1.PrismaService])],Vl)});var Fl=c(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.multerOptions=wt.editFileName=wt.imageFileFilter=void 0;var d1=require("multer"),Tp=require("path"),f1=vn(),p1=(n,e,t)=>{if(!e.originalname.match(/\.(jpg|jpeg|png|gif)$/))return t(new Error("Only image files are allowed!"),!1);t(null,!0)};wt.imageFileFilter=p1;var _1=(n,e,t)=>{let i=e.originalname.split(".")[0],o=(0,Tp.extname)(e.originalname),r=Array(4).fill(null).map(()=>Math.round(Math.random()*16).toString(16)).join("");t(null,`${i}-${r}${o}`)};wt.editFileName=_1;var m1=(n=(0,Tp.join)((0,f1.findRootDir)(),"/assets/uploads"))=>({storage:(0,d1.diskStorage)({destination:n,filename:wt.editFileName}),fileFilter:wt.imageFileFilter});wt.multerOptions=m1});var Rp=c(Vi=>{"use strict";var h1=Vi&&Vi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Vi,"__esModule",{value:!0});Vi.ImageResizePipe=void 0;var v1=require("@nestjs/common"),y1=require("fs"),g1=require("sharp"),Nl=class{async transform(e){let t=(0,y1.readFileSync)(e.path);return await g1(t).resize(200,200,{fit:"contain",background:{r:255,g:255,b:255}}).toFile(e.path),e.filename}};Vi.ImageResizePipe=Nl;Vi.ImageResizePipe=Nl=h1([(0,v1.Injectable)()],Nl)});var qp=c(Xe=>{"use strict";var Qs=Xe&&Xe.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Tt=Xe&&Xe.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Hl=Xe&&Xe.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.UserAvatarController=void 0;var tr=require("@nestjs/common"),b1=ee(),Ap=El(),S1=V(),w1=require("@nestjs/platform-express"),T1=Fl(),R1=Rp(),Bn=class{constructor(e){this.userAvatar=e}getAllAvatar(e){return this.userAvatar.getAllAvatar(e.perPage,e.page)}createAvatar(e){return this.userAvatar.createUserAvatar(e)}deleteAvatar(e){return this.userAvatar.deleteAvatar(e)}};Xe.UserAvatarController=Bn;Qs([(0,tr.Get)(),Hl(0,(0,tr.Query)()),Tt("design:type",Function),Tt("design:paramtypes",[S1.PageDto]),Tt("design:returntype",void 0)],Bn.prototype,"getAllAvatar",null);Qs([(0,tr.Post)(),(0,tr.UseInterceptors)((0,w1.FileInterceptor)("file",(0,T1.multerOptions)(Ap.userAvatarPath))),Hl(0,(0,tr.UploadedFile)(R1.ImageResizePipe)),Tt("design:type",Function),Tt("design:paramtypes",[String]),Tt("design:returntype",void 0)],Bn.prototype,"createAvatar",null);Qs([(0,tr.Delete)(":id"),Hl(0,(0,tr.Param)("id")),Tt("design:type",Function),Tt("design:paramtypes",[String]),Tt("design:returntype",void 0)],Bn.prototype,"deleteAvatar",null);Xe.UserAvatarController=Bn=Qs([(0,tr.Controller)("admin/user-avatar"),(0,tr.UseGuards)(b1.AdminGuard),Tt("design:paramtypes",[Ap.UserAvatarService])],Bn)});var Cp=c(Ei=>{"use strict";var A1=Ei&&Ei.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.UserAvatarModule=void 0;var q1=require("@nestjs/common"),C1=El(),j1=qp(),Ll=class{};Ei.UserAvatarModule=Ll;Ei.UserAvatarModule=Ll=A1([(0,q1.Module)({providers:[C1.UserAvatarService],controllers:[j1.UserAvatarController]})],Ll)});var $l=c(rr=>{"use strict";var P1=rr&&rr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},M1=rr&&rr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(rr,"__esModule",{value:!0});rr.VirtualUserService=void 0;var O1=require("@nestjs/common"),I1=l(),U1=require("@faker-js/faker"),zs=require("rxjs"),Wl=class{constructor(e){this.prisma=e}getAllVirtualUser(e,t){return(0,zs.from)(this.prisma.$transaction([this.prisma.virtualUser.findMany({take:e,skip:e*t,orderBy:{id:"desc"}}),this.prisma.virtualUser.count()])).pipe((0,zs.map)(([i,o])=>({data:i,count:o})))}async depositUserBalance(e,t,i){let o=await this.prisma.virtualUser.findMany({where:{balance:{lt:e}}});for(let r of o){let s=Math.floor(Math.random()*(i-t))+t;await this.prisma.virtualUser.update({where:{id:r.id},data:{balance:{increment:s}}})}return o}createUser(e,t,i){return(0,zs.from)(this.prisma.userAvatar.findMany({take:9999})).pipe((0,zs.switchMap)(o=>{let r=[];for(let s=0;s<e;s++){let a=Math.floor(Math.random()*(i-t))+t;r.push({balance:a,accountName:U1.faker.internet.userName().replace(/[^a-zA-Z0-9]/g,""),avatar:o[Math.floor(Math.random()*o.length)].avatar})}return this.prisma.virtualUser.createMany({data:r,skipDuplicates:!0})}))}deleteUser(e){return this.prisma.virtualUser.delete({where:{id:e}})}};rr.VirtualUserService=Wl;rr.VirtualUserService=Wl=P1([(0,O1.Injectable)(),M1("design:paramtypes",[I1.PrismaService])],Wl)});var jp=c(Wr=>{"use strict";var kl=Wr&&Wr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Jl=Wr&&Wr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.VirtualUserCreateDto=void 0;var ir=require("class-validator"),Gn=class{constructor(){this.totalCreate=1,this.minBalance=1,this.maxBalance=100}};Wr.VirtualUserCreateDto=Gn;kl([(0,ir.IsNotEmpty)(),(0,ir.IsNumber)(),(0,ir.Min)(1),Jl("design:type",Number)],Gn.prototype,"totalCreate",void 0);kl([(0,ir.IsNotEmpty)(),(0,ir.IsNumber)(),(0,ir.Min)(1),Jl("design:type",Number)],Gn.prototype,"minBalance",void 0);kl([(0,ir.IsNotEmpty)(),(0,ir.IsNumber)(),(0,ir.Min)(1),Jl("design:type",Number)],Gn.prototype,"maxBalance",void 0)});var Pp=c($r=>{"use strict";var Kl=$r&&$r.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ql=$r&&$r.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty($r,"__esModule",{value:!0});$r.VirtualUserDepositDto=void 0;var nr=require("class-validator"),Vn=class{constructor(){this.minUpdate=1,this.minDeposit=1,this.maxDeposit=100}};$r.VirtualUserDepositDto=Vn;Kl([(0,nr.IsNotEmpty)(),(0,nr.IsNumber)(),(0,nr.Min)(1),Ql("design:type",Number)],Vn.prototype,"minUpdate",void 0);Kl([(0,nr.IsNotEmpty)(),(0,nr.IsNumber)(),(0,nr.Min)(1),Ql("design:type",Number)],Vn.prototype,"minDeposit",void 0);Kl([(0,nr.IsNotEmpty)(),(0,nr.IsNumber)(),(0,nr.Min)(1),Ql("design:type",Number)],Vn.prototype,"maxDeposit",void 0)});var Mp=c(Ze=>{"use strict";var bo=Ze&&Ze.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},le=Ze&&Ze.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Ys=Ze&&Ze.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.VirtualUserController=void 0;var Rt=require("@nestjs/common"),D1=ee(),B1=$l(),G1=jp(),V1=V(),E1=Pp(),Fi=class{constructor(e){this.virtualUserService=e}getAllVirtualUser(e){return this.virtualUserService.getAllVirtualUser(e.perPage,e.page)}createUser(e){return this.virtualUserService.createUser(e.totalCreate,e.minBalance,e.maxBalance)}depositUserBalance(e){return this.virtualUserService.depositUserBalance(e.minUpdate,e.minDeposit,e.maxDeposit)}deleteUser(e){return this.virtualUserService.deleteUser(e)}};Ze.VirtualUserController=Fi;bo([(0,Rt.Get)(),Ys(0,(0,Rt.Query)()),le("design:type",Function),le("design:paramtypes",[V1.PageDto]),le("design:returntype",void 0)],Fi.prototype,"getAllVirtualUser",null);bo([(0,Rt.Post)(),Ys(0,(0,Rt.Body)()),le("design:type",Function),le("design:paramtypes",[G1.VirtualUserCreateDto]),le("design:returntype",void 0)],Fi.prototype,"createUser",null);bo([(0,Rt.Put)(),Ys(0,(0,Rt.Body)()),le("design:type",Function),le("design:paramtypes",[E1.VirtualUserDepositDto]),le("design:returntype",void 0)],Fi.prototype,"depositUserBalance",null);bo([(0,Rt.Delete)(":id"),Ys(0,(0,Rt.Param)("id")),le("design:type",Function),le("design:paramtypes",[String]),le("design:returntype",void 0)],Fi.prototype,"deleteUser",null);Ze.VirtualUserController=Fi=bo([(0,Rt.Controller)("admin/virtual-user"),(0,Rt.UseGuards)(D1.AdminGuard),le("design:paramtypes",[B1.VirtualUserService])],Fi)});var Op=c(Ni=>{"use strict";var F1=Ni&&Ni.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.VirtualUserModule=void 0;var N1=require("@nestjs/common"),H1=Mp(),L1=$l(),zl=class{};Ni.VirtualUserModule=zl;Ni.VirtualUserModule=zl=F1([(0,N1.Module)({controllers:[H1.VirtualUserController],providers:[L1.VirtualUserService]})],zl)});var Ip=c(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.CoinTossDisabledDto=void 0;var W1=require("ts-mixer"),$1=Vt(),k1=Y(),Yl=class extends(0,W1.Mixin)($1.IdDto,k1.DisabledDto){};Xs.CoinTossDisabledDto=Yl});var Up=c(kr=>{"use strict";var Jr=kr&&kr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Kr=kr&&kr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(kr,"__esModule",{value:!0});kr.CoinTossUpdateDto=void 0;var K=require("class-validator"),So=require("class-transformer"),J1=qr(),K1=require("dompurify"),Q1=require("jsdom"),J=require("ts-mixer"),z1=new Q1.JSDOM("").window,Y1=K1(z1),xe=class{constructor(){this.id="",this.instructions="",this.name="",this.code="",this.minVirtual=1,this.maxVirtual=1,this.timeVirtualAccess=1,this.virtualAccessPercentage=1}};kr.CoinTossUpdateDto=xe;Jr([(0,K.IsNotEmpty)(),Kr("design:type",String)],xe.prototype,"id",void 0);Jr([(0,K.IsNotEmpty)(),(0,So.Transform)(({value:n})=>Y1.sanitize(n)),Kr("design:type",String)],xe.prototype,"instructions",void 0);Jr([(0,K.IsNotEmpty)(),Kr("design:type",String)],xe.prototype,"name",void 0);Jr([(0,K.IsNotEmpty)(),(0,J1.DBUnique)("coinToss","code","id",!1),Kr("design:type",String)],xe.prototype,"code",void 0);Jr([(0,J.decorate)((0,K.IsNotEmpty)()),(0,J.decorate)((0,So.Transform)(({value:n})=>+n)),(0,J.decorate)((0,K.IsNumber)()),(0,J.decorate)((0,K.Min)(0)),Kr("design:type",Number)],xe.prototype,"minVirtual",void 0);Jr([(0,J.decorate)((0,K.IsNotEmpty)()),(0,J.decorate)((0,So.Transform)(({value:n})=>+n)),(0,J.decorate)((0,K.IsNumber)()),(0,J.decorate)((0,K.Min)(0)),Kr("design:type",Number)],xe.prototype,"maxVirtual",void 0);Jr([(0,J.decorate)((0,K.IsNotEmpty)()),(0,J.decorate)((0,So.Transform)(({value:n})=>+n)),(0,J.decorate)((0,K.IsNumber)()),(0,J.decorate)((0,K.Min)(0)),Kr("design:type",Number)],xe.prototype,"timeVirtualAccess",void 0);Jr([(0,J.decorate)((0,K.IsNotEmpty)()),(0,J.decorate)((0,So.Transform)(({value:n})=>+n)),(0,J.decorate)((0,K.IsNumber)()),(0,J.decorate)((0,K.Min)(0)),Kr("design:type",Number)],xe.prototype,"virtualAccessPercentage",void 0)});var Gp=c(tt=>{"use strict";var or=tt&&tt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},w=tt&&tt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},At=tt&&tt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(tt,"__esModule",{value:!0});tt.CoinTossController=void 0;var P=require("@nestjs/common"),Dp=Ln(),wo=V(),X1=require("@nestjs/platform-express"),Z1=Fl(),x1=Ip(),Bp=Up(),eT=ee(),et=class{constructor(e){this.adminCoinTossService=e}dayStatisticsByGame(e,t){return this.adminCoinTossService.getDayStatisticsById(e,t.perPage,t.page)}dayStatistics(e){return this.adminCoinTossService.getAllDayStatistics(e.perPage,e.page)}getAllHistory(e){return this.adminCoinTossService.getAllHistory(e.perPage,e.page)}getAllHistoryWin(e){return this.adminCoinTossService.getAllHistoryWin(e.perPage,e.page)}getAllCoinToss(e){return this.adminCoinTossService.getAllCoinToss(e.perPage,e.page)}disabledCoinToss(e){return this.adminCoinTossService.disabledCoinToss(e)}updateCoinTossWithImage(e,t){return this.adminCoinTossService.updateCoinToss(e,t)}updateCoinToss(e){return this.adminCoinTossService.updateCoinToss(e)}};tt.CoinTossController=et;or([(0,P.Get)("day-statistics/:coinTossId"),At(0,(0,P.Param)("coinTossId")),At(1,(0,P.Query)()),w("design:type",Function),w("design:paramtypes",[String,wo.PageDto]),w("design:returntype",void 0)],et.prototype,"dayStatisticsByGame",null);or([(0,P.Get)("day-statistics"),At(0,(0,P.Query)()),w("design:type",Function),w("design:paramtypes",[wo.PageDto]),w("design:returntype",void 0)],et.prototype,"dayStatistics",null);or([(0,P.Get)("coin-toss-history"),At(0,(0,P.Query)()),w("design:type",Function),w("design:paramtypes",[wo.PageDto]),w("design:returntype",void 0)],et.prototype,"getAllHistory",null);or([(0,P.Get)("coin-toss-history-win"),At(0,(0,P.Query)()),w("design:type",Function),w("design:paramtypes",[wo.PageDto]),w("design:returntype",void 0)],et.prototype,"getAllHistoryWin",null);or([(0,P.Get)(),At(0,(0,P.Query)()),w("design:type",Function),w("design:paramtypes",[wo.PageDto]),w("design:returntype",void 0)],et.prototype,"getAllCoinToss",null);or([(0,P.Post)("disabled"),At(0,(0,P.Body)()),w("design:type",Function),w("design:paramtypes",[x1.CoinTossDisabledDto]),w("design:returntype",void 0)],et.prototype,"disabledCoinToss",null);or([(0,P.Put)(),(0,P.UseInterceptors)((0,X1.FileInterceptor)("file",(0,Z1.multerOptions)(Dp.coinTossImagePath))),At(0,(0,P.Body)()),At(1,(0,P.UploadedFile)()),w("design:type",Function),w("design:paramtypes",[Bp.CoinTossUpdateDto,Object]),w("design:returntype",void 0)],et.prototype,"updateCoinTossWithImage",null);or([(0,P.Put)(),At(0,(0,P.Body)()),w("design:type",Function),w("design:paramtypes",[Bp.CoinTossUpdateDto]),w("design:returntype",void 0)],et.prototype,"updateCoinToss",null);tt.CoinTossController=et=or([(0,P.Controller)("admin/coin-toss"),(0,P.UseGuards)(eT.AdminGuard),w("design:paramtypes",[Dp.AdminCoinTossService])],et)});var Zl=c(sr=>{"use strict";var tT=sr&&sr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},rT=sr&&sr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(sr,"__esModule",{value:!0});sr.CoinTossBetValueService=void 0;var iT=require("@nestjs/common"),nT=l(),Xl=class{constructor(e){this.prisma=e}getAllCoinTossBetValue(e){return this.prisma.coinTossBetValue.findMany({where:{coinTossId:e},orderBy:{value:"asc"}})}createCoinTossBetValue(e){return this.prisma.coinTossBetValue.create({data:e})}updateCoinTossBetValue(e){return this.prisma.coinTossBetValue.update({where:{id:e.id},data:e})}deleteCoinTossBetValue(e){return this.prisma.coinTossBetValue.delete({where:{id:e}})}updateDisabledCoinTossBetValue(e,t){return this.prisma.coinTossBetValue.update({where:{id:e},data:{disabled:t}})}};sr.CoinTossBetValueService=Xl;sr.CoinTossBetValueService=Xl=tT([(0,iT.Injectable)(),rT("design:paramtypes",[nT.PrismaService])],Xl)});var Ep=c(zr=>{"use strict";var To=zr&&zr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ro=zr&&zr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(zr,"__esModule",{value:!0});zr.CoinTossBetValueDataDto=void 0;var te=require("ts-mixer"),qt=require("class-validator"),oT=Y(),sT=bn(),Vp=require("class-transformer"),Qr=class extends(0,te.Mixin)(oT.DisabledDto){constructor(){super(...arguments),this.value=1,this.percentage=0}};zr.CoinTossBetValueDataDto=Qr;To([(0,te.decorate)((0,qt.IsNotEmpty)()),Ro("design:type",String)],Qr.prototype,"name",void 0);To([(0,te.decorate)((0,qt.IsNotEmpty)()),(0,te.decorate)((0,qt.IsHexColor)()),Ro("design:type",String)],Qr.prototype,"color",void 0);To([(0,te.decorate)((0,qt.IsNotEmpty)()),(0,te.decorate)((0,Vp.Transform)(({value:n})=>+n)),(0,te.decorate)((0,qt.IsNumber)()),(0,te.decorate)((0,qt.Min)(1)),Ro("design:type",Number)],Qr.prototype,"value",void 0);To([(0,te.decorate)((0,qt.IsNotEmpty)()),(0,te.decorate)((0,Vp.Transform)(({value:n})=>+n)),(0,te.decorate)((0,qt.IsNumber)()),(0,te.decorate)((0,qt.Min)(0)),Ro("design:type",Number)],Qr.prototype,"percentage",void 0);To([(0,te.decorate)((0,qt.IsNotEmpty)()),(0,te.decorate)((0,sT.DBValueExists)("coinToss","id")),Ro("design:type",String)],Qr.prototype,"coinTossId",void 0)});var eu=c(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.CoinTossBetValueCreateDto=void 0;var aT=require("ts-mixer"),cT=Ep(),xl=class extends(0,aT.Mixin)(cT.CoinTossBetValueDataDto){};Zs.CoinTossBetValueCreateDto=xl});var Np=c(Yr=>{"use strict";var lT=Yr&&Yr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},uT=Yr&&Yr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.CoinTossBetValueUpdateDto=void 0;var Fp=require("ts-mixer"),dT=eu(),fT=require("class-validator"),xs=class extends(0,Fp.Mixin)(dT.CoinTossBetValueCreateDto){};Yr.CoinTossBetValueUpdateDto=xs;lT([(0,Fp.decorate)((0,fT.IsNotEmpty)()),uT("design:type",String)],xs.prototype,"id",void 0)});var Hp=c(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.CoinTossBetValueUpdateDisabledDto=void 0;var pT=require("ts-mixer"),_T=Vt(),mT=Y(),tu=class extends(0,pT.Mixin)(_T.IdDto,mT.DisabledDto){};ea.CoinTossBetValueUpdateDisabledDto=tu});var Lp=c(rt=>{"use strict";var En=rt&&rt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Q=rt&&rt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Ao=rt&&rt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(rt,"__esModule",{value:!0});rt.CoinTossBetValueController=void 0;var Se=require("@nestjs/common"),hT=ee(),vT=Zl(),yT=eu(),gT=Np(),bT=Hp(),Xr=class{constructor(e){this.coinTossBetValue=e}getAllCoinTossBetValue(e){return this.coinTossBetValue.getAllCoinTossBetValue(e)}createCoinTossBetValue(e){return this.coinTossBetValue.createCoinTossBetValue(e)}disabledCoinTossBetValue(e){return this.coinTossBetValue.updateDisabledCoinTossBetValue(e.id,e.disabled)}updateCoinTossBetValue(e){return this.coinTossBetValue.updateCoinTossBetValue(e)}deleteCoinTossBetValue(e){return this.coinTossBetValue.deleteCoinTossBetValue(e)}};rt.CoinTossBetValueController=Xr;En([(0,Se.Get)(":id"),Ao(0,(0,Se.Param)("id")),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",void 0)],Xr.prototype,"getAllCoinTossBetValue",null);En([(0,Se.Post)(),Ao(0,(0,Se.Body)()),Q("design:type",Function),Q("design:paramtypes",[yT.CoinTossBetValueCreateDto]),Q("design:returntype",void 0)],Xr.prototype,"createCoinTossBetValue",null);En([(0,Se.Put)("disabled"),Ao(0,(0,Se.Body)()),Q("design:type",Function),Q("design:paramtypes",[bT.CoinTossBetValueUpdateDisabledDto]),Q("design:returntype",void 0)],Xr.prototype,"disabledCoinTossBetValue",null);En([(0,Se.Put)(),Ao(0,(0,Se.Body)()),Q("design:type",Function),Q("design:paramtypes",[gT.CoinTossBetValueUpdateDto]),Q("design:returntype",void 0)],Xr.prototype,"updateCoinTossBetValue",null);En([(0,Se.Delete)(":id"),Ao(0,(0,Se.Param)("id")),Q("design:type",Function),Q("design:paramtypes",[String]),Q("design:returntype",void 0)],Xr.prototype,"deleteCoinTossBetValue",null);rt.CoinTossBetValueController=Xr=En([(0,Se.Controller)("admin/coin-toss-bet-value"),(0,Se.UseGuards)(hT.AdminGuard),Q("design:paramtypes",[vT.CoinTossBetValueService])],Xr)});var Wp=c(Hi=>{"use strict";var ST=Hi&&Hi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Hi,"__esModule",{value:!0});Hi.CoinTossBetValueModule=void 0;var wT=require("@nestjs/common"),TT=Lp(),RT=Zl(),ru=class{};Hi.CoinTossBetValueModule=ru;Hi.CoinTossBetValueModule=ru=ST([(0,wT.Module)({controllers:[TT.CoinTossBetValueController],providers:[RT.CoinTossBetValueService]})],ru)});var $p=c(Li=>{"use strict";var AT=Li&&Li.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Li,"__esModule",{value:!0});Li.CoinTossModule=void 0;var qT=require("@nestjs/common"),CT=Gp(),jT=Wp(),iu=class{};Li.CoinTossModule=iu;Li.CoinTossModule=iu=AT([(0,qT.Module)({controllers:[CT.CoinTossController],imports:[jT.CoinTossBetValueModule]})],iu)});var ou=c(ar=>{"use strict";var PT=ar&&ar.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},MT=ar&&ar.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(ar,"__esModule",{value:!0});ar.AdminSaleActionsService=void 0;var OT=require("@nestjs/common"),IT=l(),kp=require("rxjs"),nu=class{constructor(e){this.prisma=e}getAllActions(e,t){return(0,kp.from)(this.prisma.$transaction([this.prisma.saleActions.findMany({take:e,skip:t*e,orderBy:{createdAt:"desc"},include:{sale:{select:{id:!0,username:!0,fullName:!0,phone:!0,email:!0,balance:!0,disabled:!0,createdAt:!0}}}}),this.prisma.saleActions.count()])).pipe((0,kp.map)(([i,o])=>({data:i,count:o})))}};ar.AdminSaleActionsService=nu;ar.AdminSaleActionsService=nu=PT([(0,OT.Injectable)(),MT("design:paramtypes",[IT.PrismaService])],nu)});var Kp=c(it=>{"use strict";var Jp=it&&it.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ta=it&&it.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},UT=it&&it.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(it,"__esModule",{value:!0});it.AdminSaleActionsController=void 0;var ra=require("@nestjs/common"),DT=ee(),BT=ou(),GT=V(),ia=class{constructor(e){this.saleActions=e}getAllActions(e){return this.saleActions.getAllActions(e.perPage,e.page)}};it.AdminSaleActionsController=ia;Jp([(0,ra.Get)(),UT(0,(0,ra.Query)()),ta("design:type",Function),ta("design:paramtypes",[GT.PageDto]),ta("design:returntype",void 0)],ia.prototype,"getAllActions",null);it.AdminSaleActionsController=ia=Jp([(0,ra.Controller)("admin/sale-actions"),(0,ra.UseGuards)(DT.AdminGuard),ta("design:paramtypes",[BT.AdminSaleActionsService])],ia)});var Qp=c(Wi=>{"use strict";var VT=Wi&&Wi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.AdminSaleActionsModule=void 0;var ET=require("@nestjs/common"),FT=Kp(),NT=ou(),su=class{};Wi.AdminSaleActionsModule=su;Wi.AdminSaleActionsModule=su=VT([(0,ET.Module)({controllers:[FT.AdminSaleActionsController],providers:[NT.AdminSaleActionsService]})],su)});var cu=c(cr=>{"use strict";var HT=cr&&cr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},LT=cr&&cr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(cr,"__esModule",{value:!0});cr.AdminUserTransactionService=void 0;var WT=require("@nestjs/common"),$T=l(),zp=require("rxjs"),au=class{constructor(e){this.prisma=e}getAllTransaction(e=10,t=0){return(0,zp.from)(this.prisma.$transaction([this.prisma.userTransaction.findMany({take:e,skip:t*e,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,username:!0,fullName:!0,accountName:!0,phone:!0,email:!0,balance:!0,disabled:!0,createdAt:!0}}}}),this.prisma.userTransaction.count()])).pipe((0,zp.map)(([i,o])=>({data:i,count:o})))}};cr.AdminUserTransactionService=au;cr.AdminUserTransactionService=au=HT([(0,WT.Injectable)(),LT("design:paramtypes",[$T.PrismaService])],au)});var Xp=c(nt=>{"use strict";var Yp=nt&&nt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},na=nt&&nt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},kT=nt&&nt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(nt,"__esModule",{value:!0});nt.AdminUserTransactionController=void 0;var oa=require("@nestjs/common"),JT=ee(),KT=cu(),QT=V(),sa=class{constructor(e){this.userTransaction=e}getAllTransaction(e){return this.userTransaction.getAllTransaction(e.perPage,e.page)}};nt.AdminUserTransactionController=sa;Yp([(0,oa.Get)(),kT(0,(0,oa.Query)()),na("design:type",Function),na("design:paramtypes",[QT.PageDto]),na("design:returntype",void 0)],sa.prototype,"getAllTransaction",null);nt.AdminUserTransactionController=sa=Yp([(0,oa.Controller)("admin/user-transaction"),(0,oa.UseGuards)(JT.AdminGuard),na("design:paramtypes",[KT.AdminUserTransactionService])],sa)});var Zp=c($i=>{"use strict";var zT=$i&&$i.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty($i,"__esModule",{value:!0});$i.AdminUserTransactionModule=void 0;var YT=require("@nestjs/common"),XT=Xp(),ZT=cu(),lu=class{};$i.AdminUserTransactionModule=lu;$i.AdminUserTransactionModule=lu=zT([(0,YT.Module)({controllers:[XT.AdminUserTransactionController],providers:[ZT.AdminUserTransactionService]})],lu)});var du=c(lr=>{"use strict";var xT=lr&&lr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},eR=lr&&lr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(lr,"__esModule",{value:!0});lr.AdminSaleTransactionService=void 0;var tR=require("@nestjs/common"),rR=l(),xp=require("rxjs"),uu=class{constructor(e){this.prisma=e}getAllTransaction(e=10,t=0){return(0,xp.from)(this.prisma.$transaction([this.prisma.saleTransaction.findMany({take:e,skip:t*e,orderBy:{createdAt:"desc"},include:{sale:{select:{id:!0,username:!0,fullName:!0,phone:!0,email:!0,balance:!0,disabled:!0,createdAt:!0}}}}),this.prisma.saleTransaction.count()])).pipe((0,xp.map)(([i,o])=>({data:i,count:o})))}};lr.AdminSaleTransactionService=uu;lr.AdminSaleTransactionService=uu=xT([(0,tR.Injectable)(),eR("design:paramtypes",[rR.PrismaService])],uu)});var t_=c(ot=>{"use strict";var e_=ot&&ot.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},aa=ot&&ot.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},iR=ot&&ot.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ot,"__esModule",{value:!0});ot.AdminSaleTransactionController=void 0;var ca=require("@nestjs/common"),nR=ee(),oR=du(),sR=V(),la=class{constructor(e){this.saleTransaction=e}getAllTransaction(e){return this.saleTransaction.getAllTransaction(e.perPage,e.page)}};ot.AdminSaleTransactionController=la;e_([(0,ca.Get)(),iR(0,(0,ca.Query)()),aa("design:type",Function),aa("design:paramtypes",[sR.PageDto]),aa("design:returntype",void 0)],la.prototype,"getAllTransaction",null);ot.AdminSaleTransactionController=la=e_([(0,ca.Controller)("admin/sale-transaction"),(0,ca.UseGuards)(nR.AdminGuard),aa("design:paramtypes",[oR.AdminSaleTransactionService])],la)});var r_=c(ki=>{"use strict";var aR=ki&&ki.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(ki,"__esModule",{value:!0});ki.AdminSaleTransactionModule=void 0;var cR=require("@nestjs/common"),lR=t_(),uR=du(),fu=class{};ki.AdminSaleTransactionModule=fu;ki.AdminSaleTransactionModule=fu=aR([(0,cR.Module)({controllers:[lR.AdminSaleTransactionController],providers:[uR.AdminSaleTransactionService]})],fu)});var i_=c(Ji=>{"use strict";var dR=Ji&&Ji.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Ji,"__esModule",{value:!0});Ji.CtrlModule=void 0;var fR=require("@nestjs/common"),pR=ss(),pu=class{};Ji.CtrlModule=pu;Ji.CtrlModule=pu=dR([(0,fR.Module)({controllers:[pR.CtrlController],providers:[]})],pu)});var mu=c(ur=>{"use strict";var _R=ur&&ur.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},mR=ur&&ur.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(ur,"__esModule",{value:!0});ur.AdminCtrlActionsService=void 0;var hR=require("@nestjs/common"),vR=l(),n_=require("rxjs"),_u=class{constructor(e){this.prisma=e}getAllActions(e,t){return(0,n_.from)(this.prisma.$transaction([this.prisma.ctrlActions.findMany({take:e,skip:t*e,orderBy:{createdAt:"desc"},include:{ctrl:{select:{id:!0,username:!0,fullName:!0,phone:!0,email:!0,disabled:!0,createdAt:!0}}}}),this.prisma.ctrlActions.count()])).pipe((0,n_.map)(([i,o])=>({data:i,count:o})))}};ur.AdminCtrlActionsService=_u;ur.AdminCtrlActionsService=_u=_R([(0,hR.Injectable)(),mR("design:paramtypes",[vR.PrismaService])],_u)});var s_=c(st=>{"use strict";var o_=st&&st.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ua=st&&st.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},yR=st&&st.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(st,"__esModule",{value:!0});st.AdminCtrlActionsController=void 0;var da=require("@nestjs/common"),gR=ee(),bR=V(),SR=mu(),fa=class{constructor(e){this.ctrlActions=e}getAllActions(e){return this.ctrlActions.getAllActions(e.perPage,e.page)}};st.AdminCtrlActionsController=fa;o_([(0,da.Get)(),yR(0,(0,da.Query)()),ua("design:type",Function),ua("design:paramtypes",[bR.PageDto]),ua("design:returntype",void 0)],fa.prototype,"getAllActions",null);st.AdminCtrlActionsController=fa=o_([(0,da.Controller)("admin/ctrl-actions"),(0,da.UseGuards)(gR.AdminGuard),ua("design:paramtypes",[SR.AdminCtrlActionsService])],fa)});var a_=c(Ki=>{"use strict";var wR=Ki&&Ki.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.AdminCtrlActionsModule=void 0;var TR=require("@nestjs/common"),RR=s_(),AR=mu(),hu=class{};Ki.AdminCtrlActionsModule=hu;Ki.AdminCtrlActionsModule=hu=wR([(0,TR.Module)({controllers:[RR.AdminCtrlActionsController],providers:[AR.AdminCtrlActionsService]})],hu)});var c_=c(Qi=>{"use strict";var qR=Qi&&Qi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.AdminModule=void 0;var CR=require("@nestjs/common"),jR=Zf(),PR=sp(),MR=hp(),OR=Sp(),IR=Cp(),UR=Op(),DR=$p(),BR=Qp(),GR=Zp(),VR=r_(),ER=i_(),FR=a_(),vu=class{};Qi.AdminModule=vu;Qi.AdminModule=vu=qR([(0,CR.Module)({imports:[jR.AdminAuthModule,PR.AdminCpModule,MR.SaleModule,OR.UserModule,IR.UserAvatarModule,UR.VirtualUserModule,DR.CoinTossModule,BR.AdminSaleActionsModule,GR.AdminUserTransactionModule,VR.AdminSaleTransactionModule,ER.CtrlModule,FR.AdminCtrlActionsModule],controllers:[],providers:[]})],vu)});var qo=c(dr=>{"use strict";var NR=dr&&dr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},HR=dr&&dr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(dr,"__esModule",{value:!0});dr.SaleActionsService=void 0;var LR=require("@nestjs/common"),WR=l(),l_=require("rxjs"),yu=class{constructor(e){this.prisma=e}getAllActions(e,t,i){return(0,l_.from)(this.prisma.$transaction([this.prisma.saleActions.findMany({skip:t*i,take:t,orderBy:{createdAt:"desc"},where:{saleId:e}}),this.prisma.saleActions.count({where:{saleId:e}})])).pipe((0,l_.map)(([o,r])=>({data:o,count:r})))}createAction(e,t,i,o){return this.prisma.saleActions.create({data:{saleId:e,action:t,refId:i,description:o}})}};dr.SaleActionsService=yu;dr.SaleActionsService=yu=NR([(0,LR.Injectable)(),HR("design:paramtypes",[WR.PrismaService])],yu)});var d_=c(ct=>{"use strict";var pr=ct&&ct.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},T=ct&&ct.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},L=ct&&ct.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ct,"__esModule",{value:!0});ct.UserController=void 0;var D=require("@nestjs/common"),$R=vs(),u_=V(),kR=Cl(),Zr=z(),JR=Pl(),KR=Ml(),QR=Il(),zR=Dl(),YR=Bl(),XR=yn(),ZR=qo(),fr=require("rxjs"),at=class{constructor(e,t){this.user=e,this.saleActions=t}getAllUser(e,t){return this.user.getAllUser(e.perPage,e.page)}getTransactionHistory(e,t,i){return this.user.getTransactionHistory(t,e.perPage,e.page).pipe((0,fr.tap)(()=>{this.saleActions.createAction(i.id,"transaction-history",t,`Xem th\xF4ng tin giao di\u0323ch user, page: ${e.page}, perPage: ${e.perPage}`).then()}))}depositBalance(e,t){return this.user.depositSale(e,t).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"deposit-user",e.id,`Na\u0323p ti\xEA\u0300n, ID: ${i.username} | ${i.accountName}, S\xF4\u0301 ti\xEA\u0300n: ${e.amount}`).then()}))}withdrawBalance(e,t){return this.user.withdrawSale(e,t).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"withdraw-user",e.id,`Ru\u0301t ti\xEA\u0300n, ID: ${i.username} | ${i.accountName}, S\xF4\u0301 ti\xEA\u0300n: ${e.amount}`).then()}))}createUser(e,t){return this.user.createUser(e).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"create-user",i.id,`Ta\u0323o ta\u0300i khoa\u0309n, ID: ${i.username} | ${i.accountName}`).then()}))}changePassword(e,t){return this.user.changePassword(e).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"change-password-user",i.id,`\u0110\xF4\u0309i m\xE2\u0323t kh\xE2\u0309u ta\u0300i khoa\u0309n, ID: ${i.username} | ${i.accountName} - ${e.password}`).then()}))}updateDisabled(e,t){return(0,fr.from)(this.user.updateDisabled(e)).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"disabled-user",i.id,e.disabled?`Khoa\u0301 ta\u0300i khoa\u0309n ta\u0300i khoa\u0309n, ID: ${i.username} | ${i.accountName}`:`M\u01A1\u0309 khoa\u0301 ta\u0300i khoa\u0309n ta\u0300i khoa\u0309n, ID: ${i.username} | ${i.accountName}`).then()}))}updateUser(e,t){return(0,fr.from)(this.user.updateUser(e)).pipe((0,fr.tap)(i=>{this.saleActions.createAction(t.id,"update-user",i.id,`C\xE2\u0323p nh\xE2\u0323t th\xF4ng tin ta\u0300i khoa\u0309n, ID: ${i.username} | ${i.accountName} `+JSON.stringify(e)).then()}))}};ct.UserController=at;pr([(0,D.Get)(),L(0,(0,D.Query)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[u_.PageDto,Object]),T("design:returntype",void 0)],at.prototype,"getAllUser",null);pr([(0,D.Get)("transaction-history/:id"),L(0,(0,D.Query)()),L(1,(0,D.Param)("id")),L(2,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[u_.PageDto,String,Object]),T("design:returntype",void 0)],at.prototype,"getTransactionHistory",null);pr([(0,D.Post)("deposit"),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[kR.UserDepositBalanceDto,Object]),T("design:returntype",void 0)],at.prototype,"depositBalance",null);pr([(0,D.Post)("withdraw"),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[JR.UserWithdrawBalanceDto,Object]),T("design:returntype",void 0)],at.prototype,"withdrawBalance",null);pr([(0,D.Post)(),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[KR.UserCreateDto,Object]),T("design:returntype",void 0)],at.prototype,"createUser",null);pr([(0,D.Put)("change-password"),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[QR.UserChangePasswordDto,Object]),T("design:returntype",void 0)],at.prototype,"changePassword",null);pr([(0,D.Put)("disabled"),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[zR.UserUpdateDisabledDto,Object]),T("design:returntype",void 0)],at.prototype,"updateDisabled",null);pr([(0,D.Put)(),L(0,(0,D.Body)()),L(1,(0,Zr.ReqUser)()),T("design:type",Function),T("design:paramtypes",[YR.UserUpdateDto,Object]),T("design:returntype",void 0)],at.prototype,"updateUser",null);ct.UserController=at=pr([(0,D.Controller)("sale/user"),(0,D.UseGuards)(XR.SaleGuard),T("design:paramtypes",[$R.UserService,ZR.SaleActionsService])],at)});var f_=c(zi=>{"use strict";var xR=zi&&zi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(zi,"__esModule",{value:!0});zi.UserModule=void 0;var eA=require("@nestjs/common"),tA=d_(),rA=qo(),gu=class{};zi.UserModule=gu;zi.UserModule=gu=xR([(0,eA.Module)({providers:[rA.SaleActionsService],controllers:[tA.UserController]})],gu)});var m_=c(lt=>{"use strict";var __=lt&&lt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},pa=lt&&lt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},p_=lt&&lt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(lt,"__esModule",{value:!0});lt.SaleActionsController=void 0;var _a=require("@nestjs/common"),iA=qo(),nA=yn(),oA=V(),sA=z(),ma=class{constructor(e){this.saleActions=e}getAllSaleActions(e,t){return this.saleActions.getAllActions(t.id,e.perPage,e.page)}};lt.SaleActionsController=ma;__([(0,_a.Get)(),p_(0,(0,_a.Query)()),p_(1,(0,sA.ReqUser)()),pa("design:type",Function),pa("design:paramtypes",[oA.PageDto,Object]),pa("design:returntype",void 0)],ma.prototype,"getAllSaleActions",null);lt.SaleActionsController=ma=__([(0,_a.Controller)("sale/sale-actions"),(0,_a.UseGuards)(nA.SaleGuard),pa("design:paramtypes",[iA.SaleActionsService])],ma)});var h_=c(Yi=>{"use strict";var aA=Yi&&Yi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.SaleActionsModule=void 0;var cA=require("@nestjs/common"),lA=m_(),uA=qo(),bu=class{};Yi.SaleActionsModule=bu;Yi.SaleActionsModule=bu=aA([(0,cA.Module)({providers:[uA.SaleActionsService],controllers:[lA.SaleActionsController]})],bu)});var b_=c(xr=>{"use strict";var v_=xr&&xr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},y_=xr&&xr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(xr,"__esModule",{value:!0});xr.SaleAuthLoginDto=void 0;var g_=require("class-validator"),dA=yc(),Co=class{};xr.SaleAuthLoginDto=Co;v_([(0,g_.IsNotEmpty)(),y_("design:type",String)],Co.prototype,"username",void 0);v_([(0,g_.IsNotEmpty)(),(0,dA.SalePasswordLoginValid)(),y_("design:type",String)],Co.prototype,"password",void 0)});var S_=c(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.SaleRefreshTokenGuard=void 0;var fA=require("@nestjs/passport"),Su=class extends(0,fA.AuthGuard)("saleRefreshToken"){};ha.SaleRefreshTokenGuard=Su});var T_=c(ut=>{"use strict";var jo=ut&&ut.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},de=ut&&ut.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Xi=ut&&ut.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ut,"__esModule",{value:!0});ut.SaleAuthController=void 0;var ue=require("@nestjs/common"),pA=pi(),_A=b_(),w_=S_(),mA=io(),hA=yn(),vA=z(),Zi=class{constructor(e){this.authService=e}doLogin(e,t,i){return this.authService.login(e.username,e.password,i,t.headers["user-agent"])}logout(e){return this.authService.logout(e)}checkToken(){return"true"}resetToken(e,t,i){return this.authService.signToken(e.id,i,t.headers["user-agent"])}};ut.SaleAuthController=Zi;jo([(0,ue.Post)(),Xi(0,(0,ue.Body)()),Xi(1,(0,ue.Req)()),Xi(2,(0,ue.Ip)()),de("design:type",Function),de("design:paramtypes",[_A.SaleAuthLoginDto,Request,String]),de("design:returntype",void 0)],Zi.prototype,"doLogin",null);jo([(0,ue.UseGuards)(w_.SaleRefreshTokenGuard),(0,ue.Get)("logout"),Xi(0,(0,mA.ReqParseAuthToken)()),de("design:type",Function),de("design:paramtypes",[String]),de("design:returntype",void 0)],Zi.prototype,"logout",null);jo([(0,ue.UseGuards)(hA.SaleGuard),(0,ue.Get)("check-token"),de("design:type",Function),de("design:paramtypes",[]),de("design:returntype",void 0)],Zi.prototype,"checkToken",null);jo([(0,ue.UseGuards)(w_.SaleRefreshTokenGuard),(0,ue.Get)(),Xi(0,(0,vA.ReqUser)()),Xi(1,(0,ue.Req)()),Xi(2,(0,ue.Ip)()),de("design:type",Function),de("design:paramtypes",[Object,Request,String]),de("design:returntype",void 0)],Zi.prototype,"resetToken",null);ut.SaleAuthController=Zi=jo([(0,ue.Controller)("sale/auth"),de("design:paramtypes",[pA.SaleAuthService])],Zi)});var R_=c(xi=>{"use strict";var yA=xi&&xi.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(xi,"__esModule",{value:!0});xi.SaleAuthModule=void 0;var gA=require("@nestjs/common"),bA=T_(),SA=In(),wu=class{};xi.SaleAuthModule=wu;xi.SaleAuthModule=wu=yA([(0,gA.Module)({controllers:[bA.SaleAuthController],imports:[SA.GlobalModule]})],wu)});var Ru=c(_r=>{"use strict";var wA=_r&&_r.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},TA=_r&&_r.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(_r,"__esModule",{value:!0});_r.SaleChangePasswordService=void 0;var RA=require("@nestjs/common"),AA=l(),A_=require("argon2"),Ct=require("rxjs"),qA=pi(),Tu=class{constructor(e,t){this.prisma=e,this.saleAuthService=t}changePassword(e,t){return(0,Ct.from)((0,A_.verify)(t.hash,e.oldPassword)).pipe((0,Ct.switchMap)(i=>i?(0,Ct.from)((0,A_.hash)(e.password)).pipe((0,Ct.switchMap)(o=>this.prisma.sale.update({where:{id:t.id},data:{hash:o},select:{id:!0}}))).pipe((0,Ct.switchMap)(o=>this.removeToken(o))).pipe((0,Ct.map)(()=>({status:!0}))):(0,Ct.of)({status:!1})),(0,Ct.catchError)(()=>(0,Ct.of)({status:!1})))}removeToken(e){return this.saleAuthService.removeTokenSaleId(e.id).pipe((0,Ct.map)(()=>e))}};_r.SaleChangePasswordService=Tu;_r.SaleChangePasswordService=Tu=wA([(0,RA.Injectable)(),TA("design:paramtypes",[AA.PrismaService,qA.SaleAuthService])],Tu)});var C_=c(ei=>{"use strict";var CA=ei&&ei.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},jA=ei&&ei.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(ei,"__esModule",{value:!0});ei.SaleChangePasswordDto=void 0;var q_=require("ts-mixer"),PA=vt(),MA=require("class-validator"),va=class extends(0,q_.Mixin)(PA.PasswordConfirmDto){};ei.SaleChangePasswordDto=va;CA([(0,q_.decorate)((0,MA.IsNotEmpty)()),jA("design:type",String)],va.prototype,"oldPassword",void 0)});var M_=c(dt=>{"use strict";var P_=dt&&dt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},ya=dt&&dt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},j_=dt&&dt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(dt,"__esModule",{value:!0});dt.SaleChangePasswordController=void 0;var ga=require("@nestjs/common"),OA=yn(),IA=Ru(),UA=C_(),DA=z(),ba=class{constructor(e){this.changePasswordService=e}changePassword(e,t){return this.changePasswordService.changePassword(e,t)}};dt.SaleChangePasswordController=ba;P_([(0,ga.Post)(),j_(0,(0,ga.Body)()),j_(1,(0,DA.ReqUser)()),ya("design:type",Function),ya("design:paramtypes",[UA.SaleChangePasswordDto,Object]),ya("design:returntype",void 0)],ba.prototype,"changePassword",null);dt.SaleChangePasswordController=ba=P_([(0,ga.Controller)("sale/change-password"),(0,ga.UseGuards)(OA.SaleGuard),ya("design:paramtypes",[IA.SaleChangePasswordService])],ba)});var O_=c(en=>{"use strict";var BA=en&&en.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(en,"__esModule",{value:!0});en.SaleChangePasswordModule=void 0;var GA=require("@nestjs/common"),VA=M_(),EA=Ru(),Au=class{};en.SaleChangePasswordModule=Au;en.SaleChangePasswordModule=Au=BA([(0,GA.Module)({controllers:[VA.SaleChangePasswordController],providers:[EA.SaleChangePasswordService]})],Au)});var I_=c(tn=>{"use strict";var FA=tn&&tn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(tn,"__esModule",{value:!0});tn.SaleTransactionModule=void 0;var NA=require("@nestjs/common"),HA=kn(),LA=Ya(),qu=class{};tn.SaleTransactionModule=qu;tn.SaleTransactionModule=qu=FA([(0,NA.Module)({controllers:[HA.SaleTransactionController],providers:[LA.SaleTransactionService]})],qu)});var U_=c(rn=>{"use strict";var WA=rn&&rn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(rn,"__esModule",{value:!0});rn.SaleModule=void 0;var $A=require("@nestjs/common"),kA=f_(),JA=h_(),KA=R_(),QA=O_(),zA=I_(),Cu=class{};rn.SaleModule=Cu;rn.SaleModule=Cu=WA([(0,$A.Module)({imports:[kA.UserModule,JA.SaleActionsModule,KA.SaleAuthModule,QA.SaleChangePasswordModule,zA.SaleTransactionModule],providers:[],exports:[]})],Cu)});var V_=c(ti=>{"use strict";var D_=ti&&ti.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},B_=ti&&ti.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(ti,"__esModule",{value:!0});ti.CtrlAuthLoginDto=void 0;var G_=require("class-validator"),YA=gc(),Po=class{};ti.CtrlAuthLoginDto=Po;D_([(0,G_.IsNotEmpty)(),B_("design:type",String)],Po.prototype,"username",void 0);D_([(0,G_.IsNotEmpty)(),(0,YA.CtrlPasswordLoginValid)(),B_("design:type",String)],Po.prototype,"password",void 0)});var E_=c(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.CtrlRefreshTokenGuard=void 0;var XA=require("@nestjs/passport"),ju=class extends(0,XA.AuthGuard)("ctrlRefreshToken"){};Sa.CtrlRefreshTokenGuard=ju});var Fn=c(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.CtrlGuard=void 0;var ZA=require("@nestjs/passport"),Pu=class extends(0,ZA.AuthGuard)("ctrl"){};wa.CtrlGuard=Pu});var N_=c(ft=>{"use strict";var Mo=ft&&ft.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},pe=ft&&ft.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},nn=ft&&ft.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(ft,"__esModule",{value:!0});ft.CtrlAuthController=void 0;var fe=require("@nestjs/common"),xA=io(),eq=z(),tq=br(),rq=V_(),F_=E_(),iq=Fn(),on=class{constructor(e){this.authService=e}doLogin(e,t,i){return this.authService.login(e.username,e.password,i,t.headers["user-agent"])}logout(e){return this.authService.logout(e)}checkToken(){return"true"}resetToken(e,t,i){return this.authService.signToken(e.id,i,t.headers["user-agent"])}};ft.CtrlAuthController=on;Mo([(0,fe.Post)(),nn(0,(0,fe.Body)()),nn(1,(0,fe.Req)()),nn(2,(0,fe.Ip)()),pe("design:type",Function),pe("design:paramtypes",[rq.CtrlAuthLoginDto,Request,String]),pe("design:returntype",void 0)],on.prototype,"doLogin",null);Mo([(0,fe.UseGuards)(F_.CtrlRefreshTokenGuard),(0,fe.Get)("logout"),nn(0,(0,xA.ReqParseAuthToken)()),pe("design:type",Function),pe("design:paramtypes",[String]),pe("design:returntype",void 0)],on.prototype,"logout",null);Mo([(0,fe.UseGuards)(iq.CtrlGuard),(0,fe.Get)("check-token"),pe("design:type",Function),pe("design:paramtypes",[]),pe("design:returntype",void 0)],on.prototype,"checkToken",null);Mo([(0,fe.UseGuards)(F_.CtrlRefreshTokenGuard),(0,fe.Get)(),nn(0,(0,eq.ReqUser)()),nn(1,(0,fe.Req)()),nn(2,(0,fe.Ip)()),pe("design:type",Function),pe("design:paramtypes",[Object,Request,String]),pe("design:returntype",void 0)],on.prototype,"resetToken",null);ft.CtrlAuthController=on=Mo([(0,fe.Controller)("ctrl/auth"),pe("design:paramtypes",[tq.CtrlAuthService])],on)});var H_=c(sn=>{"use strict";var nq=sn&&sn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(sn,"__esModule",{value:!0});sn.CtrlAuthModule=void 0;var oq=require("@nestjs/common"),sq=N_(),Mu=class{};sn.CtrlAuthModule=Mu;sn.CtrlAuthModule=Mu=nq([(0,oq.Module)({controllers:[sq.CtrlAuthController]})],Mu)});var Oo=c(mr=>{"use strict";var aq=mr&&mr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},cq=mr&&mr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(mr,"__esModule",{value:!0});mr.CtrlActionsService=void 0;var lq=require("@nestjs/common"),uq=l(),L_=require("rxjs"),Ou=class{constructor(e){this.prisma=e}getAllActions(e,t,i){return(0,L_.from)(this.prisma.$transaction([this.prisma.ctrlActions.findMany({where:{ctrlId:e},skip:t*i,take:t,orderBy:{createdAt:"desc"}}),this.prisma.ctrlActions.count({where:{ctrlId:e}})])).pipe((0,L_.map)(([o,r])=>({data:o,count:r})))}createAction(e,t,i,o){return this.prisma.ctrlActions.create({data:{ctrlId:e,action:t,refId:i,description:o}})}};mr.CtrlActionsService=Ou;mr.CtrlActionsService=Ou=aq([(0,lq.Injectable)(),cq("design:paramtypes",[uq.PrismaService])],Ou)});var k_=c(pt=>{"use strict";var $_=pt&&pt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ta=pt&&pt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},W_=pt&&pt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(pt,"__esModule",{value:!0});pt.CtrlActionsController=void 0;var Ra=require("@nestjs/common"),dq=Fn(),fq=Oo(),pq=V(),_q=z(),Aa=class{constructor(e){this.ctrlActions=e}getAllCtrlActions(e,t){return this.ctrlActions.getAllActions(t.id,e.perPage,e.page)}};pt.CtrlActionsController=Aa;$_([(0,Ra.Get)(),W_(0,(0,Ra.Query)()),W_(1,(0,_q.ReqUser)()),Ta("design:type",Function),Ta("design:paramtypes",[pq.PageDto,Object]),Ta("design:returntype",void 0)],Aa.prototype,"getAllCtrlActions",null);pt.CtrlActionsController=Aa=$_([(0,Ra.Controller)("ctrl/ctrl-actions"),(0,Ra.UseGuards)(dq.CtrlGuard),Ta("design:paramtypes",[fq.CtrlActionsService])],Aa)});var J_=c(an=>{"use strict";var mq=an&&an.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(an,"__esModule",{value:!0});an.CtrlActionsModule=void 0;var hq=require("@nestjs/common"),vq=Oo(),yq=k_(),Iu=class{};an.CtrlActionsModule=Iu;an.CtrlActionsModule=Iu=mq([(0,hq.Module)({providers:[vq.CtrlActionsService],controllers:[yq.CtrlActionsController]})],Iu)});var Du=c(x=>{"use strict";var gq=x&&x.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},bq=x&&x.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(x,"__esModule",{value:!0});x.CoinTossHistoryService=x.historySessionSelect=void 0;var Sq=require("@nestjs/common"),wq=l(),ri=require("rxjs");x.historySessionSelect={id:!0,createdAt:!0,even:!0,odd:!0,oneRed:!0,twoRed:!0,threeRed:!0,fourRed:!0,zeroRed:!0,winAmount:!0,redCoin:!0,userId:!0,isAdmin:!0,coinTossId:!0,coinToss:{select:{id:!0,name:!0,code:!0,gameStartTime:!0}},user:{select:{username:!0,accountName:!0}},ctrl:{select:{username:!0,fullName:!0}}};var Uu=class{constructor(e){this.prisma=e}getAllHistoryWin(e,t){let i=new Date;return i.setDate(i.getDate()-3),(0,ri.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:e,skip:e*t,orderBy:{createdAt:"desc"},select:x.historySessionSelect,where:{createdAt:{gte:i},winAmount:{gt:0}}}),this.prisma.coinTossBetHistorySession.count({where:{createdAt:{gte:i},winAmount:{gt:0}}})])).pipe((0,ri.map)(([o,r])=>({data:o,count:r})))}getAllHistory(e,t){let i=new Date;return i.setDate(i.getDate()-3),(0,ri.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:e,skip:e*t,orderBy:{createdAt:"desc"},select:x.historySessionSelect,where:{createdAt:{gte:i}}}),this.prisma.coinTossBetHistorySession.count({where:{createdAt:{gte:i}}})])).pipe((0,ri.map)(([o,r])=>({data:o,count:r})))}getUserAllHistory(e,t,i){let o=new Date;return o.setDate(o.getDate()-3),(0,ri.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:t,skip:t*i,orderBy:{createdAt:"desc"},select:x.historySessionSelect,where:{createdAt:{gte:o},userId:e}}),this.prisma.coinTossBetHistorySession.count({where:{createdAt:{gte:o},userId:e}})])).pipe((0,ri.map)(([r,s])=>({data:r,count:s})))}getUserAllHistoryWin(e,t,i){let o=new Date;return o.setDate(o.getDate()-3),(0,ri.from)(this.prisma.$transaction([this.prisma.coinTossBetHistorySession.findMany({take:t,skip:t*i,orderBy:{createdAt:"desc"},select:x.historySessionSelect,where:{createdAt:{gte:o},winAmount:{gt:0},userId:e}}),this.prisma.coinTossBetHistorySession.count({where:{createdAt:{gte:o},winAmount:{gt:0},userId:e}})])).pipe((0,ri.map)(([r,s])=>({data:r,count:s})))}};x.CoinTossHistoryService=Uu;x.CoinTossHistoryService=Uu=gq([(0,Sq.Injectable)(),bq("design:paramtypes",[wq.PrismaService])],Uu)});var K_=c(_t=>{"use strict";var Io=_t&&_t.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},_e=_t&&_t.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},jt=_t&&_t.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(_t,"__esModule",{value:!0});_t.CoinTossHistoryController=void 0;var we=require("@nestjs/common"),Tq=Fn(),Rq=Du(),Ca=V(),Aq=Oo(),qa=require("rxjs"),ja=z(),cn=class{constructor(e,t){this.coinTossHistory=e,this.ctrlActions=t}getUserHistoryWin(e,t,i){return this.coinTossHistory.getUserAllHistoryWin(e,t.perPage,t.page).pipe((0,qa.tap)(()=>this.ctrlActions.createAction(i.id,"coin-toss-history",e,`Xem li\u0323ch s\u01B0\u0309 Th\u0103\u0301ng cu\u0309a ng\u01B0\u01A1\u0300i du\u0300ng ${e}. Page: ${t.page} - PerPage: ${t.perPage}`).then()))}getAllHistoryWin(e,t){return this.coinTossHistory.getAllHistoryWin(e.perPage,e.page).pipe((0,qa.tap)(()=>this.ctrlActions.createAction(t.id,"coin-toss-history",null,`Xem li\u0323ch s\u01B0\u0309 Th\u0103\u0301ng cu\u0309a toa\u0300n b\xF4\u0323 ng\u01B0\u01A1\u0300i du\u0300ng. Page: ${e.page} - PerPage: ${e.perPage}`).then()))}getUserHistory(e,t,i){return this.coinTossHistory.getUserAllHistory(e,t.perPage,t.page).pipe((0,qa.tap)(()=>this.ctrlActions.createAction(i.id,"coin-toss-history",e,`Xem li\u0323ch s\u01B0\u0309 cu\u0309a ng\u01B0\u01A1\u0300i du\u0300ng ${e}. Page: ${t.page} - PerPage: ${t.perPage}`).then()))}getAllHistory(e,t){return this.coinTossHistory.getAllHistory(e.perPage,e.page).pipe((0,qa.tap)(()=>this.ctrlActions.createAction(t.id,"coin-toss-history",null,`Xem li\u0323ch s\u01B0\u0309 cu\u0309a toa\u0300n b\xF4\u0323 ng\u01B0\u01A1\u0300i du\u0300ng. Page: ${e.page} - PerPage: ${e.perPage}`).then()))}};_t.CoinTossHistoryController=cn;Io([(0,we.Get)("win/:id"),jt(0,(0,we.Param)("id")),jt(1,(0,we.Query)()),jt(2,(0,ja.ReqUser)()),_e("design:type",Function),_e("design:paramtypes",[String,Ca.PageDto,Object]),_e("design:returntype",void 0)],cn.prototype,"getUserHistoryWin",null);Io([(0,we.Get)("win"),jt(0,(0,we.Query)()),jt(1,(0,ja.ReqUser)()),_e("design:type",Function),_e("design:paramtypes",[Ca.PageDto,Object]),_e("design:returntype",void 0)],cn.prototype,"getAllHistoryWin",null);Io([(0,we.Get)(":id"),jt(0,(0,we.Param)("id")),jt(1,(0,we.Query)()),jt(2,(0,ja.ReqUser)()),_e("design:type",Function),_e("design:paramtypes",[String,Ca.PageDto,Object]),_e("design:returntype",void 0)],cn.prototype,"getUserHistory",null);Io([(0,we.Get)(),jt(0,(0,we.Query)()),jt(1,(0,ja.ReqUser)()),_e("design:type",Function),_e("design:paramtypes",[Ca.PageDto,Object]),_e("design:returntype",void 0)],cn.prototype,"getAllHistory",null);_t.CoinTossHistoryController=cn=Io([(0,we.Controller)("ctrl/coin-toss-history"),(0,we.UseGuards)(Tq.CtrlGuard),_e("design:paramtypes",[Rq.CoinTossHistoryService,Aq.CtrlActionsService])],cn)});var Q_=c(ln=>{"use strict";var qq=ln&&ln.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(ln,"__esModule",{value:!0});ln.CoinTossHistoryModule=void 0;var Cq=require("@nestjs/common"),jq=Du(),Pq=K_(),Mq=Oo(),Bu=class{};ln.CoinTossHistoryModule=Bu;ln.CoinTossHistoryModule=Bu=qq([(0,Cq.Module)({providers:[jq.CoinTossHistoryService,Mq.CtrlActionsService],controllers:[Pq.CoinTossHistoryController]})],Bu)});var Vu=c(hr=>{"use strict";var Oq=hr&&hr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Iq=hr&&hr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(hr,"__esModule",{value:!0});hr.CoinTossService=void 0;var Uq=require("@nestjs/common"),Dq=l(),Gu=class{constructor(e){this.prisma=e}getAllCoinToss(){return this.prisma.coinToss.findMany({where:{disabled:!1},select:{id:!0,code:!0,name:!0,image:!0}})}};hr.CoinTossService=Gu;hr.CoinTossService=Gu=Oq([(0,Uq.Injectable)(),Iq("design:paramtypes",[Dq.PrismaService])],Gu)});var Y_=c(vr=>{"use strict";var z_=vr&&vr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Pa=vr&&vr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(vr,"__esModule",{value:!0});vr.CoinTossController=void 0;var Eu=require("@nestjs/common"),Bq=Fn(),Gq=Vu(),Ma=class{constructor(e){this.coinToss=e}getAllCoinToss(){return this.coinToss.getAllCoinToss()}};vr.CoinTossController=Ma;z_([(0,Eu.Get)(),Pa("design:type",Function),Pa("design:paramtypes",[]),Pa("design:returntype",void 0)],Ma.prototype,"getAllCoinToss",null);vr.CoinTossController=Ma=z_([(0,Eu.Controller)("ctrl/coin-toss"),(0,Eu.UseGuards)(Bq.CtrlGuard),Pa("design:paramtypes",[Gq.CoinTossService])],Ma)});var X_=c(un=>{"use strict";var Vq=un&&un.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(un,"__esModule",{value:!0});un.CoinTossModule=void 0;var Eq=require("@nestjs/common"),Fq=Y_(),Nq=Vu(),Fu=class{};un.CoinTossModule=Fu;un.CoinTossModule=Fu=Vq([(0,Eq.Module)({controllers:[Fq.CoinTossController],providers:[Nq.CoinTossService]})],Fu)});var Hu=c(yr=>{"use strict";var Hq=yr&&yr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Lq=yr&&yr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(yr,"__esModule",{value:!0});yr.ChangePasswordService=void 0;var Wq=require("@nestjs/common"),$q=l(),kq=br(),Pt=require("rxjs"),Z_=require("argon2"),Nu=class{constructor(e,t){this.prisma=e,this.ctrlAuthService=t}changePassword(e,t){return(0,Pt.from)((0,Z_.verify)(t.hash,e.oldPassword)).pipe((0,Pt.switchMap)(i=>i?(0,Pt.from)((0,Z_.hash)(e.password)).pipe((0,Pt.switchMap)(o=>this.prisma.ctrl.update({where:{id:t.id},data:{hash:o},select:{id:!0}}))).pipe((0,Pt.switchMap)(o=>this.removeToken(o))).pipe((0,Pt.map)(()=>({status:!0}))):(0,Pt.of)({status:!1})),(0,Pt.catchError)(()=>(0,Pt.of)({status:!1})))}removeToken(e){return this.ctrlAuthService.removeTokenCtrlId(e.id).pipe((0,Pt.map)(()=>e))}};yr.ChangePasswordService=Nu;yr.ChangePasswordService=Nu=Hq([(0,Wq.Injectable)(),Lq("design:paramtypes",[$q.PrismaService,kq.CtrlAuthService])],Nu)});var em=c(ii=>{"use strict";var Jq=ii&&ii.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Kq=ii&&ii.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(ii,"__esModule",{value:!0});ii.CtrlChangePasswordDto=void 0;var x_=require("ts-mixer"),Qq=vt(),zq=require("class-validator"),Oa=class extends(0,x_.Mixin)(Qq.PasswordConfirmDto){};ii.CtrlChangePasswordDto=Oa;Jq([(0,x_.decorate)((0,zq.IsNotEmpty)()),Kq("design:type",String)],Oa.prototype,"oldPassword",void 0)});var im=c(mt=>{"use strict";var rm=mt&&mt.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},Ia=mt&&mt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},tm=mt&&mt.__param||function(n,e){return function(t,i){e(t,i,n)}};Object.defineProperty(mt,"__esModule",{value:!0});mt.ChangePasswordController=void 0;var Ua=require("@nestjs/common"),Yq=Fn(),Xq=z(),Zq=Hu(),xq=em(),Da=class{constructor(e){this.changePasswordService=e}changePassword(e,t){return this.changePasswordService.changePassword(e,t)}};mt.ChangePasswordController=Da;rm([(0,Ua.Post)(),tm(0,(0,Ua.Body)()),tm(1,(0,Xq.ReqUser)()),Ia("design:type",Function),Ia("design:paramtypes",[xq.CtrlChangePasswordDto,Object]),Ia("design:returntype",void 0)],Da.prototype,"changePassword",null);mt.ChangePasswordController=Da=rm([(0,Ua.Controller)("ctrl/change-password"),(0,Ua.UseGuards)(Yq.CtrlGuard),Ia("design:paramtypes",[Zq.ChangePasswordService])],Da)});var nm=c(dn=>{"use strict";var eC=dn&&dn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(dn,"__esModule",{value:!0});dn.ChangePasswordModule=void 0;var tC=require("@nestjs/common"),rC=im(),iC=Hu(),Lu=class{};dn.ChangePasswordModule=Lu;dn.ChangePasswordModule=Lu=eC([(0,tC.Module)({controllers:[rC.ChangePasswordController],providers:[iC.ChangePasswordService]})],Lu)});var om=c(fn=>{"use strict";var nC=fn&&fn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(fn,"__esModule",{value:!0});fn.CtrlModule=void 0;var oC=require("@nestjs/common"),sC=H_(),aC=J_(),cC=Q_(),lC=X_(),uC=nm(),Wu=class{};fn.CtrlModule=Wu;fn.CtrlModule=Wu=nC([(0,oC.Module)({providers:[],imports:[sC.CtrlAuthModule,aC.CtrlActionsModule,cC.CoinTossHistoryModule,lC.CoinTossModule,uC.ChangePasswordModule]})],Wu)});var sm=c(pn=>{"use strict";var dC=pn&&pn.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r};Object.defineProperty(pn,"__esModule",{value:!0});pn.AppModule=void 0;var fC=require("@nestjs/common"),pC=Ju(),_C=Ea(),mC=require("@nestjs/config"),hC=In(),vC=$f(),yC=c_(),gC=require("@nestjs/serve-static"),bC=require("path"),SC=vn(),wC=U_(),TC=om(),RC=Kn(),$u=class{};pn.AppModule=$u;pn.AppModule=$u=dC([(0,fC.Module)({imports:[mC.ConfigModule.forRoot({isGlobal:!0}),gC.ServeStaticModule.forRoot({rootPath:(0,bC.join)((0,SC.findRootDir)(),"assets"),serveRoot:"/"}),hC.GlobalModule,vC.ApiV1Module,yC.AdminModule,wC.SaleModule,TC.CtrlModule],controllers:[pC.AppController],providers:[_C.AppService,RC.GlobalCtrlGatewayService]})],$u)});var um=c(gr=>{"use strict";var AC=gr&&gr.__decorate||function(n,e,t,i){var o=arguments.length,r=o<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(r=(o<3?s(r):o>3?s(e,t,r):s(e,t))||r);return o>3&&r&&Object.defineProperty(e,t,r),r},qC=gr&&gr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(gr,"__esModule",{value:!0});gr.NotFoundExceptionFilter=void 0;var am=require("@nestjs/common"),cm=require("path"),lm=require("fs"),CC=ss(),jC=Jc(),ku=class{constructor(e){this.rootDir=e,console.log(e)}catch(e,t){let i=t.switchToHttp(),o=i.getRequest(),s=o.originalUrl.split("/"),a=i.getResponse(),R=cm.resolve(this.rootDir,"./frontend/"+s[1]+"/index.html"),A=o.hostname;if(atob(jC.f+"4dmlw"+CC.i)!==A)return a.sendStatus(404);if(lm.existsSync(R))a.sendFile(R);else{let me=cm.resolve(this.rootDir,"./frontend/webapp/index.html");lm.existsSync(me)?a.sendFile(me):a.sendStatus(404)}}};gr.NotFoundExceptionFilter=ku;gr.NotFoundExceptionFilter=ku=AC([(0,am.Catch)(am.NotFoundException),qC("design:paramtypes",[String])],ku)});var dm=c(_n=>{"use strict";var PC=_n&&_n.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,o)}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),MC=_n&&_n.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&PC(e,n,t)};Object.defineProperty(_n,"__esModule",{value:!0});MC(um(),_n)});Object.defineProperty(exports,"__esModule",{value:!0});var OC=require("@nestjs/core"),fm=sm(),pm=require("process"),_m=require("body-parser"),IC=require("class-validator"),mm=require("@nestjs/common"),UC=dm(),DC=vn();async function BC(){let n=await OC.NestFactory.create(fm.AppModule,{cors:!0});n.enableCors(),n.use(_m.json({limit:"500mb"})),n.use(_m.urlencoded({limit:"500mb",extended:!0})),(0,IC.useContainer)(n.select(fm.AppModule),{fallbackOnErrors:!0}),n.useGlobalPipes(new mm.ValidationPipe({whitelist:!0,exceptionFactory:(e=[])=>{let t=[];for(let i in e)t.push({property:e[i].property,value:e[i].value,errors:e[i].constraints,code:Object.keys(e[i].constraints)[0],message:e[i].constraints[Object.keys(e[i].constraints)[0]]});return new mm.BadRequestException(t)}})),n.useGlobalFilters(new UC.NotFoundExceptionFilter((0,DC.findRootDir)())),await n.listen(pm.env.SERVER_PORT),console.log("Server started at port",pm.env.SERVER_PORT)}BC();
